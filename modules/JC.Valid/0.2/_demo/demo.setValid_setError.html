<!doctype html>
<html>
    <head>
        <meta charset=utf-8 />
        <title>360 75 team</title>
        <style type='text/css'>
            body{ margin: 20px 20px; }
            .cclear{zoom:1;}
            .cclear:after{content:".";display:block;visibility:hidden;height:0;clear:both;}

            .error{ color: red; }
            input.error, select.error, textarea.error{ 
                background-color: #F0DC82;!important;
                box-shadow: 0 none;
            }
            input[type=text], input[type=password]{ width: 200px; }


            dd.odd {
                background: #ececec;
            }

            dt{
                font-weight: bold;
            }

            input, select, textarea {
                border: 1px solid #b9b9b9
            }

            input, select {
                height: 23px;
                line-height: 23px;
            }

            input[type=checkbox], input[type=radio], input.UXC{
                height: auto;
                line-height: auto;
            }

            select[multiple]{
                height: 80px;
            }

            div, li{
                margin: 2px auto;
            }
        </style>
        <link href='../../../../modules/JC.Calendar/0.2/res/default/style.css' rel='stylesheet' />
        <link href='../../../../modules/JC.Valid/0.2//res/default/style.css' rel='stylesheet' />

        <script src="../../../../lib.js"></script>
        <script src="../../../../config.js"></script>
        <script>
            JC.debug = true; 
            
            requirejs( [ 'JC.Valid', 'JC.Calendar', 'JC.Form' ]
            , function( Valid, Calendar, JCForm ){
                $(document).delegate( 'button.js_clear_error', 'click', function( $evt ){
                    window.console && console.clear && console.clear();
                    JC.Valid.clearError( 'form.js_valid' );
                });

                $('form.js_valid').on('submit', function( $evt ){
                    window.console && console.clear && console.clear();
                        $evt.preventDefault();

                    if( !JC.Valid.check( 'form.js_valid' ) ){
                        $evt.preventDefault();
                        return false;
                    }
                });

                $(document).delegate( 'button.js_setError', 'click', function( _evt ){
                    var _p = $(this)
                        , _target = JC.f.parentSelector( _p, _p.attr('target') )
                        , _msgkey = _p.attr('msgkey')
                        , _msg = _p.attr('msg') || ( !_msgkey ? 'test error' : '')
                        ;

                    _msgkey && _msg && _target.attr( _msgkey, _msg );

                    _target && _target.each( function(){
                        JC.Valid.setError( $(this), _msgkey || _msg );
                    });
                });

                $(document).delegate( 'button.js_setFocusMsg', 'click', function( _evt ){
                    var _p = $(this)
                        , _target = JC.f.parentSelector( _p, _p.attr('target') )
                        , _msgkey = _p.attr('msgkey')
                        , _msg = _p.attr('msg') || ( !_msgkey ? ' test focusmsg' : '')
                        ;

                    _msgkey && _msg && _target.attr( _msgkey, _msg );

                    _target && _target.each( function(){
                        JC.Valid.focusmsg( $(this), _msgkey || _msg );
                    });
                });


                $(document).delegate( 'button.js_setValid', 'click', function( _evt ){
                    var _p = $(this)
                        , _target = JC.f.parentSelector( _p, _p.attr('target') )
                        ;

                    _target && _target.each( function(){
                        JC.Valid.setValid( $(this) );
                    });
                });

                $(document).delegate( 'button.js_statusChain', 'click', function( _evt ){
                    var _p = $(this)
                        , _target = JC.f.parentSelector( _p, _p.attr('target') )
                        , _data = $.parseJSON( _p.html() );
                        ;

                    Valid.check( _target );

                    $.each( _data, function( _ix, _item ){
                        switch( _item.type.toLowerCase() ){
                            case 'setvalid': {
                                Valid.setValid( _target, 300 );
                                JC.log( 'setvalid' );
                                break;
                            }

                            case 'seterror': {
                                JC.log( 'seterror' );
                                Valid.setError( _target, ' ' + _item.msg );
                                break;
                            }
                        }
                    });
                });
            });
        </script>
    </head>    
    <body>

        <form action='' method='get' class="js_valid" >
            <div style="position:fixed; top: 10px; right:10px;">
                <button type="submit">Save</button>
                <button type="button" class="js_clear_error">清空错误信息</button>
            </div>
            <dl class="fm-items">
                <dt>JC.Valid 示例, setError</dt>
                <dd>
                    文件: <input  type="file" reqmsg="文件" />
                    <button type="button" class="js_setError" target="/input" msg="test ilu" msgkey="msgextent" >test - msg && msgkey</button>
                    <button type="button" class="js_setValid" target="/input" >setValid</button>
                    <button type="button" class="js_setFocusMsg" target="/input" >setFocusMsg</button>
                    <em class="error"></em>
                    <em class="focusmsg"></em>
                </dd>
                <dd>
                    文件: <input  type="file" reqmsg="文件" extendkey="test" />
                    <button type="button" class="js_setError" target="/input" msgkey="extendkey" >test - msgkey</button>
                    <button type="button" class="js_setValid" target="/input" >set valid</button>
                    <em class="error"></em>
                    <em class="focusmsg"></em>
                </dd>
                <dd>
                    文件: <input  type="file" reqmsg="文件" />
                    <button type="button" class="js_setError" 
                        target="/input" 
                        msgkey=" test msg" >test - msgkey - auto generate key - (space at first char)</button>
                    <button type="button" class="js_setValid" target="/input" >set valid</button>
                    <em class="error"></em>
                    <em class="focusmsg"></em>
                </dd>
            </dl>

            <dl class="fm-items">
                <dt>JC.Valid 示例, setValid</dt>
                <dd>
                    文件: <input  type="file" reqmsg="文件" />
                    <button type="button" class="js_setError" target="/input" msgkey=" test msg" >set error</button>
                    <button type="button" class="js_setValid" target="/input" >set valid</button>
                    <em class="error"></em>
                    <em class="validmsg"></em>
                </dd>
            </dl>

            <dl class="fm-items">
                <dt>JC.Valid 示例, setValid</dt>
                <dd>
                    内容: <input type="text" reqmsg="内容" value="test" />
                    <button type="button" class="js_setError" target="/input" msgkey=" test msg" >set error</button>
                    <button type="button" class="js_setValid" target="/input" >set valid</button>
                    <button type="button" class="js_setFocusMsg" target="/input" >setFocusMsg</button>
                    <button type="button" class="js_statusChain" target="/input" >[{"type":"setValid", "msg": "valid test"},{"type":"setError", "msg": "error test"}]</button>
                    <em class="error"></em>
                    <em class="validmsg"></em>
                    <em class="focusmsg"></em>
                </dd>
                <dd>
                    内容: <input type="text" reqmsg="内容" disabled value="test" />
                    <button type="button" class="js_setError" target="/input" msgkey=" test msg" >set error</button>
                    <button type="button" class="js_setValid" target="/input" >set valid</button>
                    <button type="button" class="js_setFocusMsg" target="/input" >setFocusMsg</button>
                    <em class="error"></em>
                    <em class="validmsg"></em>
                    <em class="focusmsg"></em>
                </dd>
            </dl>

            <dl class="fm-items">
                <dt>JC.Valid 示例, setValid</dt>
                <dd>
                    <select name='select20_1' 
                        defaultselect 
                        selectvalue="14" 
                        selecturl="../../../../modules/JC.AutoSelect/0.2/_demo/data/shengshi.php" 
                        selecttarget="/select:last"
                        >
                        <option value="-1" defaultoption>请选择</option></select>
                    <select name='select20_2' 
                        selecturl="../../../../modules/JC.AutoSelect/0.2/_demo/data/shengshi.php?id={0}" 
                        >
                        <option value="-1" defaultoption>请选择</option>
                    </select>                    
                    <button type="button" class="js_setError" target="/select" msgkey=" test msg" >set error</button>
                    <button type="button" class="js_setValid" target="/select" >set valid</button>
                    <em class="error"></em>
                    <em class="validmsg"></em>
                </dd>
            </dl>

            <div style="position:fixed; bottom: 10px; right:10px;">
                <button type="submit">Save</button>
                <button type="button" class="js_clear_error">清空错误信息</button>
            </div>
        </form>

    </body>
</html>

