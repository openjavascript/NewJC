/*!
 * jQuery Raty - A Star Rating Plugin
 * ------------------------------------------------------------------
 *
 * jQuery Raty is a plugin that generates a customizable star rating.
 *
 * Licensed under The MIT License
 *
 * @version        2.5.2
 * @since          2010.06.11
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 *
 * ------------------------------------------------------------------
 *
 *  <div id="star"></div>
 *
 *  $('#star').raty();
 *
 */

(function(e){var t={init:function(n){return this.each(function(){t.destroy.call(this),this.opt=e.extend(!0,{},e.fn.raty.defaults,n);var r=e(this),i=["number","readOnly","score","scoreName"];t._callback.call(this,i),this.opt.precision&&t._adjustPrecision.call(this),this.opt.number=t._between(this.opt.number,0,this.opt.numberMax),this.opt.path=this.opt.path||"",this.opt.path&&this.opt.path.slice(this.opt.path.length-1,this.opt.path.length)!=="/"&&(this.opt.path+="/"),this.stars=t._createStars.call(this),this.score=t._createScore.call(this),t._apply.call(this,this.opt.score);var s=this.opt.space?4:0,o=this.opt.width||this.opt.number*this.opt.size+this.opt.number*s;this.opt.cancel&&(this.cancel=t._createCancel.call(this),o+=this.opt.size+s),this.opt.readOnly?t._lock.call(this):(r.css("cursor","pointer"),t._binds.call(this)),this.opt.width!==!1&&r.css("width",o),t._target.call(this,this.opt.score),r.data({settings:this.opt,raty:!0})})},_adjustPrecision:function(){this.opt.targetType="score",this.opt.half=!0},_apply:function(e){e&&e>0&&(e=t._between(e,0,this.opt.number),this.score.val(e)),t._fill.call(this,e),e&&t._roundStars.call(this,e)},_between:function(e,t,n){return Math.min(Math.max(parseFloat(e),t),n)},_binds:function(){this.cancel&&t._bindCancel.call(this),t._bindClick.call(this),t._bindOut.call(this),t._bindOver.call(this)},_bindCancel:function(){t._bindClickCancel.call(this),t._bindOutCancel.call(this),t._bindOverCancel.call(this)},_bindClick:function(){var t=this,n=e(t);t.stars.on("click.raty",function(e){t.score.val(t.opt.half||t.opt.precision?n.data("score"):this.alt),t.opt.click&&t.opt.click.call(t,parseFloat(t.score.val()),e)})},_bindClickCancel:function(){var e=this;e.cancel.on("click.raty",function(t){e.score.removeAttr("value"),e.opt.click&&e.opt.click.call(e,null,t)})},_bindOut:function(){var n=this;e(this).on("mouseleave.raty",function(e){var r=parseFloat(n.score.val())||undefined;t._apply.call(n,r),t._target.call(n,r,e),n.opt.mouseout&&n.opt.mouseout.call(n,r,e)})},_bindOutCancel:function(){var t=this;t.cancel.on("mouseleave.raty",function(n){e(this).attr("src",t.opt.path+t.opt.cancelOff),t.opt.mouseout&&t.opt.mouseout.call(t,t.score.val()||null,n)})},_bindOverCancel:function(){var n=this;n.cancel.on("mouseover.raty",function(r){e(this).attr("src",n.opt.path+n.opt.cancelOn),n.stars.attr("src",n.opt.path+n.opt.starOff),t._target.call(n,null,r),n.opt.mouseover&&n.opt.mouseover.call(n,null)})},_bindOver:function(){var n=this,r=e(n),i=n.opt.half?"mousemove.raty":"mouseover.raty";n.stars.on(i,function(i){var s=parseInt(this.alt,10);if(n.opt.half){var o=parseFloat((i.pageX-e(this).offset().left)/n.opt.size),u=o>.5?1:.5;s=s-1+u,t._fill.call(n,s),n.opt.precision&&(s=s-u+o),t._roundStars.call(n,s),r.data("score",s)}else t._fill.call(n,s);t._target.call(n,s,i),n.opt.mouseover&&n.opt.mouseover.call(n,s,i)})},_callback:function(e){for(i in e)typeof this.opt[e[i]]=="function"&&(this.opt[e[i]]=this.opt[e[i]].call(this))},_createCancel:function(){var t=e(this),n=this.opt.path+this.opt.cancelOff,r=e("<img />",{src:n,alt:"x",title:this.opt.cancelHint,"class":"raty-cancel"});return this.opt.cancelPlace=="left"?t.prepend("&#160;").prepend(r):t.append("&#160;").append(r),r},_createScore:function(){return e("<input />",{type:"hidden",name:this.opt.scoreName}).appendTo(this)},_createStars:function(){var n=e(this);for(var r=1;r<=this.opt.number;r++){var i=t._getHint.call(this,r),s=this.opt.score&&this.opt.score>=r?"starOn":"starOff";s=this.opt.path+this.opt[s],e("<img />",{src:s,alt:r,title:i}).appendTo(this),this.opt.space&&n.append(r<this.opt.number?"&#160;":"")}return n.children("img")},_error:function(t){e(this).html(t),e.error(t)},_fill:function(e){var t=this,n=0;for(var r=1;r<=t.stars.length;r++){var i=t.stars.eq(r-1),s=t.opt.single?r==e:r<=e;if(t.opt.iconRange&&t.opt.iconRange.length>n){var o=t.opt.iconRange[n],u=o.on||t.opt.starOn,a=o.off||t.opt.starOff,f=s?u:a;r<=o.range&&i.attr("src",t.opt.path+f),r==o.range&&n++}else{var f=s?"starOn":"starOff";i.attr("src",this.opt.path+this.opt[f])}}},_getHint:function(e){var t=this.opt.hints[e-1];return t===""?"":t||e},_lock:function(){var n=parseInt(this.score.val(),10),r=n?t._getHint.call(this,n):this.opt.noRatedMsg;e(this).data("readonly",!0).css("cursor","").attr("title",r),this.score.attr("readonly","readonly"),this.stars.attr("title",r),this.cancel&&this.cancel.hide()},_roundStars:function(e){var t=(e-Math.floor(e)).toFixed(2);if(t>this.opt.round.down){var n="starOn";this.opt.halfShow&&t<this.opt.round.up?n="starHalf":t<this.opt.round.full&&(n="starOff"),this.stars.eq(Math.ceil(e)-1).attr("src",this.opt.path+this.opt[n])}},_target:function(n,r){if(this.opt.target){var i=e(this.opt.target);i.length===0&&t._error.call(this,"Target selector invalid or missing!"),this.opt.targetFormat.indexOf("{score}")<0&&t._error.call(this,'Template "{score}" missing!');var s=r&&r.type=="mouseover";n===undefined?n=this.opt.targetText:n===null?n=s?this.opt.cancelHint:this.opt.targetText:(this.opt.targetType=="hint"?n=t._getHint.call(this,Math.ceil(n)):this.opt.precision&&(n=parseFloat(n).toFixed(1)),!s&&!this.opt.targetKeep&&(n=this.opt.targetText)),n&&(n=this.opt.targetFormat.toString().replace("{score}",n)),i.is(":input")?i.val(n):i.html(n)}},_unlock:function(){e(this).data("readonly",!1).css("cursor","pointer").removeAttr("title"),this.score.removeAttr("readonly","readonly");for(var n=0;n<this.opt.number;n++)this.stars.eq(n).attr("title",t._getHint.call(this,n+1));this.cancel&&this.cancel.css("display","")},cancel:function(n){return this.each(function(){e(this).data("readonly")!==!0&&(t[n?"click":"score"].call(this,null),this.score.removeAttr("value"))})},click:function(n){return e(this).each(function(){e(this).data("readonly")!==!0&&(t._apply.call(this,n),this.opt.click||t._error.call(this,'You must add the "click: function(score, evt) { }" callback.'),this.opt.click.call(this,n,{type:"click"}),t._target.call(this,n))})},destroy:function(){return e(this).each(function(){var t=e(this),n=t.data("raw");n?t.off(".raty").empty().css({cursor:n.style.cursor,width:n.style.width}).removeData("readonly"):t.data("raw",t.clone()[0])})},getScore:function(){var t=[],n;return e(this).each(function(){n=this.score.val(),t.push(n?parseFloat(n):undefined)}),t.length>1?t:t[0]},readOnly:function(n){return this.each(function(){var r=e(this);r.data("readonly")!==n&&(n?(r.off(".raty").children("img").off(".raty"),t._lock.call(this)):(t._binds.call(this),t._unlock.call(this)),r.data("readonly",n))})},reload:function(){return t.set.call(this,{})},score:function(){return arguments.length?t.setScore.apply(this,arguments):t.getScore.call(this)},set:function(t){return this.each(function(){var n=e(this),r=n.data("settings"),i=e.extend({},r,t);n.raty(i)})},setScore:function(n){return e(this).each(function(){e(this).data("readonly")!==!0&&(t._apply.call(this,n),t._target.call(this,n))})}};e.fn.raty=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist!")},e.fn.raty.defaults={cancel:!1,cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:"",precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:undefined,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:undefined}})(jQuery);