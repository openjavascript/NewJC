(function(e,t){e("Bizs.DropdownTree",["JC.BaseMVC","JC.Tree"],function(){function e(t){t&&(t=$(t));if(JC.BaseMVC.getInstance(t,e))return JC.BaseMVC.getInstance(t,e);JC.BaseMVC.getInstance(t,e,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init(),JC.log(e.Model._instanceName,"all inited",(new Date).getTime())}return Bizs.DropdownTree=e,e.init=function(t){var n=[];return t=$(t||document),t&&t.length&&(t.hasClass("js_bizDropdownTree")?n.push(new e(t)):t.find("div.js_bizDropdownTree").each(function(){n.push(new e(this))})),n},BaseMVC.build(e),JC.f.extendObject(e.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("DropdownTreeSelected",function(t,n,r,i){e.hide()}),e.on("INITED",function(){e.update()}),e.on("INITED_STATUS",function(t,n){var r=e._model.bdtInput().val().trim(),i;typeof n!="undefined"&&(r=n),e._model.bdtInput().is("[name]")&&(r=JC.f.getUrlParam(e._model.bdtInput().attr("name"))||r),r&&(i=e._model.treeIns().getItem(r)),r&&i&&i.length||(e._model.is("[bdtDefaultLabel]")&&e._model.bdtLabel().html(e._model.bdtDefaultLabel()),e._model.is("[bdtDefaultValue]")&&(e._model.bdtInput().val(e._model.bdtDefaultValue()),r=e._model.bdtDefaultValue())),r&&e._model.bdtLabel().html(e._model.treeIns().getItem(r).attr("dataname"))&&(e._model.bdtInput().val(r),e._model.treeIns().selectedItem(e._model.treeIns().getItem(r)))}),e.on("CLEAR_STATUS",function(){e._model.bdtInput().val(""),e._model.bdtLabel().html("")})},_inited:function(){this.trigger("INITED")},show:function(){return this._view.show(),this},hide:function(){return this._view.hide(),this},toggle:function(){return this._view.toggle(),this},update:function(e,t){var n;return e&&(n=!0),n&&this.trigger("CLEAR_STATUS"),this._view.update(e,n),this.trigger("INITED_STATUS",[t]),this},clear:function(){var e=this;return e._model.is("[bdtDefaultLabel]")?e._model.bdtLabel().html(e._model.bdtDefaultLabel()):e._model.bdtLabel().html(""),e._model.is("[bdtDefaultValue]")?e._model.bdtInput().val(e._model.bdtDefaultValue()):e._model.bdtInput().val(""),this},label:function(){return this._model.bdtLabel()},val:function(e){return typeof e!="undefined"&&this.getItem(e).trigger("click"),this._model.bdtInput().val()}}),e.Model._instanceName="DropdownTreeIns",JC.f.extendObject(e.Model.prototype,{init:function(){},bdtData:function(){return this.windowProp("bdtData")||{}},bdtDefaultLabel:function(){return this.attrProp("bdtDefaultLabel")},bdtDefaultValue:function(){return this.attrProp("bdtDefaultValue")},bdtTreeBox:function(){var e=this.selector().find("> .bdtTreeBox");return e},bdtLabel:function(){var e=this.selector().find("> .bdtLabel");return e},bdtInput:function(){var e=this.selector().find("> .bdtInput");return e},treeIns:function(e){return this._treeIns=e||JC.Tree.getInstance(this.bdtTreeBox()),this._treeIns}}),JC.f.extendObject(e.View.prototype,{init:function(){},update:function(e,t){var n=this;e=e||n._model.bdtData(),t;if(!n._model.treeIns()||t)n._model.bdtTreeBox().html(""),n._model.bdtTreeBox().data(JC.Tree.Model._instanceName,null),n._model.treeIns(new JC.Tree(n._model.bdtTreeBox(),e)),n._model.treeIns().on("click",function(){var e=$(this),t=e.attr("dataid"),r=e.attr("dataname");n._model.bdtLabel().html(r),n._model.bdtInput().val(t),$(n).trigger("TriggerEvent",["DropdownTreeSelected",t,r,e])}),n._model.treeIns().on("RenderLabel",function(e){var t=$(this);t.html(JC.f.printf('<a href="javascript:" dataid="{0}">{1}</a>',e[0],e[1]))}),n._model.treeIns().init(),n._model.treeIns().open()},show:function(){var e=this;JC.f.safeTimeout(setTimeout(function(){},50),e._model.selector(),"DropdownTreeUi"),e.updateZIndex(),e._model.selector().addClass("bdtBox-active"),e._model.bdtTreeBox().show(),e._model.bdtTreeBox().css({"z-index":ZINDEX_COUNT++})},hide:function(){var e=this;e._model.bdtTreeBox().hide(),JC.f.safeTimeout(setTimeout(function(){e._model.selector().removeClass("bdtBox-active")},50),e._model.selector(),"DropdownTreeUi")},toggle:function(){this.updateZIndex(),this._model.bdtTreeBox().is(":visible")?this.hide():this.show()},updateZIndex:function(){this._model.bdtTreeBox().css({"z-index":ZINDEX_COUNT++})}}),JC.Tree.dataFilter=JC.Tree.dataFilter||function(e){var t={};if(e&&e.root&&e.root.length>2){e.root.shift(),t.root=e.root,t.data={};for(var n in e.data){t.data[n]=[];for(var r=0,i=e.data[n].length;r<i;r++){if(e.data[n][r].length<3){t.data[n].push(e.data[n][r]);continue}e.data[n][r].shift(),t.data[n].push(e.data[n][r])}}}else t=e;return t},$(document).ready(function(){var t=0;e.autoInit&&(t=e.init())}),$(document).delegate("div.js_bizDropdownTree","click",function(t){var n=$(this),r;JC.f.safeTimeout(function(){r=JC.BaseMVC.getInstance(n,e),!r&&(r=new e(n)),r.toggle(),JC.log("div.js_bizDropdownTree click",(new Date).getTime())},n,"DropdownTreeClick",50)}),$(document).click(function(){$("div.js_bizDropdownTree").each(function(){var t=JC.BaseMVC.getInstance($(this),e);t&&t.hide()})}),$(document).delegate("div.js_bizDropdownTree > .bdtTreeBox","click",function(e){e.stopPropagation()}),Bizs.DropdownTree})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);