(function(e,t){e("Bizs.DMultiDate",["JC.BaseMVC","JC.Calendar"],function(){function e(t){if(e.getInstance(t))return e.getInstance(t);e.getInstance(t,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init()}return window.Bizs.DMultiDate=e,e.prototype={_beforeInit:function(){this._model.mddateEl().attr("ignoreInitCalendarDate","true").data("ignoreInitCalendarDate",!0),e.Model._defaultMaxvalue=this._model.mddateEl().eq(0).attr("maxvalue")||"",e.Model._defaultMinvalue=this._model.mddateEl().eq(1).attr("minvalue")||""},_initHanlderEvent:function(){var t=this,n=e.Model._inscount++,r="Bizs.DMultiDate_update_start"+n,i="Bizs.DMultiDate_update_end"+n,s="Bizs.DMultiDate_show_start"+n,o="Bizs.DMultiDate_show_end"+n,u="Bizs.DMultiDate_hide_start"+n,a="Bizs.DMultiDate_hide_end"+n,f="Bizs.DMultiDate_layoutchange_start"+n,l="Bizs.DMultiDate_layoutchange_end"+n,c="Bizs.DMultiDate_clear_start"+n,h="Bizs.DMultiDate_clear_end"+n,p="parsedateweek",d="parsedatemonth",v="parsedateseason",m="parsedateyear";t._initDefaultData(),t._model.calendarTypeEl().on("change",function(e,n){var r=$(this),i=r.val();i==="day"&&(i="date"),t._model.updatemddateElProp(i),i=="custom"||i=="customized"?t._model.lastIptBox().show():t._model.lastIptBox().hide();if(n)return;setTimeout(function(){t._model.setmddate(""),t._model.setHiddenStartdate(""),t._model.setHiddenEnddate(""),Calendar.pickDate(t._model.mddateEl().eq(0)[0])},10)}),t._model.mddateEl().eq(0).attr("calendarupdate",r).attr("calendarshow",s).attr("calendarhide",u).attr("calendarlayoutchange",f).attr("calendarclear",c),t._model.mddateEl().eq(1).attr("calendarupdate",i).attr("calendarshow",o).attr("calendarhide",a).attr("calendarlayoutchange",l).attr("calendarclear",h),window[r]=function(n,r,i){console.log("_updatestartcb",JC.f.formatISODate(n),JC.f.formatISODate(r));var s=t._model.mddateEl(),o=t._model.calendarType(),u=JC.f.cloneDate(n),a=e.Model._defaultMaxvalue,f;n=JC.f.formatISODate(n),a&&(a=JC.f.dateDetect(a));switch(o){case"week":f=t._model.weekrange(),f&&u.setDate(u.getDate()+(f-1)*7+6);break;case"month":f=t._model.monthrange(),f&&(u.setMonth(u.getMonth()+(f-1)),u.setDate(JC.f.maxDayOfMonth(u)));break;case"season":f=t._model.seasonrange(),f&&(u.setMonth(u.getMonth()+(f-1)*3+2),u.setDate(JC.f.maxDayOfMonth(u)));break;case"year":f=t._model.yearrange(),f&&u.setYear(u.getFullYear()+f-1);break;case"custom":case"customized":f=t._model.dayrange(),f&&u.setDate(u.getDate()+f-1);break;case"date":default:f=t._model.dayrange(),f&&u.setDate(u.getDate()+f-1)}f&&(a&&a.getTime()<=u.getTime()&&(u=a),s.eq(1).attr("maxvalue",JC.f.formatISODate(u)).attr("minvalue",n).attr("defaultdate",n)),t._model.setHiddenStartdate(n);var l=0;$.each(t._model.mddateEl(),function(e,t){$(t).is(":hidden")||l++}),l==1?t._model.setHiddenEnddate(JC.f.formatISODate(r)):!t._model.mddateEl().eq(1).is("reqmsg")&&!t._model.hiddenEnddateEl().val()&&t._model.setHiddenEnddate(JC.f.formatISODate(r))},window[i]=function(n,r,i){var s=t._model.mddateEl(),o=t._model.calendarType(),u=new Date(n.getFullYear(),n.getMonth(),n.getDate()),a=e.Model._defaultMinvalue,f,l=new Date(n.getFullYear(),n.getMonth(),n.getDate());a&&(a=JC.f.dateDetect(a));switch(o){case"week":f=t._model.weekrange(),f&&u.setDate(u.getDate()-(f-1)*7);break;case"month":f=t._model.monthrange(),f&&u.setMonth(u.getMonth()-(f-1))&&l.setDate(JC.f.maxDayOfMonth(n));break;case"season":f=t._model.seasonrange(),f&&u.setMonth(u.getMonth()-(f-1)*3);break;case"year":f=t._model.yearrange(),f&&u.setYear(u.getFullYear()-f+1);break;case"custom":case"customized":f=t._model.dayrange(),f&&u.setDate(u.getDate()-f+1);break;case"date":default:f=t._model.dayrange(),f&&u.setDate(u.getDate()-f+1)}f&&(a&&a.getTime()>u.getTime()&&(u=a),u=JC.f.formatISODate(u),s.eq(0).attr("maxvalue",JC.f.formatISODate(l)).attr("minvalue",u).attr("defaultdate",u)),t._model.setHiddenEnddate(JC.f.formatISODate(r)),!t._model.mddateEl().eq(0).is("reqmsg")&&!t._model.hiddenStartdateEl().val()&&t._model.setHiddenStartdate(JC.f.formatISODate(n))},window[s]=function(){var e=$("body > div.UXCCalendar:visible");e.length&&JC.Tips&&JC.Tips.init(e.find("[title]"))},window[o]=function(){var e=$("body > div.UXCCalendar:visible");e.length&&JC.Tips&&JC.Tips.init(e.find("[title]"))},window[u]=function(){JC.Tips&&JC.Tips.hide(),t._model.hiddendateiso()||t._model.updateHiddenStartdate()},window[a]=function(){JC.Tips&&JC.Tips.hide(),t._model.hiddendateiso()||t._model.updateHiddenEnddate()},window[f]=function(){JC.Tips&&JC.Tips.hide();var e=$("body > div.UXCCalendar:visible");e.length&&JC.Tips&&JC.Tips.init(e.find("[title]"))},window[l]=function(){JC.Tips&&JC.Tips.hide();var e=$("body > div.UXCCalendar:visible");e.length&&JC.Tips&&JC.Tips.init(e.find("[title]"))},window[c]=function(n,r){var i=t._model.mddateEl().eq(1),s=e.Model._defaultMaxvalue,o=e.Model._defaultMinvalue;s?i.attr("maxvalue",s).attr("defaultdate",s):i.removeAttr("maxvalue").removeAttr("defaultdate"),o?i.attr("minvalue",o):i.removeAttr("minvalue")},window[h]=function(){var n=t._model.mddateEl().eq(0),r=e.Model._defaultMaxvalue,i=e.Model._defaultMinvalue;r?n.attr("maxvalue",r):n.removeAttr("maxvalue"),i?n.attr("minvalue",i).attr("defaultdate",i):n.removeAttr("minvalue").removeAttr("defaultdate")},window[p]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;if(e){n=e.replace(/[^\d]+/g,""),e=e.split("W");if(n.length===8)return t.start=JC.f.parseISODate(n),t.end=t.start,t;if(n.length===16)return t.start=JC.f.parseISODate(n.slice(0,8)),t.end=JC.f.parseISODate(n.slice(8,16)),t;var r,i,s,o,u,a;r=parseInt(e[0],10),i=parseInt(e[1],10),s=JC.f.pureDate(new Date(e[0]),0,1),o=JC.f.pureDate(new Date(e[1]),0,1),u=u||JC.f.weekOfYear(e[0],JC.Calendar.weekDayOffset),$(u).each(function(e,n){if(n.week===i)return t.start=new Date,t.end=new Date,t.start.setTime(n.start),t.end.setTime(n.end),!1})}return t},window[d]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;if(e){n=e.replace(/[^\d]+/g,""),e=e.replace(/[^\d]+/g,"");if(n.length===8)return t.start=JC.f.parseISODate(n),t.end=t.start,t;if(n.length===16)return t.start=JC.f.parseISODate(n.slice(0,8)),t.end=JC.f.parseISODate(n.slice(8,16)),t;var r=e.slice(0,4),i=parseInt(e.slice(4,6),10)-1;t.start=new Date(r,i,1),t.end=JC.f.cloneDate(t.start),t.end.setDate(JC.f.maxDayOfMonth(t.start))}return t},window[v]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;if(e){n=e.replace(/[^\d]+/g,""),e=e.split("Q");if(n.length===8)return t.start=JC.f.parseISODate(n),t.end=t.start,t;if(n.length===16)return t.start=JC.f.parseISODate(n.slice(0,8)),t.end=JC.f.parseISODate(n.slice(8,16)),t;var r=parseInt(e[0],10),i=parseInt(e[1],10),s=JC.f.pureDate(new Date(e[0]),0,1),o=JC.f.pureDate(new Date(e[1]),0,1),u=JC.f.seasonOfYear(e[0]);$(u).each(function(e,n){if(n.season===i)return t.start=new Date,t.end=new Date,t.start.setTime(n.start),t.end.setTime(n.end),!1})}return t},window[m]=function(e){e=$.trim(e||"");var t={start:null,end:null},n;return e&&(e=e.replace(/[^\d]+/g,""),n=e.slice(0,4),t.start=new Date(n,0,1)),t.start||(t.start=new Date,t.end=new Date),t},t._model.calendarTypeEl().trigger("change",[!0])},_initDefaultData:function(){if(this._model.mcIgnoreUrlFill())return;var e=this,t=e._model.urlStartdate()||e._model.mddateEl().eq(0).val(),n=e._model.urlEnddate()||e._model.mddateEl().eq(1).val(),r=e._model.urlCalendarType()||e._model.calendarType();e._model.calendarTypeEl().val(r),e._model.updatemddateElProp(r),setTimeout(function(){e._model.setmddate(t,n),e._model.setHiddenStartdate(t),e._model.setHiddenEnddate(n)},200)},_inited:function(){}},e.getInstance=function(t,n){typeof t=="string"&&!/</.test(t)&&(t=$(t));if(!t||!t.length||typeof t=="string")return;return typeof n!="undefined"&&t.data(e.Model._instanceName,n),t.data(e.Model._instanceName)},e.isDMultiDate=function(e){var t;return e&&(e=$(e)).length&&(t=e.is("[DMultiDatelayout]")),t},BaseMVC.buildModel(e),e.Model._instanceName="DMultiDate",e.Model._inscount=1,e.Model._defaultMaxvalue="",e.Model._defaultMinvalue="",e.Model.prototype={init:function(){},disableDateLimit:function(){return this.boolProp("disabledatelimit")},lastIptBox:function(){return this._lastIptBox||(this._lastIptBox=JC.f.parentSelector(this.selector(),this.selector().attr("lastIptBox")),!this._lastIptBox&&(this._lastIptBox=$("sdfasefasdfasfsadfasdfsdf"))),this._lastIptBox},calendarTypeEl:function(){return this.selector().find(">select")},mcIgnoreUrlFill:function(){return this.boolProp("mdIgnoreUrlFill")},calendarType:function(){return this.calendarTypeEl().val()},mddateEl:function(){var e=this,t=e.attrProp("mddateEl")||".js_multidate";return e.selector().find(t)},setmddate:function(e,t){var n=this.mddateEl();e&&(e=JC.f.dateFormat(JC.f.dateDetect(e),n.eq(0).attr("dateformat"))),t&&(t=JC.f.dateFormat(JC.f.dateDetect(t),n.eq(1).attr("dateformat"))),n.eq(0).val(e),n.eq(1).val(t)},updatemddateElProp:function(t){var n=this,r=n.mddateEl();r.attr("multidate",t),t==="date"?r.removeAttr("dateparse").removeAttr("dateformat").removeAttr("fulldateformat"):(r.eq(0).attr("fulldateformat","{0}"),r.eq(1).attr("fulldateformat","{0}"),r.attr("dateformat",n.dateformartType(t)).attr("dateparse","parsedate"+t)),e.Model._defaultMinvalue?r.attr("minvalue",e.Model._defaultMinvalue):r.removeAttr("minvalue"),e.Model._defaultMaxvalue?r.attr("maxvalue",e.Model._defaultMaxvalue).attr("defaultdate",e.Model._defaultMaxvalue):r.removeAttr("maxvalue").removeAttr("defaultdate")},dateformartType:function(e){var t;switch(e){case"week":t="YYWWK";break;case"month":t="YY-MM";break;case"season":t="YYQYQ";break;case"year":t="YY";break;case"date":default:t=""}return t},hiddenStartdateEl:function(){var e=this,t=e.attrProp("mdstartdate")||".js_startdate";return e.selector().find(t)},hiddenEnddateEl:function(){var e=this,t=e.attrProp("mdenddate")||".js_enddate";return e.selector().find(t)},setHiddenStartdate:function(e){var t=this,n=e;e&&(e=JC.f.parseDate(e,t.mddateEl().first()),e&&(e=JC.f.dateFormat(e,t.hiddendateiso()?"":t.mddateEl().first().attr("dateformat"))),!e&&(e=n)),t.hiddenStartdateEl().val(e)},setHiddenEnddate:function(e){var t=this,n=e;e&&(e=JC.f.parseDate(e,t.mddateEl().first()),e&&(e=JC.f.dateFormat(e,t.hiddendateiso()?"":t.mddateEl().first().attr("dateformat"))),!e&&(e=n)),t.hiddenEnddateEl().val(e)},updateHiddenStartdate:function(){var e=this,t=e.mddateEl().eq(0).val();if(!t){e.setHiddenStartdate("");return}e.setHiddenStartdate(t)},updateHiddenEnddate:function(){var e=this,t=e.mddateEl().eq(1).val();if(!t){e.setHiddenEnddate("");return}e.setHiddenEnddate(t)},urlCalendarType:function(){var e=this;return e.decodedata(JC.f.getUrlParam(e.calendarTypeEl().attr("name")||"")||"").toLowerCase()},urlStartdate:function(){var e=this;return e.decodedata(JC.f.getUrlParam(e.hiddenStartdateEl().attr("name")||"")||"")},urlEnddate:function(){var e=this;return e.decodedata(JC.f.getUrlParam(e.hiddenEnddateEl().attr("name")||"")||"")},decodedata:function(e){e=e.replace(/[\+]/g," ");try{e=decodeURIComponent(e)}catch(t){}return e},dayrange:function(){return this.intProp("mddayrange")},weekrange:function(){return this.intProp("mdweekrange")},monthrange:function(){return this.intProp("mdmonthrange")},seasonrange:function(){return this.intProp("mdseasonrange")},yearrange:function(){return this.intProp("mdyearrange")},hiddendateiso:function(){return this.boolProp("hiddendateiso")}},BaseMVC.buildView(e),e.View.prototype={init:function(){return this}},BaseMVC.build(e,"Bizs"),$(document).ready(function(){JC.f.safeTimeout(function(){$(".js_autoDMultiDate").each(function(){new e($(this))})},null,"DMultiDatesdfasd",50)}),Bizs.DMultiDate})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);