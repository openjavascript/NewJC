(function(e,t){e("JC.NSlider",["JC.common","JC.BaseMVC"],function(){function n(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,n))return JC.BaseMVC.getInstance(e,n);JC.BaseMVC.getInstance(e,n,this),this._model=new n.Model(e);switch(this._model.direction()){case"vertical":this._view=new s(this._model,this);break;default:this._view=new i(this._model,this)}this._init()}function i(e,t){this._model=e,this._slider=t;var n=e.viewItemNum();this._itemspace=parseInt((e.width()-n*e.itemwidth())/n)}function s(e,t){this._model=e,this._slider=t;var n=e.viewItemNum();this._itemspace=parseInt((e.height()-n*e.itemheight())/n)}var e=$(document),t=$(window);JC.NSlider=n,n.init=function(e){var t=[];return e=$(e||document),e.length&&(e.hasClass("js_NSlider")?t.push(new n(e)):e.find("div.js_NSlider").each(function(){t.push(new n(this))})),t},JC.BaseMVC.build(n),JC.f.extendObject(n.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this,t=e._model,n=e._view,r=t.selector();e.on("inited",function(){var e=this;e._initControl(),e.on("cleartinterval",function(){e._model.clearInterval(),e._view.setPagePosition()}),e.on("cleartimeout",function(){e._model.clearTimeout()}),e._initAutoMove()})},_initControl:function(){this._initSliderNav();switch(this._model.direction()){case"vertical":this._initVerticalControl();break;default:this._initHorizontalControl()}},_initHorizontalControl:function(){var e=this,t=e._model;t.prevbutton()&&t.prevbutton().on("click",function(n){e.notification(r.PREVCLICK,[$(n),e]),e.trigger("cleartimeout"),e.trigger("movetoprev"),t._movelock?e._view.jpMove(t.jpPage(t.combClickNum(++t._combClickNum)),t.durationms()-t._passTime):(t.lockmove(),e._view.jpMove(t.jpPage(t._nowIndex,t.howmanyitem()))),t.changeIndex()}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")}),t.nextbutton()&&t.nextbutton().on("click",function(n){e.notification(r.PREVCLICK,[$(n),e]),e.trigger("cleartimeout"),e.trigger("movetonext"),t._movelock?e._view.jpMove(t.jpPage(t.combClickNum(++t._combClickNum)),t.durationms()-t._passTime):(t.lockmove(),e._view.jpMove(t.jpPage(t._nowIndex,t.howmanyitem()))),t.changeIndex()}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")})},_initVerticalControl:function(){var e=this,t=e._model;t.prevbutton()&&t.prevbutton().on("click",function(n){if(t._movelock)return;t.lockmove(),e.notification(r.PREVCLICK,[$(n),e]),e.trigger("cleartimeout"),e.trigger("movetoprev"),e._view.jpMove(t.jpPage(t._nowIndex,t.howmanyitem())),t.changeIndex()}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")}),t.nextbutton()&&e._model.nextbutton().on("click",function(n){if(t._movelock)return;t.lockmove(),e.notification(r.NEXTCLICK,[$(n),e]),e.trigger("cleartimeout"),e.trigger("movetonext"),e._view.jpMove(t.jpPage(t._nowIndex,t.howmanyitem())),t.changeIndex()}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")})},_initSliderNav:function(){var e=this,t=e._model;t._selector.on("click",".slide_navbtn",function(n){n.preventDefault();var r=$(n.target),i=parseInt(r.attr("data-index"));e._view.jpMove(t.itemRemote(t._nowIndex,i),undefined,!0),t.changeIndex(i)})},_initAutoMove:function(){var e=this,t=e._model;if(!e._model.automove())return;return e.on("beforemove",function(t){e.trigger("cleartimeout"),e.notification(r.BEFOREMOVE,[$(t),e])}),e.on("aftermove",function(n,i,s){e.notification(r.AFTERMOVE,[$(n),e]);if(t.controlover())return;e.trigger("automove")}),t._selector.on("mouseenter",function(t){e.trigger("cleartimeout"),e.trigger("mouseenter")}),t._selector.on("mouseleave",function(t){e.trigger("cleartimeout"),e.trigger("mouseleave"),e.trigger("automove")}),e.on("controlover",function(){e.trigger("cleartimeout"),e._model.controlover(!0)}),e.on("controlout",function(){e.trigger("automove"),t.controlover(!1)}),e.on("movetoprev",function(){t.moveDirection(!1)}),e.on("movetonext",function(){t.moveDirection(!0)}),t.automove&&$(e).on("automove",function(){var n=t.howmanyitem();e._model.timeout(setTimeout(function(){e._view.jpMove(t.jpPage(t._nowIndex,n)),t.changeIndex()},e._model.automovems()))}),e.trigger("automove"),this},_inited:function(){this.trigger("inited")}});var r=n.Model;return r.PREVCLICK="slidPrev",r.NEXTCLICK="slidNext",r.BEFOREMOVE="beforeMove",r.AFTERMOVE="afterMove",JC.f.extendObject(r.prototype,{init:function(){this._nowIndex=0,this._moveDirection=!0},prevbutton:function(){return this.selectorProp("sliderprev")},nextbutton:function(){return this.selectorProp("slidernext")},direction:function(){return this.attrProp("sliderdirection")||"horizontal"},moveDirection:function(e){return typeof e!="undefined"&&(this._moveDirection=e),this._moveDirection},howmanyitem:function(){return this.intProp("sliderhowmanyitem")||1},viewItemNum:function(){var e=Math.floor(this.direction()=="horizontal"?this.width()/this.itemwidth():this.height()/this.itemheight());return(this.viewItemNum=function(){return e})()},width:function(){var e=this.selector().width()||800;return(this.width=function(){return e})()},height:function(){var e=this.selector().height()||230;return(this.height=function(){return e})()},itemwidth:function(){var e=this.subitems().eq(0).width()||160;return(this.itemwidth=function(){return e})()},itemheight:function(){var e=this.subitems().eq(0).height()||230;return(this.itemheight=function(){return e})()},loop:function(){return this.boolProp("sliderloop")},stepms:function(){return this.intProp("sliderstepms")||10},durationms:function(){return this.intProp("sliderdurationms")||300},automovems:function(){return this.intProp("sliderautomovems")||2e3},automove:function(){return this.boolProp("sliderautomove")},defaultindex:function(){return this.intProp("sliderdefaultindex")||0},slidernav:function(){return this.attrProp("slidernav")},slidernavtype:function(){return this.attrProp("slidernavtype")||"icon"},subitems:function(){return this.selectorProp("slidersubitems")},pointer:function(e){return typeof this._pointer=="undefined"&&(this._pointer=this.defaultindex()),typeof e!="undefined"&&(this._pointer=0),this._pointer},page:function(e,t,n){this.clearInterval(),typeof t=="undefined"&&(t=0),typeof n=="undefined"?n=this.moveDirection():this.moveDirection(n);var r=[],i=this.subitems(),s=this.viewItemNum();n||(e-=t,e<0&&(e+=i.length));for(var o=0;o<s+t;o++,e++)e==i.length&&(e=0),r.push(i[e]);return this._remoteItemList=r},jpPage:function(e,t,n){this.clearInterval();var r=this.subitems(),i=this._nowIndex;typeof t=="undefined"&&(t=this.howmanyitem()),typeof n=="undefined"?n=this.moveDirection():this.moveDirection(n),n?i+=this.viewItemNum():(i-=t,i<0&&(i+=r.length));for(var s=0,o=i;s<t;s++,o++)o==r.length&&(o=0),n?this._remoteItemList[this._remoteItemList.length-1]!=r[o]&&this._remoteItemList.push(r[o]):this._remoteItemList[0]!=r[o]&&this._remoteItemList.unshift(r[o]);return console.log(this._remoteItemList),this._remoteItemList},remoteIndex:function(e){return typeof e=="undefined"?this._remoteIndex||0:this._remoteIndex=e},itemRemote:function(e,t){if(t==e)return;var n=t-e;return this.jpPage(e,Math.abs(n),n>=0)},changeIndex:function(e){var t=typeof e=="undefined"?this._nowIndex:e,n=t,r,i;return typeof e=="undefined"&&(r=this.howmanyitem(),i=this.subitems(),this.moveDirection()?(n+=r,n>=i.length&&(n-=i.length)):(n-=r,n<0&&(n+=i.length))),this._nowIndex=n,this.changeRemoteNav(n),t},changeRemoteNav:function(e){var t=this._selector,n=t.find(".slide_on");if(this.slidernav()=="group"){var r=this.viewItemNum(),i=parseInt(n.attr("data-index"));if(i+r-1>e&&e>i)return;n.removeClass("slide_on"),t.find(".slide_navbtn[data-index="+(e-e%r)+"]").addClass("slide_on")}else n.removeClass("slide_on"),t.find(".slide_navbtn[data-index="+e+"]").addClass("slide_on")},interval:function(e){return typeof e!="undefined"&&(this._interval=e),this._interval},clearInterval:function(){this.interval()&&clearInterval(this.interval())},timeout:function(e){return typeof e!="undefined"&&(this._timeout=e),this._timeout},clearTimeout:function(){this.timeout()&&clearTimeout(this.timeout())},controlover:function(e){return typeof e!="undefined"&&(this._controlover=e),this._controlover},lockmove:function(){this._movelock=!0,this.combClickNum(0)},unlockmove:function(){this._movelock=!1},combClickNum:function(e){return typeof e=="undefined"?this._combClickNum:this._combClickNum=e}}),i.prototype={init:function(){return this.setPagePosition(this._model.pointer()),this._initSliderNav(this._model.slidernav()),this},_initSliderNav:function(e){if(!e)return;var t=this._model,n="",r=t.slidernavtype(),i=t.viewItemNum(),s=t.subitems().length;s=e=="group"?s/i:s,n+='<div class="hslide_nav">';for(var o=0;o<s;o++)n+=JC.f.printf('<a href="#" class="slide_navbtn {0} {1}" data-index="{2}">{3}</a>',o==0?"slide_on":"",r=="num"?"hslide_navnum":"hslide_navicon",e=="group"?o*i:o,o+1);n+="</div>",t._selector.append(n)},jpMove:function(e,t,n){if(!e||e.length==0)return;typeof t=="undefined"&&(t=this._model.durationms());var r=this,i=this._model,s=i.moveDirection(),o=i.howmanyitem(),u=i.itemwidth()+r._itemspace,a=e.length,f,l,c,h,p=0;if(s)l=$(e[0]).prop("offsetLeft"),$.each(e,function(e,t){c=$(t),a-e<=o?c.css({left:l+(n?++p:e)*u+"px"}).show():c.show(),c.data("TMP_LEFT",c.prop("offsetLeft"))}),f=$(e[a-1]).prop("offsetLeft")-i.width()+u;else{l=$(e[a-1]).prop("offsetLeft");for(var d=a-1;d>=0;d--)c=$(e[d]),d<o?c.css({left:l-(n?o-p++:a-d-1)*u+"px"}).show():c.show(),c.data("TMP_LEFT",c.prop("offsetLeft"));f=Math.abs($(e[0]).prop("offsetLeft"))}$(r._slider).trigger("beforemove");var v=i._passTime||0;i.interval(JC.f.easyEffect(function(t,n,r){i._passTime=v+r,$(e).each(function(e,n){if(!n)return;c=$(n),h=c.data("TMP_LEFT"),s?(h-=t,c.css({left:h+"px"}),h<=-u&&(c.hide(),n={},i._remoteItemList.shift())):(h+=t,c.css({left:h+"px"}),h>=i.width()&&(c.hide(),n={},i._remoteItemList.pop()))}),n&&(i.unlockmove(),i._passTime=0)},f,0,t,this._model.stepms())),$(r._slider).trigger("aftermove")},setPagePosition:function(e){typeof e=="undefined"&&(e=this._model.initIndex()),this._model.subitems().hide();var t=this._model.page(e);for(var n=0,r=t.length;n<r;n++)$(t[n]).css({left:n*(this._model.itemwidth()+this._itemspace)+"px"}).show()}},s.prototype={init:function(){return this.setPagePosition(this._model.pointer()),this._initSliderNav(this._model.slidernav()),this},_initSliderNav:function(e){if(e=="")return;var t=this._model,n="",r=t.slidernavtype(),i=t.subitems().length;i=e=="group"?i/_viewItemNum:i,n+='<div class="vslide_nav">';for(var s=0;s<i;s++)n+=JC.f.printf('<a href="#" class="slide_navbtn {0} {1}" data-index="{2}">{3}</a>',s==0?"slide_on":"",r=="num"?"vslide_navnum":"vslide_navicon",e=="group"?s*_viewItemNum:s,s+1);n+="</div>",t._selector.append(n)},moveTo:function(e){if(!e||e.length==0)return;var t=this,n=this._model,r=n.howmanyitem(),i=n.moveDirection(),s=r*(n.itemheight()+t._itemspace),o,u=0,a,f=[];if(i)a=this._model.height(),$.each(e,function(n,i){o=$(i),e.length-n<=r&&(o.css({top:a+u*(t._model.itemheight()+t._itemspace)+"px"}).show(),u++),n<r&&f.push(o),o.data("TMP_TOP",$(i).prop("offsetTop"))});else{a=-(t._model.itemheight()+t._itemspace);var l=e.length,c;for(var h=l-1;h>=0;h--)o=$(e[h]),h<r&&(o.css({top:a-u*(t._model.itemheight()+t._itemspace)+"px"}).show(),u++),e.length-h<=r&&f.push(o),o.data("TMP_TOP",o.prop("offsetTop"))}$(t._slider).trigger("beforemove"),t._model.interval(JC.f.easyEffect(function(t,r){$(e).each(function(e,n){$(n).css({top:$(n).data("TMP_TOP")+(i?-t:t)+"px"})}),r&&($.each(f,function(e,t){$(t).hide()}),n.unlockmove())},s,0,this._model.durationms(),this._model.stepms())),$(t._slider).trigger("aftermove")},setPagePosition:function(e){typeof e=="undefined"&&(e=this._model.initIndex()),this._model.subitems().hide();var t=this._model.page(e);for(var n=0,r=t.length;n<r;n++)$(t[n]).css({top:n*(this._model.itemheight()+this._itemspace)+"px"}).show()}},e.ready(function(){$(".js_NSlider").each(function(e,t){new n(t)})}),JC.NSlider})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);