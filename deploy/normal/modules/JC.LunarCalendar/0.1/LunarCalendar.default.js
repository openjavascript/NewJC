(function(e,t){e("JC.LunarCalendar.default",["JC.BaseMVC"],function(){function e(r,i){r&&(r=$(r)),(!r||!r.length)&&(r=$(document.body)),!i&&(i=new Date);if(JC.BaseMVC.getInstance(r,e))return JC.BaseMVC.getInstance(r,e);JC.BaseMVC.getInstance(r,e,this),JC.log("LunarCalendar.constructor"),this._model=new n(r,i),this._view=new t(this._model),this._init()}function t(e){this._model=e,this.layout}function n(e,t){this.container=e,this.date=t,this.tpl,this.dateObj,this._titleObj={},this.hideControl}JC.LunarCalendar=window.LunarCalendar=e,e.Model=n,e.View=t,e.tpl,e.autoInit=!0,e.defaultYearSpan=20,e.getSelectedItemGlobal=function(){var e;return $("div.UXCLunarCalendar table.UTableBorder td.cur a").each(function(){var t=$(this).attr("date"),n=new Date;return n.setTime(t),e={date:n,item:$(this),td:$(this).parent("td")},!1}),e||$("div.UXCLunarCalendar table.UTableBorder td.today a").each(function(){var t=$(this).attr("date"),n=new Date;return n.setTime(t),e={date:n,item:$(this),td:$(this).parent("td")},!1}),e},e.init=function(t){var n=[];return t=$(t||document),t&&t.length&&(t.hasClass("js_LunarCalendar")?n.push(new e(t)):t.find("div.js_LunarCalendar, td.js_LunarCalendar, li.js_LunarCalendar").each(function(){n.push(new e(this))})),n},e.getSelectedDateGlobal=function(){var t,n=e.getSelectedItemGlobal();return n&&n.date&&(t=n.date),t},e.getItemByTimestamp=function(e){var t,n;return e&&(e+="",e.length<13&&(e+=(new Array(13-e.length+1)).join("0")),$("div.UXCLunarCalendar table.UTableBorder td a[date="+e+"]").each(function(){n=$(this).parent("td");if(!n.hasClass("unable"))return t=n,!1})),t},e.workday=function(e,t){e=$(e),typeof t!="undefined"?(t&&e.removeClass("xiuxi").addClass("shangban"),!t&&e.removeClass("shangban")):e.removeClass("xiuxi").addClass("shangban")},e.isWorkday=function(e){return e=$(e),e.hasClass("shangban")},e.holiday=function(e,t){e=$(e),typeof t!="undefined"?(t&&e.addClass("xiuxi").removeClass("shangban"),!t&&e.removeClass("xiuxi")):e.addClass("xiuxi").removeClass("shangban")},e.isHoliday=function(e){return e=$(e),e.hasClass("xiuxi")},e.comment=function(t,n){var r;t=$(t),typeof n=="string"&&(r=n),typeof r!="undefined"?(t.addClass("zhushi"),e.commentTitle(t,r),t.find("a").attr("comment",r)):(t.removeClass("zhushi"),t.find("a").removeAttr("comment"),e.commentTitle(t))},e.isComment=function(e){return e=$(e),e.hasClass("zhushi")},e.getComment=function(e){var t="";return e&&e.length&&(t=e.find("a").attr("comment")||""),t},e.commentSeparator="==========comment==========",e.commentTitle=function(t,n){var r=t.find("a"),i=r.is("[datatitle]");n?(n=e.commentSeparator+"\n"+n,i&&(n=r.attr("datatitle")+"\n"+n),r.attr("title",n)):i?r.attr("title",r.attr("datatitle")):r.removeAttr("title")},e.updateStatus=function(t){if(!t)return;$("div.UXCLunarCalendar").each(function(){var n=$(this),r=JC.BaseMVC.getInstance(n,e),i,s=0,o=3e12;r.getContainer().is("[nopreviousfestivals]")&&(s=(new Date(r.getDate().getFullYear(),r.getDate().getMonth(),1)).getTime()),r.getContainer().is("[nonextfestivals]")&&(o=(new Date(r.getDate().getFullYear(),r.getDate().getMonth()+1,1)).getTime());var u,a,f,l,c;for(var u in t){a=t[u],f=u+"",f.length<13&&(f+=(new Array(13-f.length+1)).join("0"));if(!(f>=s&&f<o))continue;l=n.find("table.UTableBorder td > a[date="+f+"]");if(!l.length)continue;c=l.parent("td");if("dayaction"in a)switch(a.dayaction){case 1:e.workday(c);break;case 2:e.holiday(c);break;default:e.workday(c,0),e.holiday(c,0)}"comment"in a&&e.comment(c,a.comment)}})},e.prototype={_init:function(){var e=this;return $([e._view,e._model]).on("BindEvent",function(t,n,r){e.on(n,r)}),$([e._view,e._model]).on("TriggerEvent",function(t,n){var r=JC.f.sliceArgs(arguments).slice(2);e.trigger(n,r)}),e.on("CLCSelectedItem",function(t,n,r,i){e._model.clcSelectedItemCb()&&e._model.clcSelectedItemCb().call(e,n,r,i)}),e._model.init(),e._view.init(),e._view.layout.data(n._instanceName,e),this},update:function(e){if(!e)return;this._view.initLayout(e)},nextMonth:function(){var e=this._model.getDate().date;e.setMonth(e.getMonth()+1),this._view.initLayout(e)},preMonth:function(){var e=this._model.getDate().date;e.setMonth(e.getMonth()-1),this._view.initLayout(e)},nextYear:function(){var e=this._model.getDate().date;e.setFullYear(e.getFullYear()+1),this._view.initLayout(e)},preYear:function(){var e=this._model.getDate().date;e.setFullYear(e.getFullYear()-1),this._view.initLayout(e)},getDate:function(){return this._model.getDate().date},getAllDate:function(){return this._model.getDate()},getSelectedDate:function(){var e;return this._view.layout.find("td.cur a").each(function(){var t=$(this).attr("date");return e=new Date,e.setTime(t),!1}),e||this._view.layout.find("td.today a").each(function(){var t=$(this).attr("date");return e=new Date,e.setTime(t),!1}),e},getContainer:function(){return this._model.container},getLayout:function(){return this._view.layout},isHideControl:function(){return this._model.hideControl},on:function(e,t){return $(this).on(e,t),this},trigger:function(e,t){return $(this).trigger(e,t),this}},t.prototype={init:function(){return this.layout=this._model.layout,this.initLayout(),this},initLayout:function(e){var t=this._model.getDate();e&&(t.date=e),this.layout.find("table.UTableBorder tbody").html(""),this.initYear(t),this.initMonth(t),this.initMonthDate(t)},initYear:function(e){this.layout.find("button.UYear").html(e.date.getFullYear())},initMonth:function(e){this.layout.find("button.UMonth").html(e.date.getMonth()+1+"月")},initMonthDate:function(t){var n=this,r=this.layout,i=JC.f.maxDayOfMonth(t.date),s=t.date.getDay()||7,o=s+i,u=6,a=[],f,l,c,h,p,d=JC.f.cloneDate(t.date);d.setDate(1);var v=d.getDay()||7;v<2?d.setDate(-(v-1+6)):d.setDate(-(v-2)),t.beginDate=JC.f.cloneDate(d);var m=new Date;a.push("<tr>");for(h=1;h<=42;h++){p=[],(d.getDay()===0||d.getDay()==6)&&p.push("weekend"),JC.f.isSameMonth(t.date,d)||p.push("other"),t.minvalue&&d.getTime()<t.minvalue.getTime()&&p.push("unable"),t.maxvalue&&d.getTime()>t.maxvalue.getTime()&&p.push("unable");var g=e.gregorianToLunar(d),y=e.getFestivals(g,d),b=0,w=3e12,E=d.getTime(),S=[d.getFullYear(),"年 ",d.getMonth()+1,"月 ",d.getDate(),"日","\n"];S.push("农历 ",g.yue,g.ri),S.push(" ",g.ganzhi,"【",g.shengxiao,"】年");if(y&&y.festivals.length){var x=[];$.each(y.festivals,function(e,t){t.fullname&&(x=x.concat(t.fullname.split(/[\s]+/)))}),x.length&&(S.push("\n节日: "),S.push(x.join(", ")))}this._model.container.is("[nopreviousfestivals]")&&(b=(new Date(t.date.getFullYear(),t.date.getMonth(),1)).getTime()),this._model.container.is("[nonextfestivals]")&&(w=(new Date(t.date.getFullYear(),t.date.getMonth()+1,1)).getTime()),E>=b&&E<w?(y.isHoliday&&(p.push("festival"),p.push("xiuxi")),y.isWorkday&&p.push("shangban")):(p.push("nopointer"),p.push("unable")),this._model.title(d.getTime(),S.join("")),JC.f.isSameDay(m,d)&&p.push("today"),a.push('<td class="',p.join(" "),'">','<a href="javascript:" date="',d.getTime(),'">',"<b>",d.getDate(),"</b>","<label>",y.dayName,"</label><div></div></a></td>"),d.setDate(d.getDate()+1),h%7===0&&h!=42&&a.push("</tr><tr>")}a.push("</tr>"),d.setDate(d.getDate()-1),t.endDate=JC.f.cloneDate(d),r.find("table.UTableBorder tbody").html($(a.join(""))).find("td").each(function(){n.addTitle($(this))}),this.hideControl(),JC.log(l,f,i,s,o,u)},addTitle:function(e){var t=e.find("a"),n=t.attr("date"),r=this._model.title(n);t.attr("title",r).attr("datatitle",r)},hideControl:function(){this._model.hideControl&&(this.layout.find("select, button.UPreYear, button.UPreMonth, button.UNextMonth, button.UNextYear").hide(),this.layout.find("table.UHeader").addClass("nopointer"))}},n._insCount=1,e.Model._instanceName="LunarCalendar",n.prototype={init:function(){return this.date=this.clcDate(),JC.log(this.date),this.tpl=JC.f.printf(JC.LunarCalendar.tpl||r,n._insCount++),this.container.is("[hidecontrol]")&&(this.container.attr("hidecontrol")?this.hideControl=JC.f.parseBool(this.container.attr("hidecontrol")):this.hideControl=!0),this.layout=$(this.tpl),this.layout.appendTo(this.container),this},title:function(e,t){if(!e&&!t){this._titleObj={};return}return t&&(this._titleObj[e]=t),this._titleObj[e]},getDate:function(){if(this.dateObj)return this.dateObj;var e=this.container,t={date:0,minvalue:0,maxvalue:0},n;return(n=JC.f.dateDetect(e.attr("defaultdate")))?t.date=n:t.date=this.date||new Date,t.minvalue=JC.f.dateDetect(e.attr("minvalue")),t.maxvalue=JC.f.dateDetect(e.attr("maxvalue")),t.date&&(t.data=JC.f.pureDate(t.date)),t.minvalue&&(t.minvalue=JC.f.pureDate(t.minvalue)),t.maxvalue&&(t.maxvalue=JC.f.pureDate(t.maxvalue)),this.dateObj=t},setDate:function(e){var t=new Date,n="-";t.setTime(e)},setSelectedDate:function(){var e;return e=this.getLayout().find("table td.cur a"),e.parent("td").hasClass("unable")?0:(e&&e.length&&e.attr("date")&&this.setDate(e.attr("date")),1)},clcSelectedItemCb:function(){var e=JC.LunarCalendar.clcSelectedItemCb;return this.selector().attr("clcSelectedItemCb")&&(e=window[this.selector().attr("clcSelectedItemCb")]||e),e},clcDate:function(){var e=this.date;return this.selector().attr("clcDate")&&(e=JC.f.dateDetect(this.selector().attr("clcDate"))||e)&&(e=JC.f.pureDate(e)),e},selector:function(){return this.container}};var r=['<div id="UXCLunarCalendar_{0}" class="UXCLunarCalendar">\n','    <div class="UXCLunarCalendar_wrapper">\n','<table class="UHeader">\n',"    <tbody>\n","        <tr>\n",'            <td class="ULeftControl">\n','                <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>\n','                <button type="button" class="UButton UPreMonth">&nbsp;&lt;&nbsp;</button>\n',"            </td>\n",'            <td class="UMidControl">\n','                <button type="button" class="UButton UYear">2013</button>\n','                <select class="UYearList">\n',"                </select>\n",'                <button type="button" class="UButton UMonth">1月</button>\n','                <select class="UMonthList">\n',"                    <option value='0'>一月</option>\n","                    <option value='1'>二月</option>\n","                    <option value='2'>三月</option>\n","                    <option value='3'>四月</option>\n","                    <option value='4'>五月</option>\n","                    <option value='5'>六月</option>\n","                    <option value='6'>七月</option>\n","                    <option value='7'>八月</option>\n","                    <option value='8'>九月</option>\n","                    <option value='9'>十月</option>\n","                    <option value='10'>十一月</option>\n","                    <option value='11'>十二月</option>\n","                </select>\n","            </td>\n",'            <td class="URightControl">\n','                <button type="button" class="UButton UNextMonth">&nbsp;&gt;&nbsp;</button>\n','                <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>\n',"            </td>\n","        </tr>\n","    </tbody>\n","</table>\n",'        <table class="UTable UTableThead">\n',"            <thead>\n","                <tr>\n","                    <th>一</th>\n","                    <th>二</th>\n","                    <th>三</th>\n","                    <th>四</th>\n","                    <th>五</th>\n",'                    <th class="weekend">六</th>\n','                    <th class="weekend">日</th>\n',"                </tr>\n","            </thead>\n","       </table>\n",'       <table class="UTable UTableBorder">\n',"            <tbody>\n","                <!--<tr>\n",'                    <td class="unable"><a href="#"><b>1</b><label>两字</label></a></td>\n','                    <td class="unable cur"><a href="#"><b>2</b><label>两字</label></a></td>\n','                    <td class="unable"><a href="#"><b>33</b><label>两字</label></a></td>\n','                    <td class="unable"><a href="#"><b>44</b><label>两字</label></a></td>\n','                    <td class="unable"><a href="#"><b>5</b><label>两字</label></a></td>\n','                    <td class="weekend shangban cur"><a href="#"><b>6</b><label>两字</label></a></td>\n','                    <td class="weekend"><a href="#"><b>7</b><label>两字</label></a></td>\n',"                </tr>-->\n","            </tbody>\n","        </table>\n","    </div>\n","</div>\n"].join("");return $(document).delegate("div.UXCLunarCalendar button.UPreYear","click",function(){var t=$(this),n=t.parents("div.UXCLunarCalendar");if(!n.length)return;var r=JC.BaseMVC.getInstance(n,e);r&&r.preYear()}),$(document).delegate("div.UXCLunarCalendar button.UPreMonth","click",function(){var t=$(this),n=t.parents("div.UXCLunarCalendar");if(!n.length)return;var r=JC.BaseMVC.getInstance(n,e);r&&r.preMonth()}),$(document).delegate("div.UXCLunarCalendar button.UNextMonth","click",function(){var t=$(this),n=t.parents("div.UXCLunarCalendar");if(!n.length)return;var r=JC.BaseMVC.getInstance(n,e);r&&r.nextMonth()}),$(document).delegate("div.UXCLunarCalendar button.UNextYear","click",function(){var t=$(this),n=t.parents("div.UXCLunarCalendar");if(!n.length)return;var r=JC.BaseMVC.getInstance(n,e);r&&r.nextYear()}),$(document).delegate("div.UXCLunarCalendar button.UYear","click",function(t){t.stopPropagation();var n=$(this),r=n.parents("div.UXCLunarCalendar");if(!r.length)return;var i=JC.BaseMVC.getInstance(r,e);if(i.isHideControl())return;var s=i.getDate(),o=s.getFullYear(),u=s.getFullYear()-e.defaultYearSpan,a=s.getFullYear()+e.defaultYearSpan,f=[],l="";$("div.UXCLunarCalendar select").hide();for(;u<a;u++)u===o?l=" selected ":l="",f.push('<option value="',u,'"',l,">",u,"</option>");var c=e.defaultYearSpan/2*18;i.getLayout().find("select.UYearList").html(f.join("")).show().prop("size",20).scrollTop(c)}),$(document).delegate("div.UXCLunarCalendar button.UMonth","click",function(t){t.stopPropagation();var n=$(this),r=n.parents("div.UXCLunarCalendar");if(!r.length)return;var i=JC.BaseMVC.getInstance(r,e);if(!i)return;if(i.isHideControl())return;var s=i.getDate(),o=s.getFullYear();$("div.UXCLunarCalendar select").hide(),i.getLayout().find("select.UMonthList").val(s.getMonth()).prop("size",12).show()}),$(document).delegate("div.UXCLunarCalendar select.UYearList","change",function(){var t=$(this),n=t.parents("div.UXCLunarCalendar"),r,i;r=JC.BaseMVC.getInstance(n,e);if(!r)return;i=r.getDate(),i.setFullYear(t.val()),r.update(i)}),$(document).delegate("div.UXCLunarCalendar select.UMonthList","change",function(){var t=$(this),n=t.parents("div.UXCLunarCalendar"),r,i;r=JC.BaseMVC.getInstance(n,e);if(!r)return;i=r.getDate(),i.setMonth(t.val()),r.update(i)}),$(document).delegate("div.UXCLunarCalendar table.UTableBorder td","click",function(){var t=$(this),n=t.parents("div.UXCLunarCalendar");if(!n.length)return;if(t.hasClass("unable"))return;var r=t.find("> a"),i=r.attr("date"),s=JC.BaseMVC.getInstance(n,e),o;if(!i||!s)return;o=new Date,o.setTime(i);var u=0,a=3e12;s.getContainer().is("[nopreviousfestivals]")&&(u=(new Date(s.getDate().getFullYear(),s.getDate().getMonth(),1)).getTime()),s.getContainer().is("[nonextfestivals]")&&(a=(new Date(s.getDate().getFullYear(),s.getDate().getMonth()+1,1)).getTime()),i>=u&&i<a&&($("div.UXCLunarCalendar table.UTableBorder td.cur").removeClass("cur"),t.addClass("cur"),s.trigger("CLCSelectedItem",[o,t,r]))}),$(document).on("click",function(){$("div.UXCLunarCalendar select").hide()}),$(document).ready(function(t){e.autoInit&&JC.f.safeTimeout(function(){e.init()},null,"INITLunarCalendar",100)}),JC.LunarCalendar})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);