(function(e,t){e("JC.Slider",["JC.common"],function(){function e(i){i&&(i=$(i));if(e.getInstance(i))return e.getInstance(i);e.getInstance(i,this),JC.log("Slider constructor",(new Date).getTime()),this._model=new t(i);switch(this._model.direction()){case"vertical":this._view=new r(this._model,this);break;default:this._view=new n(this._model,this)}this._init()}function t(e){this._layout=e,this._moveDirection=!0,this._interval,this._timeout,this._init()}function n(e,t){this._model=e,this._slider=t,this._itemspace=(this._model.width()-Math.floor(this._model.width()/this._model.itemwidth())*this._model.itemwidth())/(this._model.totalpage()-1),this._itemspace=parseInt(this._itemspace),this._init()}function r(e,t){this._model=e,this._slider=t,this._itemspace=0,this._init()}return window.Slider=JC.Slider=e,e.prototype={_init:function(){var e=this;return e._initControl(),e.on("cleartinterval",function(){e._model.clearInterval(),e._view.setPagePosition()}),e.on("cleartimeout",function(){e._model.clearTimeout()}),e._initAutoMove(),e._model.initedcb()&&e.on("inited",e._model.initedcb()),e.trigger("inited"),this},on:function(e,t){return $(this).on(e,t),this},trigger:function(e){return $(this).trigger(e),this},move:function(e){return this._view.move(e),this},moveTo:function(e){return this._view.moveTo(e),this},totalpage:function(){return this._model.totalpage()},pointer:function(){return this._model.pointer()},page:function(e){return this._model.page(e)},layout:function(){return this._model.layout()},find:function(e){return this._model.layout().find(e)},_initControl:function(){switch(this._model.direction()){case"vertical":this._initVerticalControl();break;default:this._initHorizontalControl()}},_initHorizontalControl:function(){var e=this;e._model.leftbutton()&&e._model.leftbutton().on("click",function(t){e.trigger("cleartimeout"),e.trigger("movetoleft"),e._view.move(1)}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")}),e._model.rightbutton()&&e._model.rightbutton().on("click",function(t){e.trigger("cleartimeout"),e.trigger("movetoright"),e._view.move()}).on("mouseenter",function(){e.trigger("controlover")}).on("mouseleave",function(){e.trigger("controlout")})},_initVerticalControl:function(){var e=this},_initAutoMove:function(){var e=this;if(!e._model.automove())return;return e.on("beforemove",function(t,n,r){e.trigger("cleartimeout")}),e.on("movedone",function(t,n,r){if(e._model.controlover())return;e.trigger("automove")}),e._model.layout().on("mouseenter",function(t){e.trigger("cleartimeout"),e.trigger("mouseenter")}),e._model.layout().on("mouseleave",function(t){e.trigger("cleartimeout"),e.trigger("mouseleave"),e._view.setPagePosition(),e.trigger("automove")}),e.on("controlover",function(){e.trigger("cleartimeout"),e._model.controlover(!0)}),e.on("controlout",function(){e.trigger("automove"),e._model.controlover(!1)}),e.on("movetoleft",function(){e._model.moveDirection(!1)}),e.on("movetoright",function(){e._model.moveDirection(!0)}),$(e).on("automove",function(){e._model.timeout(setTimeout(function(){e._view.moveTo(e._model.automoveNewPointer())},e._model.automovems()))}),e.trigger("automove"),this}},e.autoInit=!0,e.init=function(t){var n=[];t&&(t=$(t));if(t&&t.length)if(e.isSlider(t)){if(e.getInstance(t))return[e.getInstance(t)];n.push(new e(t))}else t.find("div.js_autoSlider, dl.js_autoSlider, ul.js_autoSlider, ol.js_autoSlider").each(function(){if(e.isSlider(this)){if(e.getInstance($(this))){n.push(e.getInstance($(this)));return}n.push(new e($(this)))}});return n},e.getInstance=function(e,t){return t&&e&&$(e).data("SliderIns",t),e?$(e).data("SliderIns"):null},e.isSlider=function(e){return e&&(e=$(e)),e&&(e.is("[sliderwidth]")||e.is("[sliderheight]"))},t.prototype={_init:function(){return this.subitems(),this.totalpage(),JC.log(JC.f.printf("w:{0}, h:{1}, iw:{2}, ih:{3}, dr:{4}, si:{6}, hi:{5}, totalpage:{7}",this.width(),this.height(),this.itemwidth(),this.itemheight(),this.direction(),this.howmanyitem(),this.subitems().length,this.totalpage())),this},layout:function(){return this._layout},leftbutton:function(){return this._layout.is("[sliderleft]")?$(this._layout.attr("sliderleft")):null},rightbutton:function(){return this._layout.is("[sliderright]")?$(this._layout.attr("sliderright")):null},direction:function(){return this._layout.attr("sliderdirection").toLowerCase()||"horizontal"},moveDirection:function(e){return typeof e!="undefined"&&(this._moveDirection=e),JC.log("moveDirection",this._moveDirection),this._moveDirection},howmanyitem:function(){return parseInt(this._layout.attr("sliderhowmanyitem"),10)||1},width:function(){return parseInt(this._layout.attr("sliderwidth"),10)||800},height:function(){return parseInt(this._layout.attr("sliderheight"),10)||230},itemwidth:function(){return parseInt(this._layout.attr("slideritemwidth"),10)||160},itemheight:function(){return parseInt(this._layout.attr("slideritemheight"),10)||230},loop:function(){return JC.f.parseBool(this._layout.attr("sliderloop"))},stepms:function(){return parseInt(this._layout.attr("sliderstepms"),10)||10},durationms:function(){return parseInt(this._layout.attr("sliderdurationms"),10)||300},automovems:function(){return parseInt(this._layout.attr("sliderautomovems"),10)||2e3},automove:function(){return JC.f.parseBool(this._layout.attr("sliderautomove"))},defaultpage:function(){return parseInt(this._layout.attr("sliderdefaultpage"),10)||0},subitems:function(){return this._layout.is("[slidersubitems]")?this._subitems=this._layout.find(this._layout.attr("slidersubitems")):this._subitems=this._layout.children(),this._subitems},totalpage:function(){return this.subitems(),this.howmanyitem()>1?this._totalpage=Math.ceil(this._subitems.length/this.howmanyitem()):this._totalpage=this._subitems.length,this._totalpage},page:function(e){this.subitems(),!e&&(e=0),e<0&&(e=0),e>=this.totalpage()&&(e=this.totalpage()-1),e*=this.howmanyitem();var t=[];for(var n=e,r=0;r<this.howmanyitem()&&n<this._subitems.length;n++,r++)t.push($(this._subitems[n]));return t},pointer:function(e){return typeof this._pointer=="undefined"&&(this._pointer=this.defaultpage()),typeof e!="undefined"&&(this._pointer=this.fixpointer(e)),this._pointer},newpointer:function(e){var t=this.pointer();return e&&t--,!e&&t++,t=this.fixpointer(t),t},fixpointer:function(e){var t=e;return this.loop()?(t<0&&(t=this.totalpage()-1),t>=this.totalpage()&&(t=0)):(t<0&&(t=0),t>=this.totalpage()&&(t=this.totalpage()-1)),t},automoveNewPointer:function(){var e=this.pointer();return this.moveDirection()?e++:e--,this.loop()?e>=this.totalpage()?e=0:e<0&&(e=this.totalpage()-1):e>=this.totalpage()?(e=this.totalpage()-2,this.moveDirection(!1)):e<0&&(e=1,this.moveDirection(!0)),e},interval:function(e){return typeof e!="undefined"&&(this._interval=e),this._interval},clearInterval:function(){this.interval()&&clearInterval(this.interval())},timeout:function(e){return typeof e!="undefined"&&(this._timeout=e),this._timeout},clearTimeout:function(){this.timeout()&&clearTimeout(this.timeout())},controlover:function(e){return typeof e!="undefined"&&(this._controlover=e),this._controlover},initedcb:function(){return this._layout.is("[sliderinitedcb]")&&window[this._layout.attr("sliderinitedcb")]&&(this._initedcb=window[this._layout.attr("sliderinitedcb")]),this._initedcb}},n.prototype={_init:function(){return this.setPagePosition(this._model.pointer()),this},move:function(e){var t=this;e=!!e,JC.log("HorizontalView move, is backwrad",e,this._model.pointer());var n=this._model.newpointer(e);JC.log(JC.f.printf("is backwrad: {0}, pointer:{1}, new pointer:{2}",e,this._model.pointer(),n)),this.moveTo(n)},moveTo:function(e){var t=this;if(!this._model.loop()){if(e<=this._model.pointer()&&this._model.pointer()===0){$(this._slider).trigger("outmin");return}if(e>=this._model.pointer()&&this._model.pointer()>=this._model.totalpage()-1){$(this._slider).trigger("outmax");return}}e=this._model.fixpointer(e);var n=this._model.pointer();if(e===n)return;var r=this._model.page(n),i=this._model.page(e),s=r.concat(i);this._setNewPagePosition(r,i,n,e),t._model.pointer(e)},_setNewPagePosition:function(e,t,n,r){var i=this,s,o=e.concat(t),u;$(this._slider).trigger("cleartinterval"),n<r?s=this._model.width()+this._itemspace:(s=-(this._model.width()+this._itemspace),u=!0),n===i._model.totalpage()-1&&r===0&&(s=this._model.width()+this._itemspace,u=!1),n===0&&r===i._model.totalpage()-1&&(s=-(this._model.width()+this._itemspace),u=!0),$.each(t,function(e,t){var n=$(t);n.css({left:s+i._model.itemwidth()*e+i._itemspace*e+"px"}),n.show()}),$(i._slider).trigger("beforemove",[n,r]),$.each(o,function(e,t){t.data("TMP_LEFT",t.prop("offsetLeft"))}),JC.log("zzzzzzzzzz",s,this._itemspace,this._model.moveDirection()),i._model.interval(JC.f.easyEffect(function(t,s){$(o).each(function(e,n){n.css({left:n.data("TMP_LEFT")+(u?t:-t)+"px"})}),s&&($(e).each(function(e,t){t.hide()}),$(i._slider).trigger("movedone",[n,r]),i._model.pointer(r),i.setPagePosition())},this._model.width(),0,this._model.durationms(),this._model.stepms()))},setPagePosition:function(e){JC.log("view setPagePosition",(new Date).getTime()),typeof e=="undefined"&&(e=this._model.pointer()),this._model.subitems().hide();var t=this._model.page(e);for(var n=0,r=t.length;n<r;n++)t[n].css({left:n*this._model.itemwidth()+n*this._itemspace+"px"}).show();JC.log(t.length)}},r.prototype={_init:function(){return this.setPagePosition(this._model.pointer()),this},move:function(e){var t=this;return this},moveTo:function(e){var t=this;return this},_setNewPagePosition:function(e,t,n,r){var i=this,s,o=e.concat(t),u;return this},setPagePosition:function(e){var t=this;return JC.log("view setPagePosition",(new Date).getTime()),this}},$(document).ready(function(){if(!e.autoInit)return;e.init(document.body)}),JC.Slider})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);