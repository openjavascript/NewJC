(function(define,_win){define("JC.FChart",["JC.BaseMVC","swfobject","plugins.json2","jquery.mousewheel"],function(){function FChart(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,FChart))return JC.BaseMVC.getInstance(e,FChart);JC.BaseMVC.getInstance(e,FChart,this),this._model=new FChart.Model(e),this._view=new FChart.View(this._model),this._init()}JC.use&&!window.swfobject&&JC.use("plugins.swfobject"),JC.use&&!window.JSON&&JC.use("plugins.jsons"),JC.use&&!jQuery.event.special.mousewheel&&JC.use("plugins.jquery.mousewheel");var _jdoc=$(document),_jwin=$(window);return JC.FChart=FChart,FChart.init=function(e){var t=[];return e=$(e||document),e.length&&(e.hasClass("js_compFChart")?t.push(new FChart(e)):e.find("div.js_compFChart").each(function(){t.push(new FChart(this))})),t},JC.BaseMVC.build(FChart),JC.f.extendObject(FChart.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("inited",function(){var t=e._model.parseInitData();t&&e.trigger(FChart.Model.UPDATE_CHART_DATA,[t]),e._model.height()&&e.selector().css({height:e._model.height()}),(!e._model.chartScroll()||e._model.type().toLowerCase()=="map")&&e.selector().on("mousewheel",function(t){var n=$("#"+e.gid());return t.deltaY&&n&&n.prop("apiReady")&&n.prop("updateMouseWheel")&&n[0].updateMouseWheel(t.deltaY),!1})}),e.on(FChart.Model.UPDATE_CHART_DATA,function(t,n){e.trigger(FChart.Model.CLEAR),e._view.update(n),e._model.chartSize({width:e._model.width(),height:e._model.height()})}),e.on(FChart.Model.CLEAR,function(t){e.trigger(FChart.Model.CLEAR_STATUS),e._view&&e._view.clear()}),e._model.chartSize({width:e._model.width(),height:e._model.height()})},_inited:function(){this.trigger("inited")},update:function(e){return this.trigger(FChart.Model.UPDATE_CHART_DATA,e),this},gid:function(){return this._model.gid()}}),FChart.Model._instanceName="JCFChart",FChart.Model.INS_COUNT=1,FChart.Model.CLEAR="clear",FChart.Model.CLEAR_STATUS="clear_status",FChart.Model.UPDATE_CHART_DATA="update_data",FChart.Model.SWF_FILE_MAP=null,FChart.Model.FLASH_PATH="{0}/swf/{1}.swf?{2}",FChart.Model.VERSION="fchart",JC.pathPostfix&&(FChart.Model.VERSION="v="+JC.pathPostfix),window.requirejs&&window.requirejs.s&&window.requirejs.s.contexts&&window.requirejs.s.contexts._&&window.requirejs.s.contexts._.config&&window.requirejs.s.contexts._.config.urlArgs&&(FChart.Model.VERSION=window.requirejs.s.contexts._.config.urlArgs),FChart.Model.TYPE_MAP={line:"CurveGram",curvegram:"CurveGram",bar:"Histogram",histogram:"Histogram",vbar:"VHistogram",hbar:"VHistogram",vhistogram:"VHistogram",column:"ZHistogram",zbar:"ZHistogram",zhistogram:"ZHistogram",hcolumn:"VZHistogram",mix:"MixChart",map:"Map",trend:"Trend",Trend:"Trend",pie:"PieGraph",piegraph:"PieGraph",dount:"Dount",ddount:"DDount",ndount:"NDount",stack:"Stack",hstack:"HStack",rate:"Rate"},JC.f.extendObject(FChart.Model.prototype,{init:function(){this._gid="jchart_gid_"+FChart.Model.INS_COUNT++,this.afterInit&&this.afterInit()},chartScroll:function(){var e=!0;return this.is("[chartScroll]")&&(e=this.boolProp("chartScroll")),e},parseInitData:function(){var _p=this,_data;return _p.selector().attr("chartScriptData")?_data=_p.selectorProp("chartScriptData").html():_p.selector().is("[chartDataVar]")&&(_data=_p.windowProp("chartDataVar"),_data&&(_data=JSON.stringify(_data))),_data&&(_data=_data.replace(/^[\s]*?\/\/[\s\S]*?[\r\n]/gm,""),_data=_data.replace(/[\r\n]/g,""),_data=_data.replace(/\}[\s]*?,[\s]*?\}$/g,"}}"),_data=eval("("+_data+")")),_data},data:function(e){return typeof e!="undefined"&&(this._data=e),this._data},gid:function(){return this._gid},width:function(){return typeof this._width=="undefined"&&(this._width=this.selector().prop("offsetWidth"),this.is("[chartWidth]")&&(this._width=this.intProp("chartWidth")||this._width)),this._width},height:function(){return typeof this._height=="undefined"&&(this._height=this.selector().prop("offsetHeight")||400,this.is("[chartHeight]")&&(this._height=this.intProp("chartHeight")||this._height)),this._height},sourceWidth:function(){return typeof this._sourceWidth=="undefined"&&this.is("[chartWidth]")&&(this._sourceWidth=this.intProp("chartWidth")||this._sourceWidth),this._sourceWidth||"100%"},chartSize:function(e){return typeof e!="undefined"&&(this._chartSize=e),this._chartSize},stage:function(){},stageCorner:function(){return 18},clear:function(){var e=this,t;for(t in e)if(/^\_/.test(t)){if(t=="_selector")continue;if(t=="_gid")continue;e[t]=undefined}e.afterClear&&e.afterClear()},clearStatus:function(){},chartType:function(){var e="";return this.data()&&this.data().chart&&this.data().chart.type&&(e=this.data().chart.type),(e||"").toString().toLowerCase()},typeMap:function(e){return FChart.Model.TYPE_MAP[e]},type:function(){return this.typeMap(this.chartType())||""},path:function(){var e=JC.FCHART_PATH;e||(JC.use?e=JC.PATH+"/comps/FChart/":e=JC.PATH+"/modules/JC.FChart/0.1/");var t=this,n=JC.f.printf(t.attrProp("chartPath")||FChart.Model.FLASH_PATH,e,t.type(),FChart.Model.VERSION);return n=this.checkFileMap()||n,n},checkFileMap:function(){var e="";return window.FCHART_SWF_FILE_MAP&&(this.chartType()in window.FCHART_SWF_FILE_MAP&&(e=window.FCHART_SWF_FILE_MAP[this.chartType()]),this.type()in window.FCHART_SWF_FILE_MAP&&(e=window.FCHART_SWF_FILE_MAP[this.type()])),JC.FCHART_SWF_FILE_MAP&&(this.chartType()in JC.FCHART_SWF_FILE_MAP&&(e=JC.FCHART_SWF_FILE_MAP[this.chartType()]),this.type()in JC.FCHART_SWF_FILE_MAP&&(e=JC.FCHART_SWF_FILE_MAP[this.type()])),FChart.Model.SWF_FILE_MAP&&(this.chartType()in FChart.Model.SWF_FILE_MAP&&(e=FChart.Model.SWF_FILE_MAP[this.chartType()]),this.type()in FChart.Model.SWF_FILE_MAP&&(e=FChart.Model.SWF_FILE_MAP[this.type()])),e&&(e=JC.f.printf("{0}?v={1}",e,FChart.Model.VERSION)),e}}),JC.f.extendObject(FChart.View.prototype,{init:function(){var e=this},draw:function(e){if(!this._model.type())return;var t=this,n=t._model.path(),r=n.replace(/([^\:]|)[\/]+/g,"$1/"),i=$("#"+t._model.gid()),s=JSON.stringify(e);$("#"+t._model.gid()).length||(i=$(JC.f.printf('<span id="{0}"></span>',t._model.gid())),i.appendTo(t.selector()));var o={chart:encodeURIComponent(s)},u={wmode:"transparent",allowScriptAccess:"always"},a={id:t._model.gid(),name:t._model.gid()};swfobject.embedSWF(r,t._model.gid(),t._model.sourceWidth(),t._model.height(),"10","",o,u,a)},width:function(){return this._model.width()},height:function(){return this._model.height()},stage:function(){return this._model.stage()},selector:function(){return this._model.selector()},clear:function(){var e=this;if(!e._model._stage)return;$(e._model._stage.canvas).remove(),e._model._stage=undefined},clearStatus:function(){},update:function(e){var t=this;t.clear(),t._model.clear(),t._model.data(e),t.draw(e)}}),_jdoc.ready(function(){JC.f.safeTimeout(function(){FChart.autoInit&&FChart.init()},null,"winFCHARTInit",1)}),JC.FChart})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);