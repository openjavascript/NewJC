(function(e,t){e("Bizs.KillISPCache",["JC.BaseMVC"],function(){function e(t){if(e._instance)return e._instance;this._model=new e.Model(t),this._init()}return Bizs.KillISPCache=e,e.prototype={_beforeInit:function(){JC.log("KillISPCache._beforeInit",(new Date).getTime()),this._model.processAjax()},process:function(e,t){e&&(e=$(e));if(!e||!e.length)return;var n=this;return n._model.ignoreSameLinkText(t),n._model.selector(e),n._model.processLink(),n._model.processForm(),this},ignoreUrl:function(e){return this._model.ignoreUrl(e)},ignoreSelector:function(e){return this._model.ignoreSelector(e)}},e.getInstance=function(){return!e._instance&&(e._instance=new e),e._instance},e.ignoreSameLinkText=!0,e.randName="",e.ignoreUrl=function(t){return e.getInstance().ignoreUrl(t)},e.ignoreSelector=function(t){return e.getInstance().ignoreSelector(t)},JC.BaseMVC.buildModel(e),e.Model.prototype={init:function(){this._postfix=JC.f.printf("{0}_{1}_",(new Date).getTime().toString(),Math.round(Math.random()*1e5)),this._count=1,this._ignoreSameLinkText=!0,this._randName="isp",this._ignoreUrl=[],this._ignoreSelector=[]},ignoreUrl:function(e){return typeof e=="string"&&(e=e.split(",")),e&&e.length&&(this._ignoreUrl=this._ignoreUrl.concat(e)),this._ignoreUrl},ignoreSelector:function(e){return typeof e=="string"&&(e=e.split(",")),e&&e.length&&(this._ignoreSelector=this._ignoreSelector.concat(e)),this._ignoreSelector},processLink:function(){var e=this;this.selector().find("a[href]").each(function(){var t=$(this),n=(t.attr("href")||"").trim(),r=t.html().trim();if(/javascript\:/.test(n)||/^[\s]*\#/.test(n))return;if(e.ignoreSameLinkText()&&n.trim()==t.html().trim())return;var i=e.ignoreSelector(),s=!1;$.each(i,function(e,n){if(t.is(n))return s=!0,!1});if(s)return;n=JC.f.addUrlParams(n,e.keyVal()),t.attr("href",n),t.html(r)})},processForm:function(){var e=this;this.selector().find("form").each(function(){var t=$(this),n=(t.prop("method")||"").toLowerCase();if(n=="post")return;var r=e.ignoreSelector(),i=!1;$.each(r,function(e,n){if(t.is(n))return i=!0,!1});if(i)return;t.find("input[name="+e.randName()+"]").length||$('<input type="hidden" name="'+e.randName()+'" value="'+e.postfix()+'" >').appendTo(t)})},processAjax:function(){var e=this;$(document).ajaxSend(function(t,n,r){if(r.type=="POST")return;var i=e.ignoreUrl(),s=!1;$.each(i,function(e,t){var n=t.length,i=r.url.slice(0,n);t.toLowerCase()==i.toLowerCase()&&(s=!0)}),!s&&(r.url=JC.f.addUrlParams(r.url,e.keyVal()))})},ignoreSameLinkText:function(t){return typeof t!="undefined"&&(e.ignoreSameLinkText=t),e.ignoreSameLinkText},postfix:function(){return this._postfix+this._count++},randName:function(){return e.randName||this._randName},keyVal:function(){var e={};return e[this.randName()]=this.postfix(),e}},JC.BaseMVC.build(e,"Bizs"),$(document).ready(function(){setTimeout(function(){e.autoInit&&e.getInstance().process($(document))},100)}),Bizs.KillISPCache})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);