(function(e,t){e("JC.Panel.default",["JC.common"],function(){function e(r,i,s,o){typeof r=="string"&&(r=r.trim().replace(/[\r\n]+/g,"")),typeof i=="string"&&(i=i.trim().replace(/[\r\n]+/g,"")),typeof s=="string"&&(s=s.trim().replace(/[\r\n]+/g,"")),typeof r=="string"&&/<html>/i.test(r)&&(i='<div style="color:red;">'+JC.f.filterXSS(r)+"</div>",r="错误：内容不能包含 HTML 和 BODY 标签");if(e.getInstance(r))return e.getInstance(r);this._model=new t(r,i,s,o),this._view=new n(this._model),this._init()}function t(e,t,n,r){this.selector=e,this.headers=t,this.bodys=n,this.footers=r,this.panel,this._events={},this._init()}function n(e){this._model=e,this._tpl=r,this._init()}function s(e,t){!t&&(t=u());var n={width:0,height:0},r=0,i=0;return e.y<t.y&&e.maxY>t.maxY?n.height=t.height:e.y<t.y&&e.maxY<t.maxY?n.height=t.height-(t.maxY-e.maxY):e.y>t.y&&e.maxY>t.maxY?n.height=t.maxY-e.y:e.y>t.y&&e.maxY<t.maxY&&(n.height=e.height),e.x<t.x&&e.maxX>t.maxX?n.width=t.width:e.x<t.x&&e.maxX<t.maxX?n.width=t.width-(t.maxX-e.maxX):e.x>t.x&&e.maxX>t.maxX?n.width=t.maxX-e.x:e.x>t.x&&e.maxX<t.maxX&&(n.width=e.width),n.realWidth=n.width,n.realHeight=n.height,n.width<0&&(n.width=0),n.height<0&&(n.height=0),n.rect=e,n.viewport=t,n}function o(e,t){t=t||window.$,e=t(e);var n=e.offset(),r=e.prop("offsetWidth"),i=e.prop("offsetHeight");return{x:n.left,y:n.top,width:r,height:i,maxX:n.left+r,maxY:n.top+i}}function u(e,t,n){n=n||window.$,e=n(e||window),t=n(t||document);var r={width:e.width(),height:e.height(),scrollTop:t.scrollTop(),scrollLeft:t.scrollLeft()};return r.x=r.scrollLeft,r.y=r.scrollTop,r.maxX=r.x+r.width,r.maxY=r.y+r.height,r}window.Panel=JC.Panel=e,e.getInstance=function(e){typeof e=="string"&&!/</.test(e)&&(e=$(e));if(e&&typeof e=="string")return;return $(e).data("PanelInstace")},e.FIXED=!1,e.focusButton=!0,e.clickClose=!0,e.autoCloseMs=2e3,e._fixWidth=function(e,t,n,r){var i=$('<div class="UPanel_TMP" style="position:absolute; left:-9999px;top:-9999px;">'+e+"</div>").appendTo("body"),s=i.width()+80;i.remove(),n=n||200,r=r||500,s>r&&(s=r),s<n&&(s=n),t.selector().css("width",s)},e._getButton=function(e){var t=[];return e&&(t.push('<div style="text-align:center" class="UButton"> '),e>=1&&t.push('<button type="button" eventtype="confirm">确定</button>'),e>=2&&t.push('<button type="button" eventtype="cancel">取消</button>'),t.push("</div>")),t.join("")},e.prototype={_init:function(){var e=this;return e._view.getPanel().data("PanelInstace",e),e._model.addEvent("close_default",function(e,t){t._view.close()}),e._model.addEvent("show_default",function(e,t){t._view.show()}),e._model.addEvent("hide_default",function(e,t){t._view.hide()}),e._model.addEvent("confirm_default",function(e,t){t.trigger("close")}),e._model.addEvent("cancel_default",function(e,t){t.trigger("close")}),e._model.panelautoclose()&&e.autoClose(),e},on:function(e,t){return e&&t&&this._model.addEvent(e,t),this},show:function(e,t){var n=this;return setTimeout(function(){switch(typeof e){case"number":switch(e){case 0:n.center()}break;case"object":e=$(e),e.length&&n._view.positionWith(e,t);if(!n._model.bindedPositionWithEvent){n._model.bindedPositionWithEvent=!0;var r=function(){if(!n._view.getPanel().is(":visible"))return;n.positionWith(e,t)};$(window).off("resize",r),$(window).on("resize",r),n.on("close",function(){n._model.bindedPositionWithEvent=!1,$(window).off("resize",r)})}}},10),this.trigger("beforeshow",this._view.getPanel()),this.trigger("show",this._view.getPanel()),this},positionWith:function(e,t){return e=$(e),e&&e.length&&this._view.positionWith(e,t),this},hide:function(){return this.trigger("beforehide",this._view.getPanel()),this.trigger("hide",this._view.getPanel()),this},close:function(){return this.trigger("beforeclose",this._view.getPanel()),this.trigger("close",this._view.getPanel()),this},isClickClose:function(){return this._model.panelclickclose()},clickClose:function(e){return e&&this.layout()&&this.layout().removeAttr("panelclickclose"),!e&&this.layout()&&this.layout().attr("panelclickclose",!0),this},addAutoClose:function(){return this.clickClose.apply(this,JC.f.sliceArgs(arguments)),this},autoClose:function(t,n){typeof t=="number"&&(n=t,t=null);var r=this,i;return n=r._model.panelautoclosems(n),e._autoCloseTimeout&&clearTimeout(e._autoCloseTimeout),r.on("close",function(){e._autoCloseTimeout&&clearTimeout(e._autoCloseTimeout)}),e._autoCloseTimeout=setTimeout(function(){t&&r.on("close",t),r.close()},n),this},focusButton:function(){return this._view.focusButton(),this},dispose:function(){return this._view.close(),this},center:function(){return this.trigger("beforecenter",this._view.getPanel()),this._view.center(),this.trigger("center",this._view.getPanel()),this},selector:function(){return this._view.getPanel()},layout:function(){return this._view.getPanel()},find:function(e){return this.layout().find(e)},trigger:function(e,t){var n=this,r=this._model.getEvent(e),i=!0;r&&r.length&&(t&&(t=$(t))&&t.length&&(t=t[0]),$.each(r,function(r,s){if(s.call(t,e,n)===!1)return i=!1}));if(i){var s=this._model.getEvent(e+"_default");s&&s.length&&$.each(s,function(r,i){if(i.call(t,e,n)===!1)return!1})}return this},header:function(e){typeof e!="undefined"&&this._view.getHeader(e);var t=this._view.getHeader();return t&&t.length&&(e=t.html()),e||""},body:function(e){typeof e!="undefined"&&this._view.getBody(e);var t=this._view.getBody();return t&&t.length&&(e=t.html()),e||""},footer:function(e){typeof e!="undefined"&&this._view.getFooter(e);var t=this._view.getFooter();return t&&t.length&&(e=t.html()),e||""},panel:function(e){typeof e!="undefined"&&this._view.getPanel(e);var t=this._view.getPanel();return t&&t.length&&(e=t.html()),e||""},triggerSelector:function(e){return this._model.triggerSelector(e)},offsetTop:function(e){return this._model.offsetTop(e)},offsetLeft:function(e){return this._model.offsetLeft(e)}},t.prototype={_init:function(){var t=this,n=typeof this.selector!="undefined"?$(this.selector):undefined;e.ignoreClick=!0;if(n&&n.length)this.selector=n,this.selector.parent().length||(t.selector.appendTo($(document.body)),JC.f.autoInit&&JC.f.autoInit(t.selector));else if(!n||n.length===0)this.footers=this.bodys,this.bodys=this.headers,this.headers=this.selector,this.selector=undefined;return setTimeout(function(){e.ignoreClick=!1},1),this},offsetTop:function(e){return typeof e!="undefined"&&(this._offsetTop=e),this._offsetTop||0},offsetLeft:function(e){return typeof e!="undefined"&&(this._offsetLeft=e),this._offsetLeft||0},triggerSelector:function(e){return typeof e!="undefined"&&(this._triggerSelector=e),this._triggerSelector},addEvent:function(e,t){if(!e||!t)return;e&&(e=e.toLowerCase()),e in this._events||(this._events[e]=[]),/\_default/i.test(e)?this._events[e].unshift(t):this._events[e].push(t)},getEvent:function(e){return this._events[e]},panelfocusbutton:function(){var t=e.focusButton;return this.panel.is("[panelfocusbutton]")&&(t=JC.f.parseBool(this.panel.attr("panelfocusbutton"))),t},panelclickclose:function(){var t=e.clickClose;return this.panel.is("[panelclickclose]")&&(t=JC.f.parseBool(this.panel.attr("panelclickclose"))),t},panelautoclose:function(){var e;return this.panel.is("[panelautoclose]")&&(e=JC.f.parseBool(this.panel.attr("panelautoclose"))),e},panelautoclosems:function(t){var n=e.autoCloseMs;return this.panel.is("[panelautoclosems]")&&(n=parseInt(this.panel.attr("panelautoclosems"),10)),typeof t=="number"&&(n=t),n},panelfixed:function(){var t=e.FIXED;return this.panel.is("[panelfixed]")&&(t=JC.f.parseBool(this.panel.attr("panelfixed"))),t}},n.prototype={_init:function(){return this._model.panel||(this._model.selector?this._model.panel=this._model.selector:(this._model.panel=$(this._tpl),this._model.panel.appendTo(document.body),JC.f.autoInit&&JC.f.autoInit(this._model.panel))),this.getHeader(),this.getBody(),this.getFooter(),this},positionWith:function(e,t){if(!e||!e.length)return;this.getPanel().css({left:"-9999px",top:"-9999px",display:"block",position:"absolute"});var n=e.offset(),r=e.prop("offsetWidth"),i=e.prop("offsetHeight"),s=this.getPanel().prop("offsetWidth"),o=this.getPanel().prop("offsetHeight"),u=$(window).width(),a=$(window).height(),f=$(document).scrollTop(),l=$(document).scrollLeft(),c=n.left+l,h=n.top+i+1;if(typeof t!="undefined")switch(t){case"top":h=n.top-o-1,c=n.left+r/2-s/2}h+=this._model.offsetTop(),c+=this._model.offsetLeft();var p=f+a-o,d=f;h>p&&(h=n.top-o-1),h<d&&(h=f);var v=l+u-s,m=l;c>v&&(c=l+u-s-1),c<m&&(c=l),this.getPanel().css({left:c+"px",top:h+"px"})},show:function(){this.getPanel().css({"z-index":ZINDEX_COUNT++}).show()},focusButton:function(){if(!this._model.panelfocusbutton())return;var e=this.getPanel().find("input[eventtype=confirm], input[type=submit], button[eventtype=confirm], button[type=submit]");!e.length&&(e=this.getPanel().find("input[eventtype=cancel], input[type=buton], button[eventtype=cancel], button[type=button]")),e.length&&$(e[0]).focus()},hide:function(){this.getPanel().hide()},close:function(){this.getPanel().remove()},getPanel:function(e){return typeof e!="undefined"&&this.getPanel().html(e),this._model.panel},getHeader:function(e){var t=this.getPanel().find("div.UPContent > div.hd");return typeof e!="undefined"&&(this._model.headers=e),typeof this._model.headers!="undefined"&&(t.length||this.getPanel().find("div.UPContent > div.bd").before(t=$('<div class="hd">弹出框</div>')),t.html(this._model.headers),this._model.headers=undefined),t},getBody:function(e){var t=this.getPanel().find("div.UPContent > div.bd");return typeof e!="undefined"&&(this._model.bodys=e),typeof this._model.bodys!="undefined"&&(t.html(this._model.bodys),this._model.bodys=undefined),t},getFooter:function(e){var t=this.getPanel().find("div.UPContent > div.ft");return typeof e!="undefined"&&(this._model.footers=e),typeof this._model.footers!="undefined"&&(t.length||this.getPanel().find("div.UPContent > div.bd").after(t=$('<div class="ft" ></div>')),t.html(this._model.footers),this._model.footers=undefined),t},center:function(){var e=this.getPanel(),t=e.width(),n=e.height(),r,i,a=$(window).width(),f=$(window).height(),l=$(document).scrollLeft(),c=$(document).scrollTop(),h,p=this,d=0;if(p._model.panelfixed()){e.css({left:"-9999px",top:"-9999px"}).show(),f>n&&(d=(f-n)/2,d>200&&(d=200)),e.css({position:"fixed",left:"0px",right:"0px",margin:"auto",top:d});return}if(window.parent&&window.parent!=window)try{var v=window.parent,m=v.window.$,g=v.window,y=v.document,b=m(g),w=m(y);window.PANEL_WIN_ID="frame"+JC.f.ts(),w.find("iframe").each(function(){var e=m(this),t=e.attr("src"),n=JC.f.relativePath(t,g.location.href).trim(),r=(location.href+"").trim();if(r.indexOf(n)>-1&&e.prop("contentWindow").PANEL_WIN_ID==window.PANEL_WIN_ID)return h=e,!1});if(h&&h.length){var E=s(o(h,m),u(b,w,m));a=E.width,f=E.height,c=E.rect.height-f,c>E.viewport.maxY&&(c=E.viewport.y+E.rect.y)}}catch(S){}e.css({left:"-9999px",top:"-9999px"}).show(),r=(a-t)/2+l,i=(f-n)/2+c,f-n-100>300&&(i-=100),i+n-c>f&&(i=c+f-n);if(i<c||i<0)i=c;i+=this._model.offsetTop(),r+=this._model.offsetLeft(),e.css({left:r+"px",top:i+"px"})}};var r=['<div class="UPanel" style="width: 600px;">','    <div class="UPContent">','        <div class="bd"></div>','        <span class="close" eventtype="close"></span>',"    </div><!--end UPContent-->","</div>"].join("");JC.hideAllPanel=function(t){$("div.UPanel").each(function(){var n=$(this),r=e.getInstance(n);if(!r)return;r.hide(),t&&r.close()})},JC.hideAllPopup=function(t){$("body > div.UPanelPopup_identifer").each(function(){var n=$(this),r=e.getInstance(n);if(!r)return;r.hide(),t&&r.close()})},$(document).delegate("div.UPanel, div.JCPanel","click",function(e){var t=$(this),n=$(e.target||e.srcElement),r;n&&n.length&&n.is("[eventtype]")&&(r=n.attr("eventtype"),r&&t.data("PanelInstace")&&t.data("PanelInstace").trigger(r,n,e))}),$(document).delegate("div.UPanel, div.JCPanel","click",function(t){var n=$(this),r=e.getInstance(n);r&&r.isClickClose()&&t.stopPropagation()}),$(document).on("click",function(t){if(e.ignoreClick)return;$("div.UPanel, div.JCPanel").each(function(){var t=$(this),n=e.getInstance(t);n&&n.isClickClose()&&n.layout()&&n.layout().is(":visible")&&(n.hide(),n.close())})}),$(document).on("keyup",function(e){var t=e.keyCode;switch(t){case 27:JC.hideAllPanel(1)}});var i={alert:null,confirm:null,msgbox:null,"dialog.alert":null,"dialog.confirm":null,"dialog.msgbox":null,panel:null,dialog:null};return $(document).on("click",function(t){var n=$(t.target||t.srcElement),r=n.attr("paneltype"),s=n.attr("panelmsg"),o=n.is("[panelmsgbox]")?JC.f.parentSelector(n,n.attr("panelmsgbox")):null;if(!r||!(s||o&&o.length))return;r=r.toLowerCase();if(!r in i)return;n.prop("nodeName")&&n.prop("nodeName").toLowerCase()=="a"&&t.preventDefault();var u,a=parseInt(n.attr("panelstatus"),10)||0,f=n.attr("panelcallback"),l=n.attr("panelcancelcallback"),c=n.attr("panelclosecallback"),h=parseInt(n.attr("panelbutton"),10)||0,p=n.attr("panelheader")||"",d=n.is("[panelheaderbox]")?JC.f.parentSelector(n,n.attr("panelheaderbox")):null,v=n.attr("panelfooter")||"",m=n.is("[panelfooterbox]")?JC.f.parentSelector(n,n.attr("panelfooterbox")):null,g=n.is("[panelhideclose]")?JC.f.parseBool(n.attr("panelhideclose")):!1;o&&(s=JC.f.scriptContent(o)||s),d&&d.length&&(p=JC.f.scriptContent(d)||v),m&&m.length&&(v=JC.f.scriptContent(m)||v),n.prop("nodeName")&&n.prop("nodeName").toLowerCase()=="a"&&t.preventDefault(),f&&(f=window[f]),c&&(c=window[c]);switch(r){case"alert":JC.alert&&(u=JC.alert(s,n,a));break;case"confirm":JC.confirm&&(u=JC.confirm(s,n,a));break;case"msgbox":JC.msgbox&&(u=JC.msgbox(s,n,a));break;case"dialog.alert":JC.Dialog&&JC.Dialog.alert&&(u=JC.Dialog.alert(s,a));break;case"dialog.confirm":JC.Dialog&&JC.Dialog.confirm&&(u=JC.Dialog.confirm(s,a));break;case"dialog.msgbox":JC.Dialog&&JC.Dialog.msgbox&&(u=JC.Dialog.msgbox(s,a));break;case"panel":case"dialog":var y="";if(r=="panel")u=new e(p,s+e._getButton(h),v);else{if(!JC.Dialog)return;u=JC.Dialog(p,s+e._getButton(h),v)}u.on("beforeshow",function(t,n){!p&&n.find("div.hd").hide(),!p&&n.find("div.ft").hide(),e._fixWidth(s,u),g&&n.find("span.close").hide()}),r=="panel"&&u.show(n,"top")}if(!u)return;/msgbox/i.test(r)?f&&u.on("close",f):f&&u.on("confirm",f),c&&u.on("close",c),l&&u.on("cancel",l),u.triggerSelector(n)}),JC.Panel})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);