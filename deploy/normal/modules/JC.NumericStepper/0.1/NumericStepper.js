(function(e,t){e("JC.NumericStepper",["JC.BaseMVC"],function(){function n(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,n))return JC.BaseMVC.getInstance(e,n);JC.BaseMVC.getInstance(e,n,this),this._model=new n.Model(e),this._view=new n.View(this._model),this._init(),JC.log(n.Model._instanceName,"all inited",(new Date).getTime())}var e=$(document),t=$(window);return JC.NumericStepper=n,n.init=function(e){var t=[];return e=$(e||document),e.length&&(e.hasClass("js_compNumericStepper")?t.push(new n(e)):e.find("div.js_compNumericStepper, span.js_compNumericStepper").each(function(){t.push(new n(this))})),t},n.redoMs=100,n.timeoutMs=500,n.defaultMouseUp=function(e){if(!n._currentIns)return;JC.f.safeTimeout(null,n._currentIns._model.cnsTarget(),n.Model.REDO_TM_NAME),n.Model.interval&&clearInterval(n.Model.interval)},n._currentIns,JC.BaseMVC.build(n),JC.f.extendObject(n.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e._model.cnsMinusButton()&&(e._model.cnsMinusButton().on("mousedown",function(r){n._currentIns=e,e.trigger(n.Model.CALC,[n.Model.CALC_MINUS]),JC.f.safeTimeout(function(){n.Model.interval&&clearInterval(n.Model.interval),n.Model.interval=setInterval(function(){e.trigger(n.Model.CALC,[n.Model.CALC_MINUS])},e._model.cnsRedoMs())},e._model.cnsTarget(),n.Model.REDO_TM_NAME,e._model.cnsTimeoutMs()),t.on("mouseup",n.defaultMouseUp)}),e._model.cnsMinusButton().each(function(){BaseMVC.getInstance($(this),n,e)})),e._model.cnsPlusButton()&&(e._model.cnsPlusButton().on("mousedown",function(r){n._currentIns=e,e.trigger(n.Model.CALC,[n.Model.CALC_PLUS]),JC.f.safeTimeout(function(){n.Model.interval&&clearInterval(n.Model.interval),n.Model.interval=setInterval(function(){e.trigger(n.Model.CALC,[n.Model.CALC_PLUS])},e._model.cnsRedoMs())},e._model.cnsTarget(),n.Model.REDO_TM_NAME,e._model.cnsTimeoutMs()),t.on("mouseup",n.defaultMouseUp)}),e._model.cnsPlusButton().each(function(){BaseMVC.getInstance($(this),n,e)})),e.on(n.Model.CALC,function(t,r){if(!e._model.cnsTarget()||!e._model.cnsTarget().length)return;var i=e._model.val(),s=i,o=e._model.step(),u=e._model.fixed(),a=e._model.minvalue(),f=e._model.maxvalue();switch(r){case n.Model.CALC_MINUS:s-=o,e._model.isMinvalue()&&s<a&&(s=a);break;case n.Model.CALC_PLUS:s+=o,e._model.isMaxvalue()&&s>f&&(s=f)}if(s===i)return;if(e._model.cnsBeforeChangeCb()&&e._model.cnsBeforeChangeCb().call(e._model.cnsTarget(),s,i,e)===!1)return;e._model.cnsTarget().val(JC.f.parseFinance(s,u).toFixed(u)),e._model.cnsChangeCb()&&e._model.cnsChangeCb().call(e._model.cnsTarget(),s,i,e)})},_inited:function(){this._view.initStyle()},plus:function(){return this.trigger(n.Model.CALC,[n.Model.CALC_PLUS]),this},minus:function(){return this.trigger(n.Model.CALC,[n.Model.CALC_MINUS]),this}}),n.Model._instanceName="JCNumericStepper",n.Model.CALC="calc",n.Model.CALC_MINUS="minus",n.Model.CALC_PLUS="plus",n.Model.CLASS_ICON="cnsIcon",n.Model.CLASS_MINUS="cnsMinus",n.Model.CLASS_PLUS="cnsPlus",n.Model.REDO_TM_NAME="cnsTm",JC.f.extendObject(n.Model.prototype,{init:function(){},cnsTarget:function(){return this.selectorProp("cnsTarget")},cnsMinusButton:function(){return this.selectorProp("cnsMinusButton")},cnsPlusButton:function(){return this.selectorProp("cnsPlusButton")},cnsBeforeChangeCb:function(){return this.callbackProp("cnsBeforeChangeCb")||n.beforeChangeCb},cnsChangeCb:function(){return this.callbackProp("cnsChangeCb")||n.changeCb},cnsRedoMs:function(){return this.intProp("cnsRedoMs")||n.redoMs},cnsTimeoutMs:function(){return this.intProp("cnsTimeoutMs")||n.timeoutMs},isMinvalue:function(){return this.cnsTarget().is("[minvalue]")},isMaxvalue:function(){return this.cnsTarget().is("[maxvalue]")},val:function(){return this.getVal(this.cnsTarget().val())},minvalue:function(){return this.getVal(this.cnsTarget().attr("minvalue"))},maxvalue:function(){return this.getVal(this.cnsTarget().attr("maxvalue"))},step:function(){return this.getVal(this.cnsTarget().attr("step"))||1},fixed:function(){return this.getVal(this.cnsTarget().attr("fixed"))||0},getVal:function(e){var t=0;return e&&(e=e.toString().trim()),e&&(/\./.test(e)?t=JC.f.parseFinance(e,e.split(".")[1].length||this.fixed()):t=parseInt(e,10)||0),t}}),JC.f.extendObject(n.View.prototype,{init:function(){},initStyle:function(){var e=this;e._model.cnsMinusButton()&&e._model.cnsMinusButton().addClass(n.Model.CLASS_ICON).addClass(n.Model.CLASS_MINUS),e._model.cnsPlusButton()&&e._model.cnsPlusButton().addClass(n.Model.CLASS_ICON).addClass(n.Model.CLASS_PLUS)}}),e.ready(function(){}),$(document).delegate("div.js_compNumericStepper, span.js_compNumericStepper","mouseenter",function(e){var t=$(this),r=JC.BaseMVC.getInstance(t,n);!r&&new n(t)}),$(document).delegate("div.js_compNumericStepper .cnsIcon, span.js_compNumericStepper .cnsIcon","click",function(e){var t=$(this),r=JC.BaseMVC.getInstance(t,n);if(!r){var i=JC.f.getJqParent(t,".js_compNumericStepper");if(!i||!i.length)return;r=new n(i),t.hasClass("cnsPlus")?r.plus():r.minus()}}),JC.NumericStepper})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);