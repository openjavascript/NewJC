(function(e,t){e("JC.ServerSort",["JC.BaseMVC"],function(){function n(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,n))return JC.BaseMVC.getInstance(e,n);JC.BaseMVC.getInstance(e,n,this),this._model=new n.Model(e),this._view=new n.View(this._model),this._init()}var e=$(document),t=$(window);return JC.ServerSort=n,n.init=function(e){var t=[];return e=$(e||document),e.length&&(e.hasClass("js_compServerSort")?t.push(new n(e)):e.find("div.js_compServerSort, tr.js_compServerSort").each(function(){t.push(new n(this))})),t},JC.BaseMVC.build(n),JC.f.extendObject(n.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;if(!e._model.items()||!e._model.items().length)return;e.on("inited",function(){e.trigger("UPDATE_LAYOUT")}),e._model.items().on("click",function(t){t.preventDefault();var n=$(this),r=JC.f.getUrlParam(e._model.sortName()),i=JC.f.getUrlParam(e._model.typeName()),s=n.attr("sortName"),o=n.attr("sortType"),u;u=i,s==e._model.defaultSortName()?u?o=e._model.otherSortType(u):o=e._model.otherSortType(e._model.defaultType()):o=e._model.defaultType(),e.trigger("UPDATE",[s,o,r,i])}),e.on("UPDATE",function(t,n,r,i,s){var o=e._model.url(),u={},a=e._model.resetUrlParams(),f;u[e._model.sortName()]=n,u[e._model.typeName()]=r,o=JC.f.addUrlParams(o,u),a&&a.length&&$.each(a,function(e,t){if(!t)return;JC.f.hasUrlParam(o,t)&&(f={},f[t]=1,o=JC.f.addUrlParams(o,f))}),e._model.urlFilter()&&(o=e._model.urlFilter()(o)),location.href=o}),e.on("UPDATE_LAYOUT",function(t){var n=e._model.defaultSortName(),r=e._model.defaultType(),i=JC.f.getUrlParam(e._model.typeName())||r,s=e._model.items();if(!s||!s.length)return;$.each(s,function(t,s){s=$(s);var o=s.attr("sortName"),u;o==n?u=[e._model.classEnum()[e._model.typeIndexAt(e._model.otherSortType(i))],e._model.curClassEnum()[e._model.typeIndexAt(e._model.otherSortType(i))]].join(" "):u=e._model.classEnum()[e._model.typeIndexAt(r)],u&&(s.removeClass(e._model.classEnum().concat(e._model.curClassEnum()).join(" ")),s.addClass(u))})})},_inited:function(){this.trigger("inited")}}),n.Model._instanceName="JCServerSort",JC.f.extendObject(n.Model.prototype,{init:function(){},urlFilter:function(){return this.callbackProp("cssUrlFilter")},typeIndexAt:function(e){var t=0;return $.each(this.typeEnum(),function(n,r){if(r===e)return t=n,!1}),t},resetUrlParams:function(){return this._resetUrlParams||(this._resetUrlParams=(this.attrProp("cssResetUrlParams")||"page").replace(/[\s]+/g,""),this._resetUrlParams&&(this._resetUrlParams=this._resetUrlParams.split(","))),this._resetUrlParams},defaultType:function(){return this.attrProp("cssDefaultType")||this.typeEnum()[0]},otherSortType:function(e){var t;return e&&$.each(this.typeEnum(),function(n,r){if(e!=r)return t=r,!1}),t=t||this.typeEnum()[0],t},defaultSortName:function(){return typeof this._defalutSortName=="undefined"&&(this._defalutSortName=this.items().first().attr("sortName"),this.is("[cssDefaultSortName]")&&(this._defalutSortName=this.attrProp("cssDefaultSortName")||this._defalutSortName),this._defalutSortName=JC.f.getUrlParam(this.sortName())||this._defalutSortName),this._defalutSortName},items:function(){if(typeof this._items=="undefined"){var e=this.attrProp("cssItems")||"|a[sortName]";this._items=JC.f.parentSelector(this.selector(),e)||null}return this._items},url:function(){return JC.f.urlDetect(this.attrProp("cssUrl")||"URL")},sortName:function(){return this.attrProp("cssSortName")||"sortby"},typeName:function(){return this.attrProp("cssTypeName")||"sorttype"},typeEnum:function(){return this._typeEnum||(this._typeEnum=(this.attrProp("cssTypeEnum")||"desc,asc").replace(/[\s]+/g,"").split(",")),this._typeEnum},classEnum:function(){return this._classEnum||(this._classEnum=(this.attrProp("cssClassEnum")||"js_cssDesc,js_cssAsc").replace(/[\s]+/g,"").split(",")),this._classEnum},curClassEnum:function(){return this._curClassEnum||(this._curClassEnum=(this.attrProp("cssCurClassEnum")||"js_cssDesc_cur,js_cssAsc_cur").replace(/[\s]+/g,"").split(",")),this._curClassEnum}}),JC.f.extendObject(n.View.prototype,{init:function(){}}),e.ready(function(){n.autoInit&&n.init()}),JC.ServerSort})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);