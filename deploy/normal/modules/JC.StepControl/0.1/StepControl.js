(function(e,t){e("JC.StepControl",["JC.BaseMVC","JC.Valid"],function(){function n(e){e&&(e=$(e));if(JC.BaseMVC.getInstance(e,n))return JC.BaseMVC.getInstance(e,n);JC.BaseMVC.getInstance(e,n,this),this._model=new n.Model(e),this._view=new n.View(this._model),this._init(),JC.log(n.Model._instanceName,"all inited",(new Date).getTime())}var e=$(document),t=$(window);return JC.StepControl=n,n.init=function(e){var t=[];return e=$(e||document),e.length&&(e.hasClass("js_compStepControl")?t.push(new n(e)):e.find("div.js_compStepControl").each(function(){t.push(new n(this))})),t},JC.BaseMVC.build(n),JC.f.extendObject(n.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("inited",function(){e.trigger("show_index"),e._model.cscInitedCallback()&&e._model.cscInitedCallback().call(e,e.selector())}),e._model.cscItems().each(function(t,n){n=$(n),n.delegate(".js_cscNext","click",function(){var t=$(this);e.trigger("next_index",[n,t])}),n.delegate(".js_cscPrev","click",function(){var t=$(this);e.trigger("prev_index",[n,t])})}),e.on("prev_index",function(t,n,r){JC.log("prev_index",JC.f.ts());var i=e._model.cscValidCallback(r)||e._model.cscValidCallback(n),s,o;o=e._model.cscIndex()-1,o>=0&&e.trigger("show_index",[e._model.cscIndex(o)])}),e.on("next_index",function(t,n,r){if(!n)return;JC.log("next_index",JC.f.ts());var i=e._model.cscValidCallback(r)||e._model.cscValidCallback(n),s,o,u;!r||r.attr("type").toLowerCase()!="button"&&r.attr("type").toLowerCase()!="input"?s=!0:i?s=i().call(e,r,n):s=JC.Valid(n),JC.log("_canNext",s,JC.f.ts());if(!s)return;o=e._model.cscIndex()+1,JC.log(o,e._model.maxIndex(),e._model.cscIndex()),o<=e._model.maxIndex()&&e.trigger("show_index",[e._model.cscIndex(o)])}),e.on("show_index",function(t,n){var r=e._model.cscIndex(),i=e._model.cscItems(),s=e._model.cscLabels();typeof n!="undefined"&&(r=n),i&&i.length&&i.hide().eq(r).show(),s&&s.length&&s.removeClass(e._model.cscActiveClass()).eq(r).addClass(e._model.cscActiveClass())})},_inited:function(){this.trigger("inited")},prev:function(){var e=this,t=e._model.current(".js_cscPrev");return t.item&&e.trigger("prev_index",[t.item,t.button]),this},next:function(){var e=this,t=e._model.current(".js_cscNext");return t.item&&e.trigger("next_index",[t.item,t.button]),this},first:function(){return this.trigger("show_index",[this._model.cscIndex(0)]),this},last:function(){var e;return this._model.cscItems()&&this._model.cscItems().length&&(e=this._model.cscItems().length-1),typeof e!="undefined"&&this.trigger("show_index",[this._model.cscIndex(e)]),this}}),n.Model._instanceName="JCStepControl",JC.f.extendObject(n.Model.prototype,{init:function(){var e=this;e.cscIndex(e.cscDefaultIndex()||0)},next:function(){var e=this,t=this.cscIndex()+1,n={item:null,label:null,button:null,selector:e.selector()},r=e.cscItems(),i=e.cscLabels(),s;return r[t]&&(n.item=$(r[t]),s=n.item.find(".js_cscNext"),s.length&&(n.button=s)),i&&i.length&&i[t]&&(n.label=$(i[t])),n},prev:function(){var e=this,t=this.cscIndex()-1,n={item:null,label:null,selector:e.selector()},r=e.cscItems(),i=e.cscLabels();return r[t]&&(n.item=$(r[t])),i&&i.length&&i[t]&&(n.label=$(i[t])),n},current:function(e){e=e||".js_cscNext";var t=this,n=this.cscIndex(),r={item:null,label:null,button:null,selector:t.selector()},i=t.cscItems(),s=t.cscLabels(),o;return i[n]&&(r.item=$(i[n]),o=r.item.find(e),o.length&&(r.button=o)),s&&s.length&&s[n]&&(r.label=$(s[n])),r},maxIndex:function(){var e=this.cscItems().length-1;return e<0&&(e=0),e},cscIndex:function(e){return typeof e!="undefined"&&(this._cscIndex=e),this._cscIndex},cscValidCallback:function(e){return e?this.callbackProp(e,"cscValidCallback"):null},cscInitedCallback:function(){return this.callbackProp("cscInitedCallback")},cscItems:function(){return this.selectorProp("cscItems")},cscLabels:function(){return this.selectorProp("cscLabels")},cscActiveClass:function(){return this.attrProp("cscActiveClass")},cscDefaultIndex:function(){return this.intProp("cscDefaultIndex")||0}}),JC.f.extendObject(n.View.prototype,{init:function(){}}),e.ready(function(){setTimeout(function(){n.autoInit&&n.init()},1)}),JC.StepControl})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);