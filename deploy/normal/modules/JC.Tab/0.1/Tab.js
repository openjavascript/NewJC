(function(define,_win){define("JC.Tab",["JC.common"],function(){function Tab(e,t){e&&(e=$(e)),t&&(t=$(t));if(Tab.getInstance(e))return Tab.getInstance(e);this._model=new Model(e,t),this._view=new View(this._model),JC.log("initing tab"),this._init()}function Model(e,t){this._layout=e,this._triggerTarget=t,this._tablabels,this._tabcontainers,this.currentIndex,this._init()}function View(e){this._model=e}return window.Tab=JC.Tab=Tab,JC.f.addAutoInit&&JC.f.addAutoInit(Tab),Tab.autoInit=!0,Tab.activeClass="cur",Tab.activeEvent="click",Tab.getInstance=function(e,t){var n;return e&&(e=$(e)).length&&(typeof t!="undefined"&&e.data("TabInstance",t),n=e.data("TabInstance")),n},Tab.ajaxCallback=null,Tab.ajaxRandom=!0,Tab.isAjax=function(e){return $(e).attr("tabajaxurl")},Tab.isAjaxInited=function(e,t){return t!="undefined"&&$(e).data("TabAjaxInited",t),$(e).data("TabAjaxInited")},Tab.prototype={_init:function(){if(!this._model.layoutIsTab())return this;Tab.getInstance(this._model.layout(),this),this._view.init();var e=$(this._model.triggerTarget());return e&&e.length&&this._model.tablabel(e)&&e.trigger("click"),this},active:function(e){var t;return typeof e=="number"?t=e:e&&$(e).length&&(t=this._model.tabindex(e)),typeof t!="undefined"&&this._view.active(t),this}},Model.prototype={_init:function(){if(!this.layoutIsTab())return;var e=this,t=/^\~[\s]+/g;return e.isFromChild(e.layout().attr("tablabels"))?this._tablabels=e.layout().find(e.layout().attr("tablabels").replace(t,"")):this._tablabels=JC.f.parentSelector(e.layout(),e.layout().attr("tablabels")),e.isFromChild(e.layout().attr("tabcontainers"))?this._tabcontainers=e.layout().find(e.layout().attr("tabcontainers").replace(t,"")):this._tabcontainers=JC.f.parentSelector(e.layout(),e.layout().attr("tabcontainers")),this._tablabels.each(function(){e.tablabel(this,1)}),this._tabcontainers.each(function(){e.tabcontent(this,1)}),this._tablabels.each(function(t){e.tabindex(this,t)}),this},isFromChild:function(e){return/^\~/.test($.trim(e))},layout:function(){return this._layout},tablabels:function(e){return typeof e!="undefined"?$(this._tablabels[e]):this._tablabels},tabcontainers:function(e){return typeof e!="undefined"?$(this._tabcontainers[e]):this._tabcontainers},triggerTarget:function(){return this._triggerTarget},layoutIsTab:function(){return this.layout().attr("tablabels")&&this.layout().attr("tabcontainers")},activeClass:function(){return this.layout().attr("tabactiveclass")||Tab.activeClass},activeEvent:function(){return this.layout().attr("tabactiveevent")||Tab.activeEvent},tablabel:function(e,t){e&&(e=$(e));if(!e||!e.length)return;return typeof t!="undefined"&&e.data("TabLabel",t),e.data("TabLabel")},tabcontent:function(e,t){e&&(e=$(e));if(!e||!e.length)return;return typeof t!="undefined"&&e.data("TabContent",t),e.data("TabContent")},tabindex:function(e,t){e&&(e=$(e));if(!e||!e.length)return;return typeof t!="undefined"&&e.data("TabIndex",t),e.data("TabIndex")},tabactivecallback:function(){var e;return this.layout().attr("tabactivecallback")&&(e=window[this.layout().attr("tabactivecallback")]),e},tabchangecallback:function(){var e;return this.layout().attr("tabchangecallback")&&(e=window[this.layout().attr("tabchangecallback")]),e},tablabelparent:function(e){var t;return this.layout().attr("tablabelparent")&&(t=e.parent(this.layout().attr("tablabelparent")))&&t.length&&(e=t),e},tabajaxurl:function(e){return e.attr("tabajaxurl")},tabajaxmethod:function(e){return(e.attr("tabajaxmethod")||"get").toLowerCase()},tabajaxdata:function(_label){var _r;return _label.attr("tabajaxdata")&&eval("(_r = "+_label.attr("tabajaxdata")+")"),_r=_r||{},Tab.ajaxRandom&&(_r.rnd=(new Date).getTime()),_r},tabajaxcallback:function(e){var t=Tab.ajaxCallback,n;return e.attr("tabajaxcallback")&&(n=window[e.attr("tabajaxcallback")])&&(t=n),t}},View.prototype={init:function(){JC.log("Tab.View:",(new Date).getTime());var e=this;return this._model.tablabels().on(this._model.activeEvent(),function(t){var n=$(this),r;if(typeof e._model.currentIndex!="undefined"&&e._model.currentIndex===e._model.tabindex(n))return;e._model.currentIndex=e._model.tabindex(n),e._model.tabactivecallback()&&(r=e._model.tabactivecallback().call(this,t,e._model.tabcontainers(e._model.currentIndex),e));if(r===!1)return;e.active(e._model.tabindex(n))}),this},active:function(e){if(typeof e=="undefined")return;var t=this,n,r=t._model.activeClass(),i=t._model.tablabels(e);t._model.tablabels().each(function(){t._model.tablabelparent($(this)).removeClass(r)}),i=t._model.tablabelparent(i),i.addClass(r),t._model.tabcontainers().hide(),t._model.tabcontainers(e).show(),t._model.tabchangecallback()&&(n=t._model.tabchangecallback().call(t._model.tablabels(e),t._model.tabcontainers(e),t));if(n===!1)return;t.activeAjax(e)},activeAjax:function(e){var t=this,n=t._model.tablabels(e);if(!Tab.isAjax(n))return;if(Tab.isAjaxInited(n))return;var r=t._model.tabajaxurl(n);if(!r)return;JC.log(t._model.tabajaxmethod(n),t._model.tabajaxdata(n),t._model.tabajaxcallback(n)),Tab.isAjaxInited(n,1),$[t._model.tabajaxmethod(n)](r,t._model.tabajaxdata(n),function(r,i,s){t._model.tabajaxcallback(n)&&t._model.tabajaxcallback(n)(r,n,t._model.tabcontainers(e),t,i,s),!t._model.tabajaxcallback(n)&&t._model.tabcontainers(e).html(r)})}},$(document).delegate(".js_autoTab","mouseover",function(e){if(!Tab.autoInit)return;var t=$(this),n,r=e.target||e.srcElement;if(Tab.getInstance(t))return;r&&(r=$(r)),JC.log((new Date).getTime(),r.prop("nodeName")),n=new Tab(t,r)}),JC.Tab})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);