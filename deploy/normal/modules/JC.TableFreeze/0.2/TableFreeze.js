(function(e,t){e("JC.TableFreeze",["JC.BaseMVC"],function(){function e(t){t&&(t=$(t));if(e.getInstance(t))return e.getInstance(t);e.getInstance(t,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init()}return JC.TableFreeze=e,JC.f.addAutoInit&&JC.f.addAutoInit(e),e.getInstance=function(t,n){typeof t=="string"&&!/</.test(t)&&(t=$(t));if(!t||!t.length||typeof t=="string")return;return typeof n!="undefined"&&t.data(e.Model._instanceName,n),t.data(e.Model._instanceName)},e.init=function(t){var n=[];return t=$(t||document),t.length&&(t.hasClass("js_compTableFreeze")?n.push(new e(t)):t.find("div.js_compTableFreeze").each(function(){n.push(new e(this))})),n},BaseMVC.build(e),JC.f.extendObject(e.prototype,{_beforeInit:function(){var e=this,t=e._model.selector().find(">table");e._model.alternateClass()&&t.find(">tbody>tr:odd").addClass(e._model.alternateClass()),e._model.sourceTable=t.clone(),e._model.initcolnumWidth=e._model.colnumWidth(t),e._model.needProcess()&&t.detach(),e._model.initWidth=e._model.selector().width(),e._model.tempWidth=e._model.initWidth},_initHanlderEvent:function(){var e=this,t;e._model.beforeCreateTableCallback()&&e._model.beforeCreateTableCallback().call(e,e.selector()),e._view.update(),e._model.afterCreateTableCallback()&&e._model.afterCreateTableCallback().call(e,e.selector()),e._model.needHoverClass()&&(e._model.selector().addClass("needHoverClass"),e._model.needProcess()&&(t="compTFHover",$(document).delegate("tbody .CTF","mouseenter",function(){var e=$(this),n="tbody ."+e.attr("data-ctf"),r=e.parents(".js_compTableFreeze").find(n);r.addClass(t).attr("status","1")}).delegate("tbody .CTF","mouseleave",function(){var e=$(this),n="tbody ."+e.attr("data-ctf"),r=e.parents(".js_compTableFreeze").find(n);r.removeClass(t)})))},_inited:function(){JC.log("TableFreeze inited",(new Date).getTime())},update:function(){var e=this,t=e._model.selector(),n=t.width(),r=t.find(".js-fixed-table>table>thead>tr,.js-fixed-table>table>tbody>tr,.js-roll-table>table>thead>tr,.js-roll-table>table>tbody>tr");n>e._model.tempWidth&&r.height("auto"),e._view.fixHeight()}}),e.Model._instanceName="TableFreeze",JC.f.extendObject(e.Model.prototype,{init:function(){},sourceTable:"",initcolnumWidth:[],initWidth:0,tempWidth:0,freezeType:function(){var e=this.stringProp("freezeType")||"prev";return e!=="prev"&&e!=="both"&&e!=="last"&&(e="prev"),e},freezeCols:function(){var e=this,t=e.attrProp("freezeCols"),n=e.freezeType(),r=[];return t?(r=t.split(","),r[0]=+r[0],r[1]=+r[1],n==="both"?r[0]===0&&r[1]===0?t=0:t=r.slice():t=r[0],t):(n!=="both"&&(t=1),n==="both"&&(t=[1,1]),t)},scrollWidth:function(){var e=this.attrProp("scrollWidth");return!e&&(e="120%"),e},needHoverClass:function(){var e=this.boolProp("needHoverClass");return typeof e=="undefined"&&(e=!0),e},alternateClass:function(){var e=this.attrProp("alternateClass");return e},colnum:function(){var e=this.sourceTable,t=e.find("tr:eq(0)"),n=t.find(">th, >td"),r=n.length;return n.each(function(){var e=$(this),t=e.prop("colspan");e.prop("colspan")&&(r+=t-1)}),r},colnumWidth:function(e){var t=e.find("tr:eq(0)"),n=t.find(">th, >td"),r=[];return n.each(function(){r.push($(this).prop("offsetWidth"))}),r},trElement:function(e){var t=e.find(">thead"),n=e.find(">tbody"),r,i;return t.length?r=t.find(">tr"):r=e.find(">tr:eq(0)"),n.length?i=n.find(">tr"):i=e.find(">tr:gt(0)"),{theadTr:r,tbodyTr:i}},needProcess:function(){var e=this,t=e.freezeCols(),n=e.freezeType(),r=e.selector(),i=e.sourceTable,s=!0;return i.find("tr").length===0?!1:t===0?(r.css("overflow-x","auto").find(">table").css("width",e.scrollWidth()),!1):n==="both"&&t[0]+t[1]>=e.colnum()?!1:s},layout:function(e){var t=this.sourceTable,n=$(t[0].cloneNode(!1)),r=$(t.find("thead")[0].cloneNode(!1)),i=$(t.find("tbody")[0].cloneNode(!1)),s="",o="",u="",a,f,l;switch(e){case"last":s="js-roll-table compTFLastRoll",o="js-fixed-table compTFLastFixed";break;case"both":s="js-fixed-table compTFBothFixed",o="js-fixed-table compTFBothFixed",u="js-roll-table compTFBothRoll";break;case"prev":default:s="js-fixed-table compTFPrevFixed",o="js-roll-table compTFPrevRoll"}return r.html("{0}").appendTo(n),i.html("{1}").appendTo(n),a=n.clone().find("thead").html("{2}").end().find("tbody").html("{3}").end(),u?(f=n.clone().find("thead").html("{4}").end().find("tbody").html("{5}").end(),l='<div class="'+s+'">'+n[0].outerHTML+"</div>"+'<div class="'+u+'">'+a[0].outerHTML+"</div>"+'<div class="'+o+'">'+f[0].outerHTML+"</div>"):l='<div class="'+s+'">'+n[0].outerHTML+"</div>"+'<div class="'+o+'">'+a[0].outerHTML+"</div>",l},creatTpl:function(){var e=this,t=e.sourceTable,n=e.freezeType(),r=e.freezeCols(),i=e.colnum(),s=e.trElement(t),o=s.theadTr,u=s.tbodyTr,a=e.getTpl(n,r,o,i),f=e.getTpl(n,r,u,i),l=e.layout(n),c;switch(n){case"both":c=JC.f.printf(l,a.leftTr,f.leftTr,a.midTr,f.midTr,a.rightTr,f.rightTr);break;case"last":case"prev":c=JC.f.printf(l,a.leftTr,f.leftTr,a.rightTr,f.rightTr)}e.selector().append(c)},getTpl:function(e,t,n,r){var i,s=[],o=[],u=[],a=t,f=0,l=0,c=this;switch(e){case"prev":s=c.getTr(n,a),u=c.getTr(n,r-a);break;case"last":s=c.getTr(n,r-a),u=c.getTr(n,a);break;case"both":a=t[0],f=t[1],l=r-a-f,s=c.getTr(n,a),o=c.getTr(n,l),u=c.getTr(n,f)}return i={leftTr:s.join(""),midTr:o.join(""),rightTr:u.join("")},i},getTr:function(e,t){var n={},r=[],i=this;return e.each(function(e){var i=$(this),s="CTF CTF"+e,o=i[0].cloneNode(!1),u=i[0].cloneNode(!1),a=i[0].cloneNode(!1),f=i.find(">th,>td"),l=[],c=[],h=[],p=0,d=0,v=i[0].cloneNode(!1);f.each(function(r,i){var s=$(this),o=s.attr("colspan"),u=s.attr("rowspan"),a={},f;if(p>=t)return!1;if(typeof u!="undefined"){u=parseInt(u,10),a={six:r,rowspan:u,colspan:o};for(var l=1;l<u;l++)if(o){o=parseInt(o,10);for(var c=0;c<o;c++)r===0?n[e+l+(r+1+c).toString()]=a:n[e+l+(r+c).toString()]=a}else r===0?n[e+l+(r+1).toString()]=a:n[e+l+r.toString()]=a}typeof o=="undefined"?p+=1:p+=parseInt(o,10),f=e+(r+1).toString();if(f in n){p+=1;if(n[f].colspan)return}s.appendTo(v)}),$(v).attr("data-ctf","CTF"+e).addClass(s),r.push($(v)[0].outerHTML)}),r},getSum:function(e){var t=1,n=e.length;while(n--)t+=e.pop();return t},beforeCreateTableCallback:function(){var e=this,t=e.selector(),n="beforeCreateTableCallback";return e.callbackProp(t,n)},afterCreateTableCallback:function(){var e=this,t=e.selector(),n="afterCreateTableCallback";return e.callbackProp(t,n)}}),JC.f.extendObject(e.View.prototype,{init:function(){},update:function(){var e=this,t=e._model.selector(),n=e._model.needProcess();n&&(e._model.creatTpl(),e.fixWidth(),e.selector().find("td:empty").html("&nbsp;"),e.fixHeight())},fixWidth:function(){var e=this,t=e.selector(),n=e._model.freezeType(),r=e._model.freezeCols(),i=e._model.initWidth,s=e._model.scrollWidth(),o=e._model.initcolnumWidth,u=o.length,a,f,l;switch(n){case"prev":a=e._model.getSum(o.slice(0,r)),f=i-a,t.find(">.js-fixed-table").width(a/i*100+"%").end().find(">.js-roll-table").width(f/i*100+"%").find(">table").width(s);break;case"last":f=e._model.getSum(o.slice(u-r,u)),a=i-f-1,t.find(">.js-fixed-table").width(f/i*100+"%").end().find(">.js-roll-table").width(a/i*100+"%").find(">table").width(s);break;case"both":a=e._model.getSum(o.slice(0,r[0])),f=e._model.getSum(o.slice(u-r[1],u)),l=i-a-f,t.find(">.js-fixed-table:eq(0)").width(a/i*100+"%").end().find(">.js-roll-table").width(l/i*100+"%").find(">table").width(s).end().end().find(">.js-fixed-table:eq(1)").width(f/i*100+"%")}},fixHeight:function(){var e=this,t=e._model.selector(),n=t.find(">.js-fixed-table:eq(0)>table>thead>tr, >.js-fixed-table:eq(0)>table>tbody>tr"),r=t.find(">.js-roll-table>table>thead>tr,>.js-roll-table>table>tbody>tr"),i=t.find(">.js-fixed-table:eq(1)>table>thead>tr, >.js-fixed-table:eq(1)>table>tbody>tr"),s=e._model.freezeType();n.each(function(e,t){var n=$(this),o=r.eq(e),u=i.eq(e),a=Math.max(n.prop("offsetHeight"),o.prop("offsetHeight"));s==="both"&&(a=Math.max(a,u.prop("offsetHeight")),u.height(a)),n.height(a),o.height(a)});return},highlight:function(){console.log("highlight")}}),$(document).ready(function(){function r(){n.off("resize",r),$("div.js_compTableFreeze").each(function(){var t=e.getInstance($(this));t&&t.update(),t._model.tempWidth=t._model.selector().prop("offsetWidth")}),n.data("CTFResizeTimeout")&&clearTimeout(n.data("CTFResizeTimeout")),n.data("CTFResizeTimeout",setTimeout(function(){n.off("resize",r),n.on("resize",r)},80))}var t=0,n=$(window);e.autoInit&&(t=e.init()),n.on("resize",r)}),JC.TableFreeze})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);