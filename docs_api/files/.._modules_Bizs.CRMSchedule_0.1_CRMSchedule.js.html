<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../modules/Bizs.CRMSchedule/0.1/CRMSchedule.js - open jquery components library</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="open jquery components library"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JC.AjaxTree.html">JC.AjaxTree</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoFixed.html">JC.AutoFixed</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.Cover.html">JC.Cover</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.DragSelect.html">JC.DragSelect</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.FChart.html">JC.FChart</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.FlowChart.html">JC.FlowChart</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.FrameUtil.html">JC.FrameUtil</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NSlider.html">JC.NSlider</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Paginator.html">JC.Paginator</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.Rate.html">JC.Rate</a></li>
            
                <li><a href="../classes/JC.Scrollbar.html">JC.Scrollbar</a></li>
            
                <li><a href="../classes/JC.ServerSort.html">JC.ServerSort</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.StepControl.html">JC.StepControl</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.CRMSchedule.html">window.Bizs.CRMSchedule</a></li>
            
                <li><a href="../classes/window.Bizs.CustomColumn.html">window.Bizs.CustomColumn</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.InputSelect.html">window.Bizs.InputSelect</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiChangeLogic.html">window.Bizs.MultiChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiselectPanel.html">window.Bizs.MultiselectPanel</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelectTree.html">window.Bizs.MultiSelectTree</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.Bizs.TaskViewer.html">window.Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.jQuery.mousewheel.html">window.jQuery.mousewheel</a></li>
            
                <li><a href="../classes/window.JSON.html">window.JSON</a></li>
            
                <li><a href="../classes/window.Raphael.html">window.Raphael</a></li>
            
                <li><a href="../classes/window.requirejs.html">window.requirejs</a></li>
            
                <li><a href="../classes/window.swfobject.html">window.swfobject</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../modules/Bizs.CRMSchedule/0.1/CRMSchedule.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
;(function(define, _win) { &#x27;use strict&#x27;; define( &#x27;Bizs.CRMSchedule&#x27;, [ &#x27;JC.BaseMVC&#x27;, &#x27;JC.Panel&#x27;, &#x27;Bizs.CRMSchedulePopup&#x27;, &#x27;JC.Tips&#x27;, &#x27;JC.DragSelect&#x27; ], function(){
/**
 * CRM 排期日期选择组件
 *
 *&lt;p&gt;&lt;b&gt;require&lt;/b&gt;:
 *   &lt;a href=&#x27;JC.BaseMVC.html&#x27;&gt;JC.BaseMVC&lt;/a&gt;
 *   , &lt;a href=&#x27;JC.Panel.html&#x27;&gt;JC.Panel&lt;/a&gt;
 *   , &lt;a href=&#x27;JC.Tips.html&#x27;&gt;JC.Tips&lt;/a&gt;
 *   , &lt;a href=&#x27;JC.DragSelect.html&#x27;&gt;JC.DragSelect&lt;/a&gt;
 *   , &lt;label&gt;Bizs.CRMSchedulePopup&lt;/label&gt;
 *&lt;/p&gt;
 *
 *&lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
 *   | &lt;a href=&#x27;http://jc2.openjavascript.org/docs_api/classes/Bizs.CRMSchedule.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
 *   | &lt;a href=&#x27;../../modules/Bizs.CRMSchedule/0.1/_demo&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
 *  
 *&lt;h2&gt;页面只要引用本脚本, 默认会自动处理 div class=&quot;js_bizCRMSchedule&quot; &lt;/h2&gt;

 *&lt;h2&gt;&lt;a href=&quot;../../modules/Bizs.CRMSchedule/0.1/_demo/data_docs.html&quot; target=&quot;_blank&quot;&gt;数据格式说明&lt;/a&gt;&lt;/h2&gt;
 *
 *&lt;h2&gt;共用的 HTML attribute&lt;/h2&gt;
 *&lt;dl&gt;
 *    &lt;dt&gt;bccInitData = json var name, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;初始化的数据&lt;dd&gt;
 *
 *    &lt;dt&gt;bccTpl = script selector&lt;/dt&gt;
 *    &lt;dd&gt;主模板&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccRowTpl = script selector&lt;/dt&gt;
 *    &lt;dd&gt;数据列模板&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccDateNavTpl = script selector&lt;/dt&gt;
 *    &lt;dd&gt;日期导航的模板&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccPopupTpl = script selector&lt;/dt&gt;
 *    &lt;dd&gt;日期弹框的主模板&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccPopupCalendarTpl = script selector&lt;/dt&gt;
 *    &lt;dd&gt;日期弹框的日历模板&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccMonthDataUrl = url&lt;/dt&gt;
 *    &lt;dd&gt;显示某个月份的数据
 *      &lt;br /&gt;?date={1}&amp;id={0}
 *      &lt;br /&gt;?date=2014-06&amp;id=1,2,3,4,5
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;bccDateRangeUrl = url&lt;/dt&gt;
 *    &lt;dd&gt;显示日期范围的数据
 *      &lt;br &gt;?id={0}&amp;start_date={1}&amp;end_date={2}
 *      &lt;br &gt;?id=1&amp;start_date=2014-05-01&amp;end_date=2014-08-31
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;bccActionType = string, default = query&lt;/dt&gt;
 *    &lt;dd&gt;
 *          排期表的操作类型: lock(锁定), edit(编辑), query(查询)
 *    &lt;/dd&gt;
 *
 *&lt;/dl&gt; 
 *
 *&lt;h2&gt;锁定模式(lock) 可用的 HTML attribute&lt;/h2&gt;
 *&lt;dl&gt;
 *    &lt;dt&gt;bccLockupDateUrl = url&lt;/dt&gt;
 *    &lt;dd&gt;锁定日期的URL
 *      &lt;br /&gt;?action=lockup&amp;id={0}&amp;date={1}
 *      &lt;br /&gt;?action=lockup&amp;id=3&amp;date=2014-04-08
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;bccUnlockDateUrl = url&lt;/dt&gt;
 *    &lt;dd&gt;解锁日期的URL
 *      &lt;br /&gt;?action=unlock&amp;&amp;id={0}&amp;date={1}
 *      &lt;br /&gt;?action=unlock&amp;&amp;id=3&amp;date=2014-04-05
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;bccLockupIdUrl = url&lt;/dt&gt;
 *    &lt;dd&gt;锁定ID的URL
 *      &lt;br /&gt;?action=lockup&amp;date={1}&amp;id={0}
 *      &lt;br /&gt;?action=lockup&amp;date=2014-04-05&amp;id=1,2,4,5
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;bccUnlockIdUrl = url&lt;/dt&gt;
 *    &lt;dd&gt;解锁ID的URL
 *      &lt;br /&gt;?action=unlock&amp;date={1}&amp;id={0}
 *      &lt;br /&gt;?action=unlock&amp;date=2014-04-07&amp;id=1,2,3,4,5
 *    &lt;/dd&gt;
 *&lt;/dl&gt;
 *
 *&lt;h2&gt;编辑模式(edit) 可用的 HTML attribute&lt;/h2&gt;
 *&lt;dl&gt;
 *    &lt;dt&gt;bccSaveSelectBox = selector&lt;/dt&gt;
 *    &lt;dd&gt;保存选中值选择器的父容器&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccSaveSelectItemTpl = script selector&lt;/dt&gt;
 *    &lt;dd&gt;保存选中值项的模板&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccSaveSelectItemClass = string, default = &quot;.js_bccSaveSelectItem&quot;&lt;/dt&gt;
 *    &lt;dd&gt;保存选中值项的css class 选择器&lt;/dd&gt;
 *
 *    &lt;dt&gt;bccDataLabelItemTpl = script selector&lt;/dt&gt;
 *    &lt;dd&gt;日期 Label 的模板&lt;/dd&gt;
 *&lt;/dl&gt;
 *
 * @namespace   window.Bizs
 * @class       CRMSchedule
 * @extends     JC.BaseMVC
 * @constructor
 * @param   {selector|string}   _selector   
 * @version dev 0.1 2014-04-26 
 * @author  qiushaowei &lt;suches@btbtd.org&gt; | 75 Team
 */
    var _jdoc = $( document ), _jwin = $( window );

    Bizs.CRMSchedule = CRMSchedule;

    function CRMSchedule( _selector ){
        _selector &amp;&amp; ( _selector = $( _selector ) );

        if( JC.BaseMVC.getInstance( _selector, CRMSchedule ) ) 
            return JC.BaseMVC.getInstance( _selector, CRMSchedule );

        JC.BaseMVC.getInstance( _selector, CRMSchedule, this );

        this._model = new CRMSchedule.Model( _selector );
        this._view = new CRMSchedule.View( this._model );

        this._init();

        JC.log( CRMSchedule.Model._instanceName, &#x27;all inited&#x27;, new Date().getTime() );
    }
    /**
     * 初始化可识别的 CRMSchedule 实例
     * @method  init
     * @param   {selector}      _selector
     * @static
     * @return  {Array of CRMScheduleInstance}
     */
    CRMSchedule.init =
        function( _selector ){
            var _r = [];
            _selector = $( _selector || document );

            if( _selector.length ){
                if( _selector.hasClass( &#x27;js_bizCRMSchedule&#x27; )  ){
                    _r.push( new CRMSchedule( _selector ) );
                }else{
                    _selector.find( &#x27;div.js_bizCRMSchedule&#x27; ).each( function(){
                        _r.push( new CRMSchedule( this ) );
                    });
                }
            }
            return _r;
        };
    /*
    CSS 样式名对照
            选定的时间  : js_pos_selected
            可预定      : js_pos_canSelect
            已预定      : js_pos_ordered
            待上线      : js_pos_preOnline
            已上线      : js_pos_online
            未上线      : js_pos_notOnline
            已锁定      : js_pos_locked
            待审核      : js_pos_preVerify


    类型对照( 默认类型为 0 )
            可预定      : 0
            已预定      : 1
            待上线      : 2
            已上线      : 3
            未上线      : 4
            已锁定      : 5
            已选择      : 6
            待审核      : 7
    */
    CRMSchedule.STATUS_CAN_SELECT   = &#x27;0&#x27;;
    CRMSchedule.STATUS_ORDERED      = &#x27;1&#x27;;
    CRMSchedule.STATUS_PRE_ONLINE   = &#x27;2&#x27;;
    CRMSchedule.STATUS_ONLINE       = &#x27;3&#x27;;
    CRMSchedule.STATUS_NOT_ONLINE   = &#x27;4&#x27;;
    CRMSchedule.STATUS_LOCKED       = &#x27;5&#x27;;
    CRMSchedule.STATUS_SELECTED     = &#x27;6&#x27;;
    CRMSchedule.STATUS_PRE_VERIFY   = &#x27;7&#x27;;

    CRMSchedule.CLASS_CAN_SELECT    = &#x27;js_pos_canSelect&#x27;;
    CRMSchedule.CLASS_ORDERED       = &#x27;js_pos_ordered&#x27;;
    CRMSchedule.CLASS_PRE_ONLINE    = &#x27;js_pos_preOnline&#x27;;
    CRMSchedule.CLASS_ONLINE        = &#x27;js_pos_online&#x27;;
    CRMSchedule.CLASS_NOT_ONLINE    = &#x27;js_pos_notOnline&#x27;;
    CRMSchedule.CLASS_LOCKED        = &#x27;js_pos_locked&#x27;;
    CRMSchedule.CLASS_SELECTED      = &#x27;js_pos_selected&#x27;;
    CRMSchedule.CLASS_PRE_VERIFY    = &#x27;js_pos_preVerify&#x27;;

    CRMSchedule.STATUS_CODE_MAP = {
        &#x27;0&#x27;                         : CRMSchedule.CLASS_CAN_SELECT
        , &#x27;1&#x27;                       : CRMSchedule.CLASS_ORDERED
        , &#x27;2&#x27;                       : CRMSchedule.CLASS_PRE_ONLINE
        , &#x27;3&#x27;                       : CRMSchedule.CLASS_ONLINE
        , &#x27;4&#x27;                       : CRMSchedule.CLASS_NOT_ONLINE
        , &#x27;5&#x27;                       : CRMSchedule.CLASS_LOCKED
        , &#x27;6&#x27;                       : CRMSchedule.CLASS_SELECTED
        , &#x27;7&#x27;                       : CRMSchedule.CLASS_PRE_VERIFY
    };

    CRMSchedule.CLASS_MAP = {
        &#x27;js_pos_canSelect&#x27;          : CRMSchedule.STATUS_CAN_SELECT
        , &#x27;js_pos_ordered&#x27;          : CRMSchedule.STATUS_ORDERED
        , &#x27;js_pos_preOnline&#x27;        : CRMSchedule.STATUS_PRE_ONLINE
        , &#x27;js_pos_online&#x27;           : CRMSchedule.STATUS_ONLINE
        , &#x27;js_pos_notOnline&#x27;        : CRMSchedule.STATUS_NOT_ONLINE
        , &#x27;js_pos_locked&#x27;           : CRMSchedule.STATUS_LOCKED
        , &#x27;js_pos_selected&#x27;         : CRMSchedule.STATUS_SELECTED
        , &#x27;js_pos_preVerify&#x27;        : CRMSchedule.STATUS_PRE_VERIFY
    };

    var _tmp = [];
    for( var k in CRMSchedule.CLASS_MAP ){
        _tmp.push( k );
    }
    CRMSchedule.ALL_CLASS = _tmp.join( &#x27; &#x27; );

    CRMSchedule.defaultDataBuild = 
        function( _data, _sdate ){
            var _t = [];
                _data.company &amp;&amp; (          _t.push( &#x27;广告主名称　: &#x27; + _data.company ) );
                _data.agencyName &amp;&amp; (       _t.push( &#x27;代理公司名称: &#x27; + _data.agencyName ) );
                _data.departmentName &amp;&amp; (   _t.push( &#x27;部门团队名称: &#x27; + _data.departmentName ) );
                _data.createUserName &amp;&amp; (   _t.push( &#x27;提交人　　　: &#x27; + _data.createUserName ) );
                _data.statusName &amp;&amp; (       _t.push( &#x27;预订任务状态: &#x27; + _data.statusName ) );
                _sdate &amp;&amp; _t.length &amp;&amp; (                 _t.push( &#x27;日期　　　　: &#x27; + _sdate ) );
                _data.title = _t.join( &#x27;\n&#x27; );
            return _data;
        };

    JC.BaseMVC.build( CRMSchedule );

    JC.f.extendObject( CRMSchedule.prototype, {
        _beforeInit:
            function(){
                //JC.log( &#x27;CRMSchedule _beforeInit&#x27;, new Date().getTime() );
            }

        , _initHanlderEvent:
            function(){
                var _p = this;

                _p.on( &#x27;inited&#x27;, function(){
                    if( _p._model.initData() ) {
                        _p.trigger( &#x27;update_layout&#x27;, [ _p._model.initData(), null, true ] );
                    }
                    _p.trigger( &#x27;init_date_nav&#x27; );
                });

                _p.on( &#x27;update_layout&#x27;, function( _evt, _d, _displayDate, _isReady ){
                    if( !_d ) return;

                    _d = Bizs.CRMSchedule.defaultDataBuild( _d, _displayDate );
                    _p._view.update( _d, _displayDate, _isReady );
                });

                _p.on( &#x27;layout_inited&#x27;, function(){
                    JC.Tips &amp;&amp; JC.Tips.init( _p.selector().find( &#x27;[title]&#x27; ) );
                });

                _p.on( &#x27;show_msg&#x27;, function( _evt, _msg, _sp, _status ){
                    if( _sp ){
                        JC.msgbox( _msg, _sp, _status || 0 );
                    }else{
                        JC.Dialog.msgbox( _msg, _status || 0 );
                    }
                });

                switch( _p._model.actionType() ){
                    case &#x27;lock&#x27;: _p._initLockHandler(); break;
                    case &#x27;edit&#x27;: _p._initEditHandler(); break;
                }

                _p.selector().delegate( &#x27;input.js_bccPopupBtn&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this )
                        , _popIns
                        ;

                    _popIns = new Bizs.CRMSchedulePopup( _sp, _p );
                });

                _p.on( &#x27;init_date_nav&#x27;, function( _evt ){
                    _p._init_date_control();
                    _p._init_date_label();
                });

                _p.on( &#x27;get_data&#x27;, function( _evt, _date ){
                    //JC.log( &#x27;get_data&#x27;, CRMSchedule.yearMonthString( _date ) );
                    var _idList = _p._model.idList(), _url = _p._model.monthDataUrl();

                    //JC.log( &#x27;_idList:&#x27;, _idList, _url );

                    if( !( _idList.length &amp;&amp; _url )  ) return;

                    JC.f.safeTimeout( function(){
                        _p.trigger( &#x27;clear_data&#x27; );

                        _url = JC.f.printf( _url, _idList.join(&#x27;,&#x27;), CRMSchedule.yearMonthString( _date ) );

                        $.get( _url ).done( function( _d ){
                            //JC.log( _d );
                            var _data = $.parseJSON( _d ), _initDate = _p._model.initDate();

                            if( _data &amp;&amp; !_data.errorno ){
                                _data.data[ &#x27;start_date&#x27; ] = JC.f.formatISODate( _initDate.sdate );
                                _data.data[ &#x27;end_date&#x27; ] = JC.f.formatISODate( _initDate.edate );
                                _data.data[ &#x27;display_date&#x27; ] = CRMSchedule.yearMonthString( _date );

                                //JC.dir( _data );

                                _p.trigger( &#x27;update_layout&#x27;, [ _data.data, _date ] );
                            }
                        });

                    }, _p, &#x27;GET_DATA&#x27;, 200 );
                });

                _p.on( &#x27;clear_data&#x27;, function( _evt ){
                    _p.selector().find( &#x27;tr.js_bccDataRow&#x27; ).remove();
                });

                _p.on( &#x27;clear&#x27;, function( _evt ){
                    _p._model.dataLabelBox().html( &#x27;&#x27; );
                });

                _p.selector().delegate( &#x27;tr.js_bccDataRow&#x27;,  &#x27;mouseenter&#x27;, function( _evt ){
                    var _sp = $( this ), _ix = parseInt( _sp.attr( &#x27;data-rowCount&#x27; ) );
                    _sp.addClass( &#x27;js_bccDataRowHover&#x27; );
                    if( _ix ){
                        _sp.prev().addClass( &#x27;js_bccDataRowHover_prev&#x27; );
                    }
                });

                _p.selector().delegate( &#x27;tr.js_bccDataRow&#x27;,  &#x27;mouseleave&#x27;, function( _evt ){
                    var _sp = $( this ), _ix = parseInt( _sp.attr( &#x27;data-rowCount&#x27; ) );
                    _sp.removeClass( &#x27;js_bccDataRowHover&#x27; );
                    if( _ix ){
                        _sp.prev().removeClass( &#x27;js_bccDataRowHover_prev&#x27; );
                    }
                });

                _p.selector().delegate( &#x27;th.js_bccDateLabel&#x27;, &#x27;mouseenter&#x27;, function( _evt ){
                    var _sp = $( this )
                        , _ix = parseInt( _sp.attr( &#x27;data-colCount&#x27; ) )
                        , _selector = JC.f.printf( &#x27;th.js_bccDateCol_{0}, td.js_bccDateCol_{0}&#x27;, _ix ) 
                        , _prevSelector = JC.f.printf( &#x27;th.js_bccDateCol_{0}, td.js_bccDateCol_{0}&#x27;, _ix - 1 ) 
                        ;
                   
                    _p.selector().find( _selector ).addClass( &#x27;js_bccDateColHover&#x27; );
                    _p.selector().find( _prevSelector ).addClass( &#x27;js_bccDateColHover&#x27; );

                });

                _p.selector().delegate( &#x27;th.js_bccDateLabel&#x27;,  &#x27;mouseleave&#x27;, function( _evt ){
                    var _sp = $( this ), _ix = parseInt( _sp.attr( &#x27;data-colCount&#x27; ) )
                        , _selector = JC.f.printf( &#x27;th.js_bccDateCol_{0}, td.js_bccDateCol_{0}&#x27;, _ix ) 
                        , _prevSelector = JC.f.printf( &#x27;th.js_bccDateCol_{0}, td.js_bccDateCol_{0}&#x27;, _ix - 1 ) 
                        ;
                   
                    _p.selector().find( _selector ).removeClass( &#x27;js_bccDateColHover&#x27; );
                    _p.selector().find( _prevSelector ).removeClass( &#x27;js_bccDateColHover&#x27; );
                });
            }

        , _init_date_control:
            function(){
                var _p = this
                    , js_bccYearSelect = _p.selector().find( &#x27;select.js_bccYearSelect&#x27; )
                    , js_bccMonthSelect = _p.selector().find( &#x27;select.js_bccMonthSelect&#x27; )
                    ;

                _p.selector().delegate( &#x27;select.js_bccYearSelect&#x27;, &#x27;change&#x27;, function( _evt ){
                    var js_bccYearSelect = _p.selector().find( &#x27;select.js_bccYearSelect&#x27; )
                        , js_bccMonthSelect = _p.selector().find( &#x27;select.js_bccMonthSelect&#x27; )
                        , _mindate = _p._model.initDate().sdate
                        , _maxdate = _p._model.initDate().edate
                        ;
                    var _sp = $( this ), _newDate = new Date( js_bccYearSelect.val(), js_bccMonthSelect.val(), 1 );

                    if( CRMSchedule.monthCompare( _maxdate, _newDate ) &lt; 0 ) {
                        _newDate = JC.f.cloneDate( _maxdate );
                    }
                    if( CRMSchedule.monthCompare( _mindate, _newDate ) &gt; 0 ) {
                        _newDate = JC.f.cloneDate( _mindate );
                    }

                    if( CRMSchedule.monthCompare( _p._model.currentDate(), _newDate ) === 0 ) return;

                    _p.trigger( &#x27;update_date_control&#x27;, _newDate );
                    _p.trigger( &#x27;get_data&#x27;, [ _newDate ] );
                });

                _p.selector().delegate( &#x27;select.js_bccMonthSelect&#x27;, &#x27;change&#x27;, function( _evt ){
                    var js_bccYearSelect = _p.selector().find( &#x27;select.js_bccYearSelect&#x27; )
                        , js_bccMonthSelect = _p.selector().find( &#x27;select.js_bccMonthSelect&#x27; )
                        ;
                    var _sp = $( this ), _newDate = new Date( js_bccYearSelect.val(), js_bccMonthSelect.val(), 1 );
                        _p.trigger( &#x27;update_date_control&#x27;, _newDate );
                        _p.trigger( &#x27;get_data&#x27;, [ _newDate ] );
                });

                _p.selector().delegate( &#x27;button.js_bccPrevMonth&#x27;, &#x27;click&#x27;, function( _evt ){
                    var js_bccYearSelect = _p.selector().find( &#x27;select.js_bccYearSelect&#x27; )
                        , js_bccMonthSelect = _p.selector().find( &#x27;select.js_bccMonthSelect&#x27; )
                        ;
                    var _sp = $( this )
                        , _date = new Date( js_bccYearSelect.val(), js_bccMonthSelect.val(), 1 )
                        , _newDate = JC.f.cloneDate( _date )
                        , _mindate = _p._model.initDate().sdate
                        ;
                    _newDate.setMonth( _newDate.getMonth() - 1 );

                    if( CRMSchedule.monthCompare( _p._model.currentDate(), _mindate ) === 0 ) return;

                    if( CRMSchedule.monthCompare( _newDate, _mindate ) &gt; -1 ){
                        _p.trigger( &#x27;update_date_control&#x27;, _newDate );
                        _p.trigger( &#x27;get_data&#x27;, [ _newDate ] );
                    }
                });

                _p.selector().delegate( &#x27;button.js_bccNextMonth&#x27;, &#x27;click&#x27;, function( _evt ){
                    var js_bccYearSelect = _p.selector().find( &#x27;select.js_bccYearSelect&#x27; )
                        , js_bccMonthSelect = _p.selector().find( &#x27;select.js_bccMonthSelect&#x27; )
                        ;
                    var _sp = $( this )
                        , _date = new Date( js_bccYearSelect.val(), js_bccMonthSelect.val(), 1 )
                        , _newDate = JC.f.cloneDate( _date )
                        , _maxdate = _p._model.initDate().edate
                        ;
                    _newDate.setMonth( _newDate.getMonth() + 1 );

                    if( CRMSchedule.monthCompare( _p._model.currentDate(), _maxdate ) === 0 ) return;

                    if( CRMSchedule.monthCompare( _newDate, _maxdate ) &lt; 1 ){
                        _p.trigger( &#x27;update_date_control&#x27;, _newDate );
                        _p.trigger( &#x27;get_data&#x27;, [ _newDate ] );
                    }
                });

                _p.on( &#x27;update_date_control&#x27;, function( _evt, _newDate ){
                    var js_bccYearSelect = _p.selector().find( &#x27;select.js_bccYearSelect&#x27; )
                        , js_bccMonthSelect = _p.selector().find( &#x27;select.js_bccMonthSelect&#x27; )
                        ;
                    js_bccYearSelect.val( _newDate.getFullYear() );

                    var _dateObj = _p._model.initDate() 
                        , _syear = _dateObj.sdate.getFullYear()
                        , _eyear = _dateObj.edate.getFullYear()
                        , _cyear = _newDate.getFullYear()
                        , _cmonth = _newDate.getMonth()
                        , _monthHtml = []
                        , _tmp

                        , _mintime = JC.f.cloneDate( _dateObj.sdate ).setDate( 1 )
                        , _maxtime = JC.f.cloneDate( _dateObj.edate ).setDate( 1 )
                        ;

                    for( var i = 0; i &lt; 12; i++ ){
                        var _nowDate = new Date( _cyear, i, 1 );
                        if( _nowDate.getTime() &lt; _mintime || _nowDate.getTime() &gt; _maxtime ) continue;
                        _tmp = &#x27;&#x27;;
                        i == _cmonth &amp;&amp; ( _tmp = &#x27;selected=&quot;selected&quot;&#x27; );
                        _monthHtml.push( JC.f.printf( &#x27;&lt;option value=&quot;{0}&quot; {2}&gt;{1}月&lt;/option&gt;&#x27;, i, i + 1, _tmp ) );
                    }

                    js_bccMonthSelect.html( _monthHtml.join(&#x27;&#x27;) );

                });
            }

        , _init_date_label:
            function(){
                var _p = this;

                _p.selector().delegate( &#x27;.js_bccDataLabelItem&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this ), _date;
                   
                    if( _sp.hasClass( &#x27;js_bccCurrentDataLabelItem&#x27; ) ) return;
                    _date = CRMSchedule.parseDate( _sp.val() );
                    _p.trigger( &#x27;get_data&#x27;, [ _date ] );
                });
            }

        , _initLockHandler:
            function(){
                var _p = this;

                _p.selector().delegate( &#x27;td.js_pos_canSelect&#x27;, &#x27;click&#x27;, function( _evt ){
                    if( _p.selector().hasClass( &#x27;js_compDragSelect&#x27; ) ) return;
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                    if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;

                    _p.trigger( &#x27;lockup&#x27;, [ _id, _date, _p._model.lockupDateUrl(), _sp, function(){
                        _sp.removeClass( CRMSchedule.ALL_CLASS )
                        .addClass( CRMSchedule.CLASS_LOCKED );
                        _p.trigger( &#x27;update_check_item_status&#x27;, [ JC.f.getJqParent( _sp, &#x27;tr&#x27; ).find( &#x27;input.js_bccCkAll&#x27; ) ] );
                    }] );

                });

                _p.selector().delegate( &#x27;td.js_pos_locked&#x27;, &#x27;click&#x27;, function( _evt ){
                    if( _p.selector().hasClass( &#x27;js_compDragSelect&#x27; ) ) return;
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                    if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;

                    _p.trigger( &#x27;unlock&#x27;, [ _id, _date, _p._model.unlockDateUrl(), _sp, function(){
                        _sp.removeClass( CRMSchedule.ALL_CLASS )
                        .addClass( CRMSchedule.CLASS_CAN_SELECT );
                        _p.trigger( &#x27;update_check_item_status&#x27;, [ JC.f.getJqParent( _sp, &#x27;tr&#x27; ).find( &#x27;input.js_bccCkAll&#x27; ) ] );
                    }] );

                });

                _p.selector().delegate( &#x27;input.js_bccCkAll&#x27;, &#x27;change&#x27;, function( _evt ){
                    var _sp = $( this ), _tr, _date = [], _items, _findItems = [];

                    JC.f.safeTimeout( function(){
                        _tr = JC.f.getJqParent( _sp, &#x27;tr&#x27; );
                        if( _sp.prop( &#x27;checked&#x27; ) ){
                            _items = _tr.find( &#x27;td.js_pos_canSelect&#x27; );
                            _items.each( function( _ix, _item ){
                                _item = $( _item );
                                if( Bizs.CRMSchedule.outdateCheck( _item ) ) return;
                                _date.push( _item.attr( &#x27;data-date&#x27; ) );
                                _findItems.push( _item );
                            });
                            if( !_date.length ) return;
                            _p.trigger( &#x27;lockup&#x27;, [ _tr.attr( &#x27;data-id&#x27; ), _date.join(&#x27;,&#x27;), _p._model.lockupDateUrl(), _sp
                                , function( _data, _id, _date ){
                                    $.each( _findItems, function( _ix, _item ){
                                        _item.removeClass( CRMSchedule.ALL_CLASS )
                                            .addClass( CRMSchedule.CLASS_LOCKED )
                                            ;
                                        });
                                }]);
                        }else{
                            _items = _tr.find( &#x27;td.js_pos_locked&#x27; );
                            _items.each( function( _ix, _item ){
                                _item = $( _item );
                                 if( Bizs.CRMSchedule.outdateCheck( _item ) ) return;
                                _date.push( _item.attr( &#x27;data-date&#x27; ) );
                                _findItems.push( _item );
                            });
                            if( !_date.length ) return;
                            _p.trigger( &#x27;unlock&#x27;, [ _tr.attr( &#x27;data-id&#x27; ), _date.join(&#x27;,&#x27;), _p._model.unlockDateUrl(), _sp
                                , function( _data, _id, _date ){
                                    $.each( _findItems, function( _ix, _item ){
                                        _item.removeClass( CRMSchedule.ALL_CLASS )
                                            .addClass( CRMSchedule.CLASS_CAN_SELECT )
                                            ;
                                        });
                                }] );
                        }
                    }, _sp, &#x27;LOCK_CK_ALL&#x27;, 200 );
                });

                _p.selector().delegate( &#x27;th.js_bccDateLabel[data-date]&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this ), _date = _sp.attr( &#x27;data-date&#x27; )
                        , js_pos_canSelect, js_pos_locked
                        ;
                    if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                  
                    if( !_date ) return;

                    js_pos_canSelect = _p.selector().find( JC.f.printf( &#x27;td.js_pos_canSelect[data-date={0}]&#x27;, _date ) );
                    js_pos_locked = _p.selector().find( JC.f.printf( &#x27;td.js_pos_locked[data-date={0}]&#x27;, _date ) );
                        
                    //JC.log( &#x27;th.js_bccDateLabel&#x27;, _sp.attr( &#x27;data-date&#x27; ), js_pos_canSelect.length, js_pos_locked.length, JC.f.ts() );

                    if( ( js_pos_canSelect.length + js_pos_locked.length ) == 0 ) return;

                    JC.f.safeTimeout( function(){
                        var _id = [];
                        if( js_pos_canSelect.length ){
                            js_pos_canSelect.each( function(){
                                _id.push( $( this ).attr( &#x27;data-id&#x27; ) );
                            });
                            _p.trigger( &#x27;lockup&#x27;, [ _id.join(&#x27;,&#x27;), _date, _p._model.lockupIdUrl(), _sp
                                , function( _data, _id, _date ){
                                    js_pos_canSelect.removeClass( CRMSchedule.ALL_CLASS )
                                        .addClass( CRMSchedule.CLASS_LOCKED )
                                        ;
                                    _p.trigger( &#x27;update_check_status&#x27; );
                                }]);
                        }else{
                            js_pos_locked.each( function(){
                                _id.push( $( this ).attr( &#x27;data-id&#x27; ) );
                            });
                            _p.trigger( &#x27;unlock&#x27;, [ _id.join(&#x27;,&#x27;), _date, _p._model.unlockIdUrl(), _sp
                                , function( _data, _id, _date ){
                                    js_pos_locked.removeClass( CRMSchedule.ALL_CLASS )
                                        .addClass( CRMSchedule.CLASS_CAN_SELECT )
                                        ;
                                    _p.trigger( &#x27;update_check_status&#x27; );
                                }] );
                        }
                        //JC.log( &#x27;_id:&#x27;, _id );
                    }, _sp, &#x27;LOCK_CK_ALL&#x27;, 200 );

                });

                _p.on( &#x27;lockup&#x27;, function( _evt, _id, _date, _url, _sp, _doneCb ){
                    JC.f.safeTimeout( function(){
                        //JC.log( &#x27;lockup&#x27;, _id, _date, JC.f.ts() );
                        if( !( _id &amp;&amp; _date ) ) return;
                        var _msg, _status;

                        _url = _url || _p._model.lockupDateUrl();
                        if( !_url ) return;
                        _url = JC.f.printf( _url, _id, _date );

                        $.get( _url ).done( function( _d ){
                            var _data = $.parseJSON( _d );
                            if( _data &amp;&amp; !_data.errorno ){
                                _msg = &#x27;锁定成功!&#x27;;
                                _data.errmsg &amp;&amp; ( _msg = _data.errmsg );
                                _status = 0;

                                _doneCb &amp;&amp; _doneCb( _data, _id, _date, _sp );

                            }else{
                                _msg = &#x27;锁定失败, 请重试!&#x27;;
                                _data &amp;&amp; _data.errmsg &amp;&amp; ( _msg = _data.errmsg );
                                _status = 1;
                            }
                            _p.trigger( &#x27;show_msg&#x27;, [ _msg, _sp, _status ] );
                        });
                    }, _sp, &#x27;LOCK_ITEM&#x27;, 200 );
                });

                _p.on( &#x27;unlock&#x27;, function( _evt, _id, _date, _url, _sp, _doneCb ){
                    JC.f.safeTimeout( function(){
                        //JC.log( &#x27;unlock&#x27;, _id, _date, JC.f.ts() );
                        if( !( _id &amp;&amp; _date ) ) return;
                        var _msg, _status;
                        _url = _url || _p._model.unlockDateUrl();
                        if( !_url ) return;
                        _url = JC.f.printf( _url, _id, _date );

                        $.get( _url ).done( function( _d ){
                            var _data = $.parseJSON( _d );
                            if( _data &amp;&amp; !_data.errorno ){
                                _msg = &#x27;解锁成功!&#x27;;
                                _data.errmsg &amp;&amp; ( _msg = _data.errmsg );
                                _status = 0;

                                _doneCb &amp;&amp; _doneCb( _data, _id, _date, _sp );
                            }else{
                                _msg = &#x27;解锁失败, 请重试!&#x27;;
                                _data &amp;&amp; _data.errmsg &amp;&amp; ( _msg = _data.errmsg );
                                _status = 1;
                            }
                            _p.trigger( &#x27;show_msg&#x27;, [ _msg, _sp, _status ] );
                        });

                    }, _sp, &#x27;LOCK_ITEM&#x27;, 200 );
                });

                _p.on( &#x27;layout_inited&#x27;, function( _evt ){
                    _p.trigger( &#x27;update_check_status&#x27; );
                });

                _p.on( &#x27;update_check_status&#x27;, function( _evt ){
                    var _ckLs = _p.selector().find( &#x27;input.js_bccCkAll&#x27; );
                    if( !_ckLs.length ) return;

                    _ckLs.each( function( _ix, _ckItem ){
                        _p.trigger( &#x27;update_check_item_status&#x27;, [ _ckItem ] );
                    });
                });

                _p.on( &#x27;update_check_item_status&#x27;, function( _evt, _ckItem ){
                    _ckItem = $( _ckItem );
                    var _tr = JC.f.getJqParent( _ckItem, &#x27;tr&#x27; )
                        , js_pos_canSelect = _tr.find( &#x27;td.js_pos_canSelect:not(.js_bccOutdate)&#x27; )
                        , js_pos_locked = _tr.find( &#x27;td.js_pos_locked:not(.js_bccOutdate)&#x27; )
                        ;

                    if( !( js_pos_canSelect.length || js_pos_locked.length ) ){
                        _ckItem.hide();
                        return;
                    }
                    if( js_pos_canSelect.length ){
                        _ckItem.prop( &#x27;checked&#x27;, false );
                    }else{
                        _ckItem.prop( &#x27;checked&#x27;, true );
                    }
                    _ckItem.show();
                });

            }

        , _initEditHandler:
            function(){
                var _p = this;

                _p.selector().delegate( &#x27;td.js_pos_canSelect&#x27;, &#x27;click&#x27;, function( _evt ){
                    if( _p.selector().hasClass( &#x27;js_compDragSelect&#x27; ) ) return;
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                    //JC.log( &#x27;CRMSchedule click&#x27; );
                    if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                        _p.trigger( &#x27;select_item&#x27;, [ _id, _date, _sp, function(){
                            _sp.removeClass( CRMSchedule.ALL_CLASS )
                            .addClass( CRMSchedule.CLASS_SELECTED );
                            _p.trigger( &#x27;update_check_item_status&#x27;, [ JC.f.getJqParent( _sp, &#x27;tr&#x27; ).find( &#x27;input.js_bccCkAll&#x27; ) ] );
                        }] );
                });

                _p.selector().delegate( &#x27;td.js_pos_selected&#x27;, &#x27;click&#x27;, function( _evt ){
                    if( _p.selector().hasClass( &#x27;js_compDragSelect&#x27; ) ) return;
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                    if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                        _p.trigger( &#x27;unselect_item&#x27;, [ _id, _date, _sp, function(){
                            _sp.removeClass( CRMSchedule.ALL_CLASS )
                            .addClass( CRMSchedule.CLASS_CAN_SELECT );
                            _p.trigger( &#x27;update_check_item_status&#x27;, [ JC.f.getJqParent( _sp, &#x27;tr&#x27; ).find( &#x27;input.js_bccCkAll&#x27; ) ] );
                        }] );
                });

                _p.on( &#x27;select_item&#x27;, function( _evt, _id, _date, _sp, _doneCb, _tm ){
                    JC.f.safeTimeout( function(){
                        //JC.log( &#x27;select_item&#x27;, _id, _date, JC.f.ts() );
                        if( !( _id &amp;&amp; _date ) ) return;
                        _p._model.addSelectValue( _id, _date );

                        _doneCb &amp;&amp; _doneCb( _id, _date, _sp );

                    }, _sp, &#x27;SELECT_ITEM&#x27;, _tm || 200 );
                });

                _p.on( &#x27;unselect_item&#x27;, function( _evt, _id, _date, _sp, _doneCb, _tm ){
                    JC.f.safeTimeout( function(){
                        //JC.log( &#x27;unselect_item&#x27;, _id, _date, JC.f.ts() );
                        if( !( _id &amp;&amp; _date ) ) return;
                        _p._model.removeSelectValue( _id, _date );

                        _doneCb &amp;&amp; _doneCb( _id, _date, _sp );

                    }, _sp, &#x27;SELECT_ITEM&#x27;, _tm || 200 );
                });

                _p.selector().delegate( &#x27;input.js_bccCkAll&#x27;, &#x27;change&#x27;, function( _evt ){
                    var _sp = $( this ), _tr, _date = [], _items, _findItems = [];

                    JC.f.safeTimeout( function(){
                        _tr = JC.f.getJqParent( _sp, &#x27;tr&#x27; );
                        if( _sp.prop( &#x27;checked&#x27; ) ){
                            _items = _tr.find( &#x27;td.js_pos_canSelect&#x27; );
                            _items.each( function( _ix, _item ){
                                _item = $( _item );
                                if( Bizs.CRMSchedule.outdateCheck( _item ) ) return;
                                _date.push( _item.attr( &#x27;data-date&#x27; ) );
                                _findItems.push( _item );
                            });

                            if( !_date.length ) return;

                          _p.trigger( &#x27;select_item&#x27;, [ _tr.attr( &#x27;data-id&#x27; ), _date.join(&#x27;,&#x27;), _sp
                                , function( _id, _date ){
                                    $.each( _findItems, function( _ix, _item ){
                                        _item.removeClass( CRMSchedule.ALL_CLASS )
                                            .addClass( CRMSchedule.CLASS_SELECTED )
                                            ;
                                    });
                                }, 10 ]);
                        }else{
                            _items = _tr.find( &#x27;td.js_pos_selected&#x27; );
                            _items.each( function( _ix, _item ){
                                _item = $( _item );
                                if( Bizs.CRMSchedule.outdateCheck( _item ) ) return;
                                _date.push( _item.attr( &#x27;data-date&#x27; ) );
                                _findItems.push( _item );
                            });

                            if( !_date.length ) return;

                            _p.trigger( &#x27;unselect_item&#x27;, [ _tr.attr( &#x27;data-id&#x27; ), _date.join(&#x27;,&#x27;), _sp
                                , function( _id, _date ){
                                    $.each( _findItems, function( _ix, _item ){
                                       _item.removeClass( CRMSchedule.ALL_CLASS )
                                            .addClass( CRMSchedule.CLASS_CAN_SELECT )
                                            ;
                                    });
                                }, 10 ] );
                        }
                    }, _sp, &#x27;SELECT_CK_ALL&#x27;, 200 );
                });

                _p.selector().delegate( &#x27;th.js_bccDateLabel[data-date]&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this ), _date = _sp.attr( &#x27;data-date&#x27; )
                        , js_pos_canSelect, js_pos_selected
                        ;
                    if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                  
                    if( !_date ) return;

                    js_pos_canSelect = _p.selector().find( JC.f.printf( &#x27;td.js_pos_canSelect[data-date={0}]&#x27;, _date ) );
                    js_pos_selected = _p.selector().find( JC.f.printf( &#x27;td.js_pos_selected[data-date={0}]&#x27;, _date ) );
                        
                    //JC.log( &#x27;th.js_bccDateLabel&#x27;, _sp.attr( &#x27;data-date&#x27; ), js_pos_canSelect.length, js_pos_selected.length, JC.f.ts() );

                    if( ( js_pos_canSelect.length + js_pos_selected.length ) == 0 ) return;

                    JC.f.safeTimeout( function(){
                        var _id = [];
                        if( js_pos_canSelect.length ){
                            js_pos_canSelect.each( function(){
                                _id.push( $( this ).attr( &#x27;data-id&#x27; ) );
                            });
                            _p.trigger( &#x27;select_item&#x27;, [ _id.join(&#x27;,&#x27;), _date, _sp
                                , function( _data, _id, _date ){
                                    js_pos_canSelect.removeClass( CRMSchedule.ALL_CLASS )
                                        .addClass( CRMSchedule.CLASS_SELECTED )
                                        ;
                                    _p.trigger( &#x27;update_check_status&#x27; );
                                }, 10 ]);
                        }else{
                            js_pos_selected.each( function(){
                                _id.push( $( this ).attr( &#x27;data-id&#x27; ) );
                            });
                            _p.trigger( &#x27;unselect_item&#x27;, [ _id.join(&#x27;,&#x27;), _date, _sp
                                , function( _data, _id, _date ){
                                    js_pos_selected.removeClass( CRMSchedule.ALL_CLASS )
                                        .addClass( CRMSchedule.CLASS_CAN_SELECT )
                                        ;
                                    _p.trigger( &#x27;update_check_status&#x27; );
                                }, 10 ] );
                        }
                        //JC.log( &#x27;_id:&#x27;, _id );
                    }, _sp, &#x27;SELECT_CK_ALL&#x27;, 200 );

                });

                _p.on( &#x27;layout_inited&#x27;, function( _evt ){
                    _p.trigger( &#x27;fill_selected_items&#x27; );
                    _p.trigger( &#x27;update_check_status&#x27; );
                });

                _p.on( &#x27;update_check_status&#x27;, function( _evt ){
                    var _ckLs = _p.selector().find( &#x27;input.js_bccCkAll&#x27; );
                    if( !_ckLs.length ) return;

                    _ckLs.each( function( _ix, _ckItem ){
                        _p.trigger( &#x27;update_check_item_status&#x27;, [ _ckItem ] );
                    });
                });

                _p.on( &#x27;update_check_item_status&#x27;, function( _evt, _ckItem ){
                    _ckItem = $( _ckItem );
                    var _tr = JC.f.getJqParent( _ckItem, &#x27;tr&#x27; )
                        , js_pos_canSelect = _tr.find( &#x27;td.js_pos_canSelect:not(.js_bccOutdate)&#x27; )
                        , js_pos_selected = _tr.find( &#x27;td.js_pos_selected:not(.js_bccOutdate)&#x27; )
                        ;

                    if( !( js_pos_canSelect.length || js_pos_selected.length ) ){
                        _ckItem.hide();
                        return;
                    }
                    if( js_pos_canSelect.length ){
                        _ckItem.prop( &#x27;checked&#x27;, false );
                    }else{
                        _ckItem.prop( &#x27;checked&#x27;, true );
                    }
                    _ckItem.show();
                });

                _p.on( &#x27;fill_selected_items&#x27;, function( _evt ){
                    var _selectedItems = _p._model.saveSelectItems();
                    //JC.log( &#x27;fill_selected_items&#x27;, _selectedItems.length );

                    _selectedItems.each( function( _ix, _item ){
                        _item = $( _item );
                        var _id = _item.attr( &#x27;data-id&#x27; )
                            , _dates = _item.val().replace( /[\s]+/g, &#x27;&#x27; )
                            , _validDate = []
                            ;

                        _dates = _dates ? _dates.split( &#x27;,&#x27; ) : [];

                        for( var i = _dates.length - 1; i &gt;= 0; i-- ){

                            var _dateItem = _dates[i]
                                ,_posItem = _p.selector().find( JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;
                                                                            , _id, _dateItem
                                                                            ) )
                                ;

                            if( _posItem.length ){
                                if( !( _posItem.hasClass( CRMSchedule.CLASS_CAN_SELECT ) 
                                        || _posItem.hasClass( CRMSchedule.CLASS_SELECTED ) ) ){
                                    _dates.splice( i, 1 );
                                }else{
                                    _posItem.removeClass( CRMSchedule.ALL_CLASS )
                                        .addClass( CRMSchedule.CLASS_SELECTED )
                                        ;
                                    _validDate.push( _dateItem );
                                }
                            }
                        };

                        _item.val( _dates.join( &#x27;,&#x27; ) );
                        !_item.val() &amp;&amp; _item.remove();
                    });
                });

                _p.on( &#x27;clear_init_data&#x27;, function( _evt ){
                    _p._model.saveSelectItems().remove();
                });

            }

        , _inited:
            function(){
                //JC.log( &#x27;CRMSchedule _inited&#x27;, new Date().getTime() );
                this.trigger( &#x27;inited&#x27; );
            }
        /**
         * 更新数据
         * @method  update
         * @param   {json}  _data
         */
        , update:
            function( _data ){
                var _p = this;
                _p.trigger( &#x27;clear_init_data&#x27; );
                _p.trigger( &#x27;update_layout&#x27;, [ _data, null, true ] );
                return this;
            }
    });

    CRMSchedule.Model._instanceName = &#x27;JCCRMSchedule&#x27;;
    JC.f.extendObject( CRMSchedule.Model.prototype, {
        init:
            function(){
                //JC.log( &#x27;CRMSchedule.Model.init:&#x27;, new Date().getTime() );
            }

        , initData: function(){ return this.windowProp( &#x27;bccInitData&#x27; ); }

        , dataLabelBox: function(){ return this.selector().find( &#x27;js_bccDataLabelBox&#x27;); }
        , dataLabelItemTpl: function(){ return JC.f.scriptContent( this.selectorProp( &#x27;bccDataLabelItemTpl&#x27; ) ); }

        , saveSelectBox: function(){ return this.selectorProp( &#x27;bccSaveSelectBox&#x27; ); }
        , saveSelectItems: 
            function(){ 
                return this.saveSelectBox().find( this.saveSelectItemClass() );
            }
        , saveSelectItemTpl: function(){ return JC.f.scriptContent( this.selectorProp( &#x27;bccSaveSelectItemTpl&#x27; ) ); }
        , saveSelectItemClass: function(){ return this.attrProp( &#x27;bccSaveSelectItemClass&#x27; ); }
        , saveValueSelector:
            function( _id ){
                var _p = this
                    , _r = _p.saveSelectBox().find( JC.f.printf( &#x27;{0}[data-id={1}]&#x27;, _p.saveSelectItemClass(), _id ) )
                    ;

                if( !_r.length ){
                    _r = $( JC.f.printf( _p.saveSelectItemTpl(), _id ) );
                    _r.appendTo( _p.saveSelectBox() );
                }

                return _r;
            }
        , addSelectValue:
            function( _idList, _dateList ){
                var _p = this
                    , _id, _date
                    ;
                _idList = _idList.replace( /[\s]+/g, &#x27;&#x27; );
                _dateList = _dateList.replace( /[\s]+/g, &#x27;&#x27; );

                if( !( _idList &amp;&amp; _dateList ) ) return;

                _id = _idList.split( &#x27;,&#x27; );
                _date = _dateList.split( &#x27;,&#x27; );
                
                $.each( _id, function( _ix, _idItem ){
                    var _selector = _p.saveValueSelector( _idItem )
                        , _items = _selector.val().replace( /[\s]+/g, &#x27;&#x27; )
                        , _newItemObj = {}
                        ;
                    _items = _items ? _items.split( &#x27;,&#x27; ) : [];

                    $.each( _date, function( _dateIx, _dateItem ){
                        if( _items.indexOf( _dateItem ) &lt; 0 ){
                            _newItemObj[ _dateItem ] = _dateItem;
                        }
                    });
                    for( var k in _newItemObj ) _items.push( k );

                    _selector.val( _items.join(&#x27;,&#x27;) );
                });
            }
        , removeSelectValue:
            function( _idList, _dateList ){
                var _p = this
                    , _id, _date
                    ;
                _idList = _idList.replace( /[\s]+/g, &#x27;&#x27; );
                _dateList = _dateList.replace( /[\s]+/g, &#x27;&#x27; );

                if( !( _idList &amp;&amp; _dateList ) ) return;

                _id = _idList.split( &#x27;,&#x27; );
                _date = _dateList.split( &#x27;,&#x27; );
                
                $.each( _id, function( _ix, _idItem ){
                    var _selector = _p.saveValueSelector( _idItem )
                        , _items = _selector.val().replace( /[\s]+/g, &#x27;&#x27; )
                        , _newItemObj = {}
                        , _itemIx
                        ;
                    _items = _items ? _items.split( &#x27;,&#x27; ) : [];

                    $.each( _date, function( _dateIx, _dateItem ){
                        if( ( _itemIx = _items.indexOf( _dateItem ) ) &gt; -1 ){
                            _items.splice( _itemIx, 1 );
                        }
                    });

                    _selector.val( _items.join(&#x27;,&#x27;) );
                    !_selector.val() &amp;&amp; _selector.remove();
                });
            }


        , tpl: function(){ return JC.f.scriptContent( this.selectorProp( &#x27;bccTpl&#x27; ) ); }
        , rowTpl: function(){ return JC.f.scriptContent( this.selectorProp( &#x27;bccRowTpl&#x27; ) ); }
        , dateNavTpl: function(){ return JC.f.scriptContent( this.selectorProp( &#x27;bccDateNavTpl&#x27; ) ); }
        , popupTpl: function(){ return JC.f.scriptContent( this.selectorProp( &#x27;bccPopupTpl&#x27; ) ); }
        , popupCalendarTpl: function(){ return JC.f.scriptContent( this.selectorProp( &#x27;bccPopupCalendarTpl&#x27; ) ); }

        , idList:
            function(){
                var _p = this, _r = [];

                _p.selector().find( &#x27;td.js_pos_3&#x27; ).each( function( _ix, _item ){
                    _r.push( $( _item ).attr( &#x27;data-id&#x27; ) );
                });

                return _r;
            }

        , dateObj:
            function( _d, _displayDate ){
                var _p = this, _r = {}, _sdate, _edate, _cdate = new Date(), _yearSpan = 50;

                if( _p.actionType() == &#x27;edit&#x27; ){
                    _sdate = new Date();
                    _sdate.setDate( 1 );

                    _edate = JC.f.cloneDate( _sdate );
                    _edate.setMonth( _edate.getMonth() + _p.dateLabelLength() );
                    _edate.setDate( 0 );

                    _cdate = JC.f.cloneDate( _sdate );

                }else{
                    if( _d.start_date ){
                        _sdate = CRMSchedule.parseDate( _d.start_date );
                        if( !_displayDate ){ _displayDate = _sdate; }
                    }else{
                        _sdate = new Date();
                        _sdate.setFullYear( _sdate.getFullYear() - _yearSpan );
                    }

                    if( _d.end_date ){
                        _edate = CRMSchedule.parseDate( _d.end_date );
                        if( !_displayDate ){ _displayDate = _edate; }
                    }else{
                        _edate = new Date();
                        _edate.setFullYear( _edate.getFullYear() + _yearSpan );
                    }
                }


                if( !_displayDate ){ _displayDate = _cdate; }
                return { &quot;sdate&quot;: _sdate, &quot;edate&quot;: _edate, &quot;displayDate&quot;: _displayDate };
            }

        , currentDate: 
            function( _setter ){
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._currentDate = _setter );
                return this._currentDate;
            }

        , initDate:
            function( _setter ){
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._initDate = _setter );
                return this._initDate;
            }

        , actionType: function(){ return this.stringProp( &#x27;bccActionType&#x27; ); }

        , lockupDateUrl: function(){ return this.attrProp( &#x27;bccLockupDateUrl&#x27; ); }
        , unlockDateUrl: function(){ return this.attrProp( &#x27;bccUnlockDateUrl&#x27; ); }

        , lockupIdUrl: function(){ return this.attrProp( &#x27;bccLockupIdUrl&#x27; ); }
        , unlockIdUrl: function(){ return this.attrProp( &#x27;bccUnlockIdUrl&#x27; ); }

        , monthDataUrl: function(){ return this.attrProp( &#x27;bccMonthDataUrl&#x27; ); }

        , dateRangeUrl: function(){ return this.attrProp( &#x27;bccDateRangeUrl&#x27; ); }

        , availableDate:
            function(){
                var _r = JC.f.pureDate()

                this.attrProp( &#x27;bccAvailableDate&#x27; )
                    &amp;&amp; ( _r = JC.f.pureDate( JC.f.dateDetect( this.attrProp( &#x27;bccAvailableDate&#x27; ) ) ) );

                return _r;
            }

        , dateLabelLength:
            function(){
                var _p = this, _r = 4;
                _p.initData() 
                    &amp;&amp; ( &#x27;dateLabelLength&#x27; in _p.initData() )
                    &amp;&amp; ( _r = _p.initData().dateLabelLength );
                return _r;
            }

    });

    JC.f.extendObject( CRMSchedule.View.prototype, {
        init:
            function(){
                //JC.log( &#x27;CRMSchedule.View.init:&#x27;, new Date().getTime() );
            }

        , update: 
            function( _d, _displayDate, _isReady ){
                var _p = this
                    , _tpl = _p._model.tpl()
                    ;

                _d.display_date &amp;&amp; ( _displayDate = CRMSchedule.parseDate( _d.display_date ) );

                var _dateObj = _p._model.dateObj( _d, _displayDate )

                _isReady &amp;&amp; ( _p._model.initDate( _dateObj ) );

                var _maxDay = JC.f.maxDayOfMonth( _dateObj.displayDate )
                    , _dateHtml = _p.dateHtml( _d, _dateObj )
                    , _headerHtml = _p.headerHtml( _d, _dateObj )
                    , _rowHtml = _p.rowHtml( _d, _dateObj )
                    ;

                _p._model.currentDate( _dateObj.displayDate );

                /*
                JC.log( JC.f.formatISODate( _dateObj.sdate )
                    , JC.f.formatISODate( _dateObj.edate )
                    , JC.f.formatISODate( _dateObj.displayDate )
                    , _maxDay
                    );
                */

                _tpl = JC.f.printf( _tpl, 32, _dateHtml, _headerHtml.week, _headerHtml.date, _rowHtml  );

                _p._model.selector().html( _tpl );
                _p.trigger( &#x27;layout_inited&#x27; );
            }

        , dateHtml:
            function( _d, _dateObj ){
                var _p = this, _r = _p._model.dateNavTpl();
                if( /js_bccYearSelect/.test( _r ) ){
                    _r = _p.dateHtmlControl( _d, _dateObj, _r );
                }else{
                    _r = _p.dateHtmlLabel( _d, _dateObj, _r );
                }
                return _r;
            }

        , dateHtmlControl:
            function( _d, _dateObj, _r ){
                var _syear = _dateObj.sdate.getFullYear()
                    , _eyear = _dateObj.edate.getFullYear()
                    , _cyear = _dateObj.displayDate.getFullYear()
                    , _cmonth = _dateObj.displayDate.getMonth()
                    , _yearHtml = []
                    , _monthHtml = []
                    , _tmp

                    , _mintime = JC.f.cloneDate( _dateObj.sdate ).setDate( 1 )
                    , _maxtime = JC.f.cloneDate( _dateObj.edate ).setDate( 1 )
                    ;
                for( ; _syear &lt;= _eyear; _syear++ ){
                    _tmp = &#x27;&#x27;;
                    _syear == _cyear &amp;&amp; ( _tmp = &#x27;selected=&quot;selected&quot;&#x27; );
                    _yearHtml.push( JC.f.printf( &#x27;&lt;option value=&quot;{0}&quot; {1}&gt;{0}年&lt;/option&gt;&#x27;, _syear, _tmp ) );
                }

                for( var i = 0; i &lt; 12; i++ ){
                    var _nowDate = new Date( _cyear, i, 1 );
                    if( _nowDate.getTime() &lt; _mintime || _nowDate.getTime() &gt; _maxtime ) continue;
                    _tmp = &#x27;&#x27;;
                    i == _cmonth &amp;&amp; ( _tmp = &#x27;selected=&quot;selected&quot;&#x27; );
                    _monthHtml.push( JC.f.printf( &#x27;&lt;option value=&quot;{0}&quot; {2}&gt;{1}月&lt;/option&gt;&#x27;, i, i + 1, _tmp ) );
                }

                _r = JC.f.printf( _r, _yearHtml.join(&#x27;&#x27;), _monthHtml.join(&#x27;&#x27;) );

                return _r;
            }

        , dateHtmlLabel:
            function( _d, _dateObj, _r ){
                var _p = this;
                var _itemTpl = _p._model.dataLabelItemTpl()
                    , _html = []
                    , _initDate = _p._model.initDate()
                    , _currentMonth = _dateObj.displayDate.getMonth()
                    , _tmpDate = JC.f.cloneDate( _initDate.sdate )
                    ;

                for( var i = 0; i &lt; _p._model.dateLabelLength(); i++ ){
                    var _currentClass = &#x27;&#x27;;
                    if( _tmpDate.getMonth() === _currentMonth ){
                        _currentClass = &#x27;js_bccCurrentDataLabelItem&#x27;;
                    }
                    _html.push( JC.f.printf( _itemTpl
                            , JC.f.dateFormat( _tmpDate, &#x27;YY-MM&#x27; )
                            , JC.f.dateFormat( _tmpDate, &#x27;YY年 MM月&#x27; )
                            , _currentClass
                            )
                    );
                    _tmpDate.setMonth( _tmpDate.getMonth() + 1 );
                }

                _r = JC.f.printf( _r, _html.join( &#x27;&#x27; ) );
               
                return _r;
            }

        , rowHtml:
            function( _d, _dateObj ){
                var _p = this, _r = []
                    , _date = _dateObj.displayDate
                    , _maxDay = JC.f.maxDayOfMonth( _date )
                    , _tpl = _p._model.rowTpl()
                    , _tmpTpl
                    , _ckAll = &#x27;&#x27;
                    , _now = _p._model.availableDate()
                    ;


                if( _d.list_data ){
                    for( var i = 0, j = _d.list_data.length; i &lt; j; i++ ){
                        var _item = _d.list_data[ i ]
                            , _parent1 = &#x27;&#x27;, _parent2 = &#x27;&#x27;
                            , _parent1_id = &#x27;&#x27;, _parent2_id = &#x27;&#x27;
                            , _days = []
                            , _ckAll = &#x27;&#x27;
                            , _hasCanSelect
                            , _hasLocked
                            ;

                        if( _item.parent ){
                            _item.parent[0] 
                                &amp;&amp; ( _parent1 = _item.parent[0].name, _parent1_id = _item.parent[0].id );

                            _item.parent[1] 
                                &amp;&amp; ( _parent2 = _item.parent[1].name, _parent2_id = _item.parent[1].id );
                        }

                        for( var k = 1; k &lt;= 31; k++ ){
                            var _posDate = new Date( _date.getFullYear(), _date.getMonth(), k )
                                , _sPosDate = JC.f.formatISODate( _posDate )
                                , _status = 0
                                , _name = &#x27;&#x27;
                                , _shortName = &#x27;&#x27;
                                , _class
                                , _styleClass = &#x27;&#x27;
                                , _outdateClass = &#x27;&#x27;
                                , _title = &#x27;&#x27;
                                ;

                            k === 31 &amp;&amp; ( _styleClass = &quot;js_bccDataRowLastCell&quot; );

                            if( k &gt; _maxDay ){
                                _days.push( JC.f.printf( &#x27;&lt;td class=&quot;js_bccDateItem xnocursor {0}&quot;&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;/td&gt;&#x27;
                                            , _styleClass ) );
                                break;
                            }

                            if( _sPosDate in _item.position_date ){

                                CRMSchedule.defaultDataBuild( _item.position_date[ _sPosDate ], _sPosDate );
                                _title = _item.position_date[ _sPosDate ].title || &#x27;&#x27;;

                                _status = _item.position_date[ _sPosDate ].status;
                                _name = _item.position_date[_sPosDate].spreadProduct || _item.position_date[ _sPosDate ].company || &#x27;&#x27;;
                                _shortName = byteString( _item.position_date[_sPosDate].spreadProduct
                                                        || _item.position_date[ _sPosDate ].company
                                                        || _item.position_date[ _sPosDate ].agencyName
                                                        || _item.position_date[ _sPosDate ].departmentName
                                                        || &#x27;&#x27; 
                                                    , 6 );

                                bytelen( _name ) &gt; 6 &amp;&amp; ( _shortName += &#x27;...&#x27; );
                            }

                            _class = CRMSchedule.STATUS_CODE_MAP[ _status ] || 0;

                            _status == CRMSchedule.STATUS_CAN_SELECT &amp;&amp; ( _hasCanSelect = true );
                            _status == CRMSchedule.STATUS_LOCKED &amp;&amp; ( _hasLocked = true );

                            if( _posDate.getTime() &lt; _now.getTime() || _posDate.getTime() &gt; _p._model.initDate().edate.getTime() ){
                                switch( _status ){
                                    case 0:
                                    case 5:
                                    case 6:
                                        //_class = &#x27;&#x27;;
                                        break;
                                }
                                _outdateClass = &#x27;js_bccOutdate&#x27;;
                            }

                            _days.push( JC.f.printf( &#x27;&lt;td class=&quot;js_bccDateItem {0} {5} js_bccDateCol_{6} {7}&quot; title=&quot;{8}&quot; &#x27; 
                                        +&#x27; data-id=&quot;{2}&quot; data-date=&quot;{3}&quot; data-colCount=&quot;{6}&quot;&gt;&#x27; 
                                        +&#x27;&lt;div&gt;{4}&lt;/div&gt;&lt;/td&gt;&#x27;
                                        , _class, _name, _item.id, _sPosDate, _shortName
                                        , _styleClass, k, _outdateClass, _title ) );
                        }

                        if( _p._model.actionType() == &#x27;lock&#x27; || _p._model.actionType() == &#x27;edit&#x27; ){
                            _ckAll = &#x27;&lt;div&gt;&lt;input type=&quot;checkbox&quot; class=&quot;js_bccCkAll&quot; data-id=&quot;{0}&quot; style=&quot;display:none&quot; /&gt;&lt;/div&gt;&#x27;;
                        }
                        _ckAll = JC.f.printf( _ckAll, _item.id );

                        _tmpTpl = JC.f.printf( _tpl
                                                , _parent1, _parent2
                                                , _item.name, _days.join(&#x27;&#x27;) 
                                                , _parent1_id, _parent2_id
                                                , _item.id
                                                , _ckAll, i
                                            );

                        _r.push( _tmpTpl );
                    }
                }

                return _r.join(&#x27;&#x27;);
            }

        , headerHtml:
            function( _d, _dateObj ){
                var _p = this, _r = { week: [], date: [] }
                    , _date = _dateObj.displayDate
                    , _maxDay = JC.f.maxDayOfMonth( _date )
                    , _now = JC.f.pureDate()
                    , _tmp
                    ;

                for( var i = 0; i &lt; 31; i++ ){
                    var _cur = i + 1, _outdateClass = &#x27;&#x27;;
                    if( _cur &gt; _maxDay ){
                        _r.week.push( JC.f.printf( &#x27;&lt;th class=&quot;js_bccWeekLabel&quot;&gt;&lt;/th&gt;&#x27; ) );
                        _r.date.push( JC.f.printf( &#x27;&lt;th class=&quot;js_bccDateLabel xnocursor&quot;&gt;&lt;/th&gt;&#x27;, i + 1 ) );
                        break;
                    }
                    _date.setDate( _cur );
                    if( _date.getTime() &lt; _now.getTime() ){
                        _outdateClass = &#x27;js_bccOutdate&#x27;;
                    }
                    _r.week.push( JC.f.printf( &#x27;&lt;th class=&quot;js_bccWeekLabel&quot; data-date=&quot;{1}&quot; data-day=&quot;{2}&quot;&gt;{0}&lt;/th&gt;&#x27;
                                , CRMSchedule.WEEK_SCH[ _date.getDay() ], JC.f.formatISODate( _date ), _date.getDay()  ) );
                    _r.date.push( JC.f.printf( &#x27;&lt;th class=&quot;js_bccDateLabel js_bccDateCol_{2} {3}&quot; data-date=&quot;{1}&quot; data-colCount=&quot;{2}&quot;&gt;{0}&lt;/th&gt;&#x27;
                                , _cur, JC.f.formatISODate( _date ), i + 1, _outdateClass ) );
                }

                _r.date = _r.date.join(&#x27;&#x27;);
                _r.week = _r.week.join(&#x27;&#x27;);

                return _r;
            }

    });

    CRMSchedule.WEEK_SCH = [&#x27;日&#x27;, &#x27;一&#x27;, &#x27;二&#x27;, &#x27;三&#x27;, &#x27;四&#x27;, &#x27;五&#x27;, &#x27;六&#x27; ];

    CRMSchedule.monthCompare =
        function( _d1, _d2 ){
            var _r;
            if( _d1.getFullYear() == _d2.getFullYear() ){
                if( _d1.getMonth() == _d2.getMonth() ){
                    _r = 0;
                }else if( _d1.getMonth() &gt; _d2.getMonth() ){
                    _r = 1;
                }else if( _d1.getMonth() &lt; _d2.getMonth() ){
                    _r = -1;
                }
            }else if( _d1.getFullYear() &gt; _d2.getFullYear() ){
                _r = 1;
            }else if( _d1.getFullYear() &lt; _d2.getFullYear() ){
                _r = -1;
            }

            return _r;
        };

    CRMSchedule.yearMonthString =
        function( _d ){
            return JC.f.dateFormat( _d, &#x27;YY-MM&#x27; );
        };

    CRMSchedule.parseDate =
        function( _s ){
            var _r, _y, _m, _d;

            _s = _s.replace( /[^\d]+/g, &#x27;&#x27; );

            _y = _s.slice( 0, 4 );
            _m = parseInt( _s.slice( 4, 6 ), 10 ) - 1;
            _d = _s.slice( 6 );

            _d = _d || 1;

            _r = new Date(  _y, _m, _d );

            return _r;
        };

    CRMSchedule.outdateCheck =
        function( _selector ){
            var _r = false;
            if( _selector.attr( &#x27;data-date&#x27; ) ){
                var _dt = JC.f.pureDate( JC.f.parseISODate( _selector.attr( &#x27;data-date&#x27; ) ) )
                    , _md = JC.f.pureDate( JC.f.dateDetect( &#x27;now, 1d&#x27; ) )
                    ;
                //JC.log( _selector.attr( &#x27;data-date&#x27; ), _dt.getTime(), _md.getTime() );
                if( _dt.getTime() &lt; _md.getTime() ) _r = true;
            }
            return _r;
        }

    function byteString( _s, _len ){
        var _r = [], _count = 0, _char;
        for( var i = 0, j = _s.length; i &lt; j; i++ ){
            _char = _s.charAt( i );
            _count += bytelen( _char );
            if( _count &gt; _len ) break;
            _r.push ( _char );
        }
        return _r.join(&#x27;&#x27;);
    }

    function bytelen( _s ){
        return _s.replace(/[^\x00-\xff]/g,&quot;11&quot;).length;
    }

    CRMSchedule.DRAG_EDIT_ITEM_FILTER =
        function( _item, _type, _itemData, _configData ){
            var _selector = this
                , _r = true
                , _minDate = JC.f.pureDate( JC.f.dateDetect( &#x27;now,1d&#x27; ) )
                , _itemDate = JC.f.parseISODate( _item.data( &#x27;date&#x27; ) )
                ;
            _itemDate.getTime() &lt; _minDate.getTime() &amp;&amp; ( _r = false );
            return _r;
        };

    CRMSchedule.DRAG_EDIT_CALLBACK=
        function( _items, _type, _ins ){
            var _selector = this
                , _csIns = JC.BaseMVC.getInstance( _selector, Bizs.CRMSchedule )
                , _tr
                ;
            if( !_csIns ) return;

            jQuery( _items ).each( function(){
                var _sp = $( this );
                _csIns.trigger( &#x27;update_check_item_status&#x27;, [ JC.f.getJqParent( _sp, &#x27;tr&#x27; ).find( &#x27;input.js_bccCkAll&#x27; ) ] );
            });

            JC.log( &#x27;cdsCallback&#x27;, _items.length, JC.f.ts() );
        };

    CRMSchedule.DRAG_EDIT_SELECT_CALLBACK =
        function( _items, _type, _ins ){
            var _selector = this
                , _csIns = JC.BaseMVC.getInstance( _selector, Bizs.CRMSchedule )
                , _data = CRMSchedule.DRAG_ITEMS_GET_EDIT_DATA( _items );

            if( !( _csIns &amp;&amp; _data ) ) return;

            JC.log( &#x27;cdsSelectCallback&#x27;, _items.length, JC.f.ts() );
            $.each( _data, function( _k, _item ){
                _csIns._model.addSelectValue( _k, _item.join(&#x27;,&#x27;) );
            });
        };

    CRMSchedule.DRAG_EDIT_UNSELECT_CALLBACK =
        function( _items, _type, _ins ){
            var _selector = this
                , _csIns = JC.BaseMVC.getInstance( _selector, Bizs.CRMSchedule )
                , _data = CRMSchedule.DRAG_ITEMS_GET_EDIT_DATA( _items );

            if( !( _csIns &amp;&amp; _data ) ) return;

            JC.log( &#x27;cdsUnselectCallback&#x27;, _items.length, JC.f.ts() );
            $.each( _data, function( _k, _item ){
                _csIns._model.removeSelectValue( _k, _item.join(&#x27;,&#x27;) );
            });
        };

    CRMSchedule.DRAG_ITEMS_GET_EDIT_DATA =
        function( _items ){
            var _r = {};
            $.each( _items, function( _k, _item ){
                var _id = _item.data( &#x27;id&#x27; ), _date = _item.data( &#x27;date&#x27; );
                !( _id in _r ) &amp;&amp; ( _r[ _id ] = [] );
                _r[ _id ].push( _date );
            });
            return _r;
        };

    CRMSchedule.DRAG_LOCK_ITEM_FILTER =
        function( _item, _type, _itemData, _configData ){
            var _selector = this
                , _r = true
                , _minDate = JC.f.pureDate()
                , _itemDate = JC.f.parseISODate( _item.data( &#x27;date&#x27; ) )
                ;
            _itemDate.getTime() &lt; _minDate.getTime() &amp;&amp; ( _r = false );
            return _r;
        };

    CRMSchedule.DRAG_ITEMS_GET_LOCK_DATA =
        function( _items ){
            var _r = { id: [], date: [] }, _idTmp = {}, _dateTmp = {};
            $.each( _items, function( _k, _item ){
                var _id = _item.data( &#x27;id&#x27; ), _date = _item.data( &#x27;date&#x27; );
                if( !( _id in _idTmp ) ){
                    _r.id.push( _id );
                    _idTmp[ _id ] = _id;
                }
                if( !( _date in _dateTmp ) ){
                    _r.date.push( _date );
                    _dateTmp[ _date ] = _date;
                }
            });
            return _r;
        };

    CRMSchedule.DRAG_LOCK_SELECT_CALLBACK =
        function( _items, _type, _ins ){
            var _selector = this
                , _csIns = JC.BaseMVC.getInstance( _selector, Bizs.CRMSchedule )
                , _data = CRMSchedule.DRAG_ITEMS_GET_LOCK_DATA( _items )
                , _url
                ;

            if( !( _csIns &amp;&amp; _data &amp;&amp; _data.id.length &amp;&amp; _data.date.length ) ) return;
            _url = _csIns._model.lockupIdUrl();
            //JC.log( &#x27;DRAG_LOCK_SELECT_CALLBACK&#x27;, JC.f.ts(), _data.id.join(&#x27;,&#x27;), _data.date.join(&#x27;,&#x27;), _url );
            _csIns.trigger( &#x27;lockup&#x27;, [ _data.id.join(&#x27;,&#x27;), _data.date.join(&#x27;,&#x27;), _url, null, function( _rdata, _id, _date, _sp ){
                $.each( _items, function( _k, _item ){
                    _item.addClass( &#x27;js_pos_locked&#x27; );
                    _item.removeClass( &#x27;js_pos_canSelect&#x27; );
                });
                CRMSchedule.DRAG_EDIT_CALLBACK.call( _selector, _items, _type, _ins );
            }]);
        };

    CRMSchedule.DRAG_UNLOCK_SELECT_CALLBACK =
        function( _items, _type, _ins ){
            var _selector = this
                , _csIns = JC.BaseMVC.getInstance( _selector, Bizs.CRMSchedule )
                , _data = CRMSchedule.DRAG_ITEMS_GET_LOCK_DATA( _items )
                , _url
                ;

            if( !( _csIns &amp;&amp; _data &amp;&amp; _data.id.length &amp;&amp; _data.date.length ) ) return;
            _url = _csIns._model.unlockIdUrl();
            JC.log( &#x27;DRAG_LOCK_UNSELECT_CALLBACK&#x27;, JC.f.ts(), _data.id.join(&#x27;,&#x27;), _data.date.join(&#x27;,&#x27;), _url );
            _csIns.trigger( &#x27;unlock&#x27;, [ _data.id.join(&#x27;,&#x27;), _data.date.join(&#x27;,&#x27;), _url, null, function( _rdata, _id, _date, _sp ){
                $.each( _items, function( _k, _item ){
                    _item.addClass( &#x27;js_pos_canSelect&#x27; );
                    _item.removeClass( &#x27;js_pos_locked&#x27; );
                });
                CRMSchedule.DRAG_EDIT_CALLBACK.call( _selector, _items, _type, _ins );
            }]);
        };

    _jdoc.ready( function(){
        JC.f.safeTimeout( function(){
            CRMSchedule.autoInit &amp;&amp; CRMSchedule.init();
        }, null, &#x27;CRMSchedule_READY_INIT&#x27;, 1 );
    });

    return Bizs.CRMSchedule;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb ) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
