<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../modules/Bizs.DMultiDate/0.1/DMultiDate.js - open jquery components library</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="open jquery components library"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JC.AjaxTree.html">JC.AjaxTree</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoFixed.html">JC.AutoFixed</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.Cover.html">JC.Cover</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.DragSelect.html">JC.DragSelect</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.FChart.html">JC.FChart</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.FlowChart.html">JC.FlowChart</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.FrameUtil.html">JC.FrameUtil</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NSlider.html">JC.NSlider</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Paginator.html">JC.Paginator</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.Rate.html">JC.Rate</a></li>
            
                <li><a href="../classes/JC.Scrollbar.html">JC.Scrollbar</a></li>
            
                <li><a href="../classes/JC.ServerSort.html">JC.ServerSort</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.StepControl.html">JC.StepControl</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.CRMSchedule.html">window.Bizs.CRMSchedule</a></li>
            
                <li><a href="../classes/window.Bizs.CustomColumn.html">window.Bizs.CustomColumn</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.InputSelect.html">window.Bizs.InputSelect</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiChangeLogic.html">window.Bizs.MultiChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiselectPanel.html">window.Bizs.MultiselectPanel</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelectTree.html">window.Bizs.MultiSelectTree</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.Bizs.TaskViewer.html">window.Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.jQuery.mousewheel.html">window.jQuery.mousewheel</a></li>
            
                <li><a href="../classes/window.JSON.html">window.JSON</a></li>
            
                <li><a href="../classes/window.Raphael.html">window.Raphael</a></li>
            
                <li><a href="../classes/window.requirejs.html">window.requirejs</a></li>
            
                <li><a href="../classes/window.swfobject.html">window.swfobject</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../modules/Bizs.DMultiDate/0.1/DMultiDate.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
;(function(define, _win) { &#x27;use strict&#x27;; define( &#x27;Bizs.DMultiDate&#x27;, [ &#x27;JC.BaseMVC&#x27;, &#x27;JC.Calendar&#x27; ], function(){
    window.Bizs.DMultiDate = DMultiDate;
    /**
     * DMultiDate 复合日历业务逻辑
     * &lt;br/&gt; Dom 加载后会自动加载页面上所有.js_autoDMultiDate的标签
     * &lt;p&gt;&lt;b&gt;require&lt;/b&gt;: 
     *      &lt;a href=&#x27;JC.BaseMVC.html&#x27;&gt;JC.BaseMVC&lt;/a&gt;
     *      , &lt;a href=&#x27;JC.Calendar.html&#x27;&gt;JC.Calendar&lt;/a&gt;
     * &lt;/p&gt;
     * &lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
     * | &lt;a href=&#x27;http://jc2.openjavascript.org/docs_api/classes/window.Bizs.DMultiDate.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
     * | &lt;a href=&#x27;../../modules/Bizs.DMultiDate/0.1/_demo&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
     *
     * &lt;h2&gt;可用的html属性&lt;/h2&gt;
     * &lt;dl&gt;
     *    &lt;dt&gt;mddate = css selector&lt;/dt&gt;
     *    &lt;dd&gt;声明日期input[type=text][datatype=daterange]的标签&lt;br/&gt;
     *        如果缺省则自动查找子元素.js_multidate&lt;/dd&gt;
     *
     *    &lt;dt&gt;mdstartdate = css selector&lt;/dt&gt;
     *    &lt;dd&gt;声明开始日期的隐藏域标签, 默认查找子元素.js_startdate&lt;/dd&gt;
     *
     *    &lt;dt&gt;mdenddate = css selector&lt;/dt&gt;
     *    &lt;dd&gt;声明结束日期的隐藏域标签, 默认查找子元素.js_enddate&lt;/dd&gt;
     *
     *    &lt;dt&gt;mddayrange = num&lt;/dt&gt;
     *    &lt;dd&gt;声明时间粒度为日时，最长可选取多少天，如果不需要则不声明此属性&lt;/dd&gt;
     *
     *    &lt;dt&gt;mdweekrange = num&lt;/dt&gt;
     *    &lt;dd&gt;声明时间粒度为周时，最长可选取多少周，如果不需要则不声明此属性&lt;/dd&gt;
     *
     *    &lt;dt&gt;mdmonthrange = num&lt;/dt&gt;
     *    &lt;dd&gt;声明时间粒度为月时，最长可选取多少月，如果不需要则不声明此属性&lt;/dd&gt;
     *
     *    &lt;dt&gt;mdseasonrange = num&lt;/dt&gt;
     *    &lt;dd&gt;声明时间粒度为季时，最长可选取多少季，如果不需要则不声明此属性&lt;/dd&gt;
     *
     *    &lt;dt&gt;mdyearrange = num&lt;/dt&gt;
     *    &lt;dd&gt;声明时间粒度为年时，最长可选取多少年，如果不需要则不声明此属性&lt;/dd&gt;
     *
     *    &lt;dt&gt;mdIgnoreUrlFill = bool, default = false&lt;/dt&gt;
     *    &lt;dd&gt;是否忽略 URL 自动填充&lt;/dd&gt;
     *
     * &lt;/dl&gt;
     *
     * @class   DMultiDate
     * @namespace   window.Bizs
     * @constructor
     * @private
     * @version dev 0.1 2014-03-03
     * @author  zuojing   &lt;zuojing1013@gmail.com&gt; | 75 Team
     */
    function DMultiDate( _selector ){
        if( DMultiDate.getInstance( _selector ) ) return DMultiDate.getInstance( _selector );
        DMultiDate.getInstance( _selector, this );

        this._model = new DMultiDate.Model( _selector );
        this._view = new DMultiDate.View( this._model );

        this._init();    
    }
    
    DMultiDate.prototype = {
        _beforeInit: function () {
            this._model.mddateEl().attr( &#x27;ignoreInitCalendarDate&#x27;, &#x27;true&#x27; ).data( &#x27;ignoreInitCalendarDate&#x27;, true );
            DMultiDate.Model._defaultMaxvalue = this._model.mddateEl().eq(0).attr(&#x27;maxvalue&#x27;) || &#x27;&#x27;;
            DMultiDate.Model._defaultMinvalue = this._model.mddateEl().eq(1).attr(&#x27;minvalue&#x27;) || &#x27;&#x27;;
        },

        _initHanlderEvent: function () {
            var _p = this,
                _count = DMultiDate.Model._inscount++,
                _updatestartcb = &#x27;Bizs.DMultiDate_update_start&#x27; + _count,
                _updateendcb = &#x27;Bizs.DMultiDate_update_end&#x27; + _count,
                _showstartcb = &#x27;Bizs.DMultiDate_show_start&#x27; + _count,
                _showendcb = &#x27;Bizs.DMultiDate_show_end&#x27; + _count,
                _hidestartcb = &#x27;Bizs.DMultiDate_hide_start&#x27; + _count,
                _hideendcb = &#x27;Bizs.DMultiDate_hide_end&#x27; + _count,
                _layoutchangestartcb = &#x27;Bizs.DMultiDate_layoutchange_start&#x27; + _count,
                _layoutchangeendcb = &#x27;Bizs.DMultiDate_layoutchange_end&#x27; + _count,
                _clearstartcb = &#x27;Bizs.DMultiDate_clear_start&#x27; + _count,
                _clearendcb = &#x27;Bizs.DMultiDate_clear_end&#x27; + _count,
                _parseweekdate = &#x27;parsedateweek&#x27;,
                _parsemonthdate = &#x27;parsedatemonth&#x27;,
                _parseseasondate = &#x27;parsedateseason&#x27;,
                _parseyeardate = &#x27;parsedateyear&#x27;;

            //如果url上有参数则回填到html tag的value;
            _p._initDefaultData();

            _p._model.calendarTypeEl().on(&#x27;change&#x27;, function (_evt, _flag) {

                var _sp = $(this),
                    _type = _sp.val();

                //日期日历类型crm后端用的是day类型，这里作一下转换
                if (_type === &#x27;day&#x27;) _type = &#x27;date&#x27;;

                _p._model.updatemddateElProp(_type);

                /**
                 *更新日历的类型day/week/season/year
                 *日历输入框，及隐藏域的值清空
                 *打开第一个日历输入框的日历面板
                 */

                if( _type == &#x27;custom&#x27; || _type == &#x27;customized&#x27; ){
                    _p._model.lastIptBox().show();
                }else{
                    _p._model.lastIptBox().hide();
                }

                if (_flag) return; 

                setTimeout( function () {
                    _p._model.setmddate(&#x27;&#x27;);
                    _p._model.setHiddenStartdate(&#x27;&#x27;);
                    _p._model.setHiddenEnddate(&#x27;&#x27;);
                    Calendar.pickDate(_p._model.mddateEl().eq(0)[0]);
                }, 10);

            });

            _p._model.mddateEl().eq(0)
                .attr(&#x27;calendarupdate&#x27;, _updatestartcb)
                .attr(&#x27;calendarshow&#x27;, _showstartcb)
                .attr(&#x27;calendarhide&#x27;, _hidestartcb)
                .attr(&#x27;calendarlayoutchange&#x27;, _layoutchangestartcb)
                .attr(&#x27;calendarclear&#x27;, _clearstartcb);

            _p._model.mddateEl().eq(1)
                .attr(&#x27;calendarupdate&#x27;, _updateendcb)
                .attr(&#x27;calendarshow&#x27;, _showendcb)
                .attr(&#x27;calendarhide&#x27;, _hideendcb)
                .attr(&#x27;calendarlayoutchange&#x27;, _layoutchangeendcb)
                .attr(&#x27;calendarclear&#x27;, _clearendcb);

            window[_updatestartcb] = function (_d, _dend, _ins) {
                console.log(&quot;_updatestartcb&quot;, JC.f.formatISODate(_d), JC.f.formatISODate(_dend));
                var _mddateEl = _p._model.mddateEl(),
                    _type = _p._model.calendarType(),
                    _newmaxdate = JC.f.cloneDate(_d),
                    _curmaxdate = DMultiDate.Model._defaultMaxvalue,
                    _range;

                _d = JC.f.formatISODate(_d);
                _curmaxdate &amp;&amp; (_curmaxdate = JC.f.dateDetect(_curmaxdate));

                switch ( _type ) {
                    case &#x27;week&#x27;:
                        _range = _p._model.weekrange();
                        _range &amp;&amp; _newmaxdate.setDate( _newmaxdate.getDate() + (_range - 1) * 7 + 6);
                        break;

                    case &#x27;month&#x27;:
                        _range = _p._model.monthrange();
                        
                        if (_range) {
                            _newmaxdate.setMonth( _newmaxdate.getMonth() + (_range - 1) );
                            _newmaxdate.setDate(JC.f.maxDayOfMonth(_newmaxdate));
                        }
                       
                        break;

                    case &#x27;season&#x27;:
                    //case &#x27;quarter&#x27;:
                        _range = _p._model.seasonrange();
                        
                        if (_range) {
                            _newmaxdate.setMonth( _newmaxdate.getMonth() + (_range - 1) * 3  + 2 );
                            _newmaxdate.setDate(JC.f.maxDayOfMonth(_newmaxdate));
                        }

                        break;

                    case &#x27;year&#x27;:
                        _range = _p._model.yearrange();
                        _range &amp;&amp; _newmaxdate.setYear( _newmaxdate.getFullYear() + _range - 1 );
                        break;

                    case &#x27;custom&#x27;: 
                    case &#x27;customized&#x27;:
                        _range = _p._model.dayrange();
                        _range &amp;&amp; _newmaxdate.setDate( _newmaxdate.getDate() + _range - 1 );
                        break;

                    case &#x27;date&#x27;:
                    default:
                        _range = _p._model.dayrange();
                        _range &amp;&amp; _newmaxdate.setDate( _newmaxdate.getDate() + _range - 1 );
                }

                if ( _range ) {

                    if ( _curmaxdate &amp;&amp; ( _curmaxdate.getTime() &lt;= _newmaxdate.getTime() ) ) {
                        _newmaxdate = _curmaxdate;
                    }

                    _mddateEl.eq(1)
                        .attr(&#x27;maxvalue&#x27;, JC.f.formatISODate(_newmaxdate))
                        .attr(&#x27;minvalue&#x27;, _d)
                        .attr(&#x27;defaultdate&#x27;, _d);
                }
                _p._model.setHiddenStartdate(_d);

                var _tmpNum = 0;
                $.each( _p._model.mddateEl(), function( _i, _item ){ 
                    if( !$( _item ).is(&quot;:hidden&quot;) ){
                        _tmpNum++;
                    }
                } );

                if ( _tmpNum == 1 ) {
                    _p._model.setHiddenEnddate(JC.f.formatISODate(_dend));
                } else {
                    if (!_p._model.mddateEl().eq(1).is(&#x27;reqmsg&#x27;) &amp;&amp;  !_p._model.hiddenEnddateEl().val() ) {
                        _p._model.setHiddenEnddate(JC.f.formatISODate(_dend));
                    }
                }
            };

            window[_updateendcb] = function (_d,_dend, _ins) {
                var _mddateEl = _p._model.mddateEl(),
                    _type = _p._model.calendarType(),
                    _mindate = new Date(_d.getFullYear(), _d.getMonth(), _d.getDate()),
                    _curmindate = DMultiDate.Model._defaultMinvalue,
                    _range,
                    _temp = new Date(_d.getFullYear(), _d.getMonth(), _d.getDate());

                _curmindate &amp;&amp; (_curmindate = JC.f.dateDetect(_curmindate));

                switch (_type) {
                    case &#x27;week&#x27;:
                        _range = _p._model.weekrange();
                        _range &amp;&amp; _mindate.setDate( _mindate.getDate() - (_range - 1) * 7 );
                        break;

                    case &#x27;month&#x27;:
                        _range = _p._model.monthrange();
                        _range &amp;&amp; (_mindate.setMonth( _mindate.getMonth() - (_range - 1) ) &amp;&amp; _temp.setDate(JC.f.maxDayOfMonth(_d)));
                        break;

                    case &#x27;season&#x27;:
                    //case &#x27;quarter&#x27;:
                        _range = _p._model.seasonrange();
                        _range &amp;&amp; (_mindate.setMonth( _mindate.getMonth() - (_range - 1) * 3 ));
                        break;

                    case &#x27;year&#x27;:
                        _range = _p._model.yearrange();
                        _range &amp;&amp; (_mindate.setYear( _mindate.getFullYear() - _range + 1 ));
                        break;

                    case &#x27;custom&#x27;:
                    case &#x27;customized&#x27;:
                        _range = _p._model.dayrange();
                        _range &amp;&amp; _mindate.setDate(_mindate.getDate() - _range + 1  );    
                        break;

                    case &#x27;date&#x27;:
                    default:
                        _range = _p._model.dayrange();
                        _range &amp;&amp; _mindate.setDate(_mindate.getDate() - _range + 1  );    
                }

                if (_range) {

                    if ( _curmindate &amp;&amp; _curmindate.getTime() &gt; _mindate.getTime() ) {
                        _mindate = _curmindate;
                    }

                    _mindate = JC.f.formatISODate(_mindate);
                    _mddateEl.eq(0)
                        .attr(&#x27;maxvalue&#x27;, JC.f.formatISODate(_temp))
                        .attr(&#x27;minvalue&#x27;, _mindate)
                        .attr(&#x27;defaultdate&#x27;, _mindate);
                }

                _p._model.setHiddenEnddate(JC.f.formatISODate(_dend));
                if (!_p._model.mddateEl().eq(0).is(&#x27;reqmsg&#x27;) &amp;&amp; !_p._model.hiddenStartdateEl().val() ) {
                    _p._model.setHiddenStartdate(JC.f.formatISODate(_d));
                }
            };

            window[_showstartcb] = function () {
        
                var _layout = $(&#x27;body &gt; div.UXCCalendar:visible&#x27;);
                
                _layout.length &amp;&amp; JC.Tips &amp;&amp; JC.Tips.init( _layout.find(&#x27;[title]&#x27;) );
            };

            window[_showendcb] = function () {
                var _layout = $(&#x27;body &gt; div.UXCCalendar:visible&#x27;);
            
                _layout.length &amp;&amp; JC.Tips &amp;&amp; JC.Tips.init( _layout.find(&#x27;[title]&#x27;) );
            };
            
            window[_hidestartcb] = function () {
                JC.Tips &amp;&amp; JC.Tips.hide();
                if (!_p._model.hiddendateiso()) {
                    _p._model.updateHiddenStartdate();
                }
                
            };

            window[_hideendcb] = function () {
                JC.Tips &amp;&amp; JC.Tips.hide();
                if (!_p._model.hiddendateiso()) {
                    _p._model.updateHiddenEnddate();
                }
            };

            window[_layoutchangestartcb] = function () {
                JC.Tips &amp;&amp; JC.Tips.hide();
                var _layout = $(&#x27;body &gt; div.UXCCalendar:visible&#x27;);
                _layout.length &amp;&amp; JC.Tips &amp;&amp; JC.Tips.init( _layout.find(&#x27;[title]&#x27;) );
            };

            window[_layoutchangeendcb] = function () {
                JC.Tips &amp;&amp; JC.Tips.hide();
                var _layout = $(&#x27;body &gt; div.UXCCalendar:visible&#x27;);
                _layout.length &amp;&amp; JC.Tips &amp;&amp; JC.Tips.init( _layout.find(&#x27;[title]&#x27;) );
            };

            window[_clearstartcb] = function ( _selector, _ins ) {
                var _enddateEl = _p._model.mddateEl().eq(1),
                    _maxdate = DMultiDate.Model._defaultMaxvalue,
                    _mindate = DMultiDate.Model._defaultMinvalue;

                if ( _maxdate ) {
                    _enddateEl.attr(&#x27;maxvalue&#x27;, _maxdate)
                        .attr(&#x27;defaultdate&#x27;, _maxdate );
                } else {
                    _enddateEl.removeAttr(&#x27;maxvalue&#x27;)
                        .removeAttr(&#x27;defaultdate&#x27;);
                }

                if ( _mindate ) {
                    _enddateEl.attr(&#x27;minvalue&#x27;, _mindate);
                } else {
                    _enddateEl.removeAttr(&#x27;minvalue&#x27;);
                }
                    
            };

            window[_clearendcb] = function () {
                var _enddateEl = _p._model.mddateEl().eq(0),
                    _maxdate = DMultiDate.Model._defaultMaxvalue,
                    _mindate = DMultiDate.Model._defaultMinvalue;

                if ( _maxdate ) {
                    _enddateEl.attr(&#x27;maxvalue&#x27;, _maxdate);
                } else {
                    _enddateEl.removeAttr(&#x27;maxvalue&#x27;);
                }

                if ( _mindate ) {
                    _enddateEl.attr(&#x27;minvalue&#x27;, _mindate)
                        .attr(&#x27;defaultdate&#x27;, _mindate);
                } else {
                    _enddateEl.removeAttr(&#x27;minvalue&#x27;)
                        .removeAttr(&#x27;defaultdate&#x27;);
                } 

            };

            window[_parseweekdate] = function (_dateStr) {
                _dateStr = $.trim( _dateStr || &#x27;&#x27; );
                var _r = { start: null, end: null }, _normalDate;

                if( _dateStr ){
                    _normalDate = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );
                    _dateStr = _dateStr.split( &#x27;W&#x27; );

                    if ( _normalDate.length === 8 ) {
                        _r.start = JC.f.parseISODate( _normalDate );
                        _r.end = _r.start;
                        return _r;
                    } else if( _normalDate.length === 16 ) {
                        _r.start = JC.f.parseISODate( _normalDate.slice( 0, 8 ) );
                        _r.end = JC.f.parseISODate( _normalDate.slice( 8, 16 ) );
                        return _r;
                    }

                    var _year, _week, _sdate, _edate, _weeks, _date

                    _year = parseInt( _dateStr[0], 10 );
                    _week = parseInt( _dateStr[1], 10 );
                    _sdate = JC.f.pureDate( new Date( _dateStr[0] ), 0, 1 );
                    _edate = JC.f.pureDate( new Date( _dateStr[1] ), 0, 1 );
                    _weeks = _weeks || JC.f.weekOfYear( _dateStr[0], JC.Calendar.weekDayOffset );

                    $( _weeks ).each( function( _ix, _item ){
                        if( _item.week === _week ){
                            _r.start = new Date();
                            _r.end = new Date();

                            _r.start.setTime( _item.start );
                            _r.end.setTime( _item.end );
                            return false;
                        }
                    });
                }
                
                return _r;
            };

            window[_parsemonthdate] = function (_dateStr) {
                
                _dateStr = $.trim( _dateStr || &#x27;&#x27; );
                
                var _r = { start: null, end: null }, 
                    _normalDate;

                if( _dateStr ){
                    _normalDate = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );
                    _dateStr = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );

                    if( _normalDate.length === 8 ){
                        _r.start = JC.f.parseISODate( _normalDate );
                        _r.end = _r.start;
                        return _r;
                    }else if( _normalDate.length === 16 ){
                        _r.start = JC.f.parseISODate( _normalDate.slice( 0, 8 ) );
                        _r.end = JC.f.parseISODate( _normalDate.slice( 8, 16 ) );
                        return _r;
                    }

                    var _year = _dateStr.slice( 0, 4 ), 
                        _month = parseInt( _dateStr.slice( 4, 6 ), 10 ) - 1;

                    _r.start = new Date( _year, _month, 1 );
                    _r.end = JC.f.cloneDate(_r.start);
                    _r.end.setDate(JC.f.maxDayOfMonth(_r.start));
                }

                return _r;
            };

            window[_parseseasondate] = function (_dateStr) {
                _dateStr = $.trim( _dateStr || &#x27;&#x27; );
                var _r = { start: null, end: null }, _normalDate;

                if( _dateStr ){
                    _normalDate = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );
                    _dateStr = _dateStr.split( &#x27;Q&#x27; );

                    if( _normalDate.length === 8 ){
                        _r.start = JC.f.parseISODate( _normalDate );
                        _r.end = _r.start;
                        return _r;
                    }else if( _normalDate.length === 16 ){
                        _r.start = JC.f.parseISODate( _normalDate.slice( 0, 8 ) );
                        _r.end = JC.f.parseISODate( _normalDate.slice( 8, 16 ) );
                        return _r;
                    }

                    var _year = parseInt( _dateStr[0], 10 ), _season = parseInt( _dateStr[1], 10 )
                        , _sdate = JC.f.pureDate( new Date( _dateStr[0] ), 0, 1 )
                        , _edate = JC.f.pureDate( new Date( _dateStr[1] ), 0, 1 )
                        , _seasons = JC.f.seasonOfYear( _dateStr[0] )
                        ;

                    $( _seasons ).each( function( _ix, _item ){
                        if( _item.season === _season ){
                            _r.start = new Date();
                            _r.end = new Date();

                            _r.start.setTime( _item.start );
                            _r.end.setTime( _item.end );
                            return false;
                        }
                    });
                }

                return _r;
            };

            window[_parseyeardate] = function (_dateStr) {
                _dateStr = $.trim( _dateStr || &#x27;&#x27; );
                var _r = { start: null, end: null }, _year;

                if( _dateStr ){
                    _dateStr = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );
                    _year = _dateStr.slice( 0, 4 );
                    _r.start = new Date( _year, 0, 1 );
                }

                if( !_r.start ){
                    _r.start = new Date();
                    _r.end = new Date();
                }
                return _r;
            };

            _p._model.calendarTypeEl().trigger( &#x27;change&#x27;, [ true ] );

        },

        _initDefaultData: function () {

            if( this._model.mcIgnoreUrlFill() ){
                return;
            }

            var _p = this,
                _startdate = _p._model.urlStartdate() || _p._model.mddateEl().eq(0).val(),
                _enddate = _p._model.urlEnddate() || _p._model.mddateEl().eq(1).val(),
                _type = _p._model.urlCalendarType() || _p._model.calendarType()
                ;

            _p._model.calendarTypeEl().val(_type);
            _p._model.updatemddateElProp(_type);
            
            setTimeout(function () {
                _p._model.setmddate( _startdate, _enddate );
                _p._model.setHiddenStartdate(_startdate);
                _p._model.setHiddenEnddate(_enddate);
            }, 200);
            
        }, 

        _inited:function () {
            //JC.log( &#x27;DMultiDate _inited&#x27;, new Date().getTime() );
        }
    }

    /**
     * 获取或设置 DMultiDate 的实例
     * @method  getInstance
     * @param   {selector}      _selector
     * @static
     * @return  {DMultiDateInstance}
     */
    DMultiDate.getInstance = function ( _selector, _setter ) {
        if( typeof _selector == &#x27;string&#x27; &amp;&amp; !/&lt;/.test( _selector ) ) 
                _selector = $(_selector);
        if( !(_selector &amp;&amp; _selector.length ) || ( typeof _selector == &#x27;string&#x27; ) ) return;
        typeof _setter != &#x27;undefined&#x27; &amp;&amp; _selector.data( DMultiDate.Model._instanceName, _setter );

        return _selector.data( DMultiDate.Model._instanceName );
    };

    /**
     * 判断 selector 是否可以初始化 DMultiDate
     * @method  isDMultiDate
     * @param   {selector}      _selector
     * @static
     * @return  bool
     */
    DMultiDate.isDMultiDate = function( _selector ){
        var _r;
        _selector 
            &amp;&amp; ( _selector = $(_selector) ).length 
            &amp;&amp; ( _r = _selector.is( &#x27;[DMultiDatelayout]&#x27; ) );
        return _r;
    };

    BaseMVC.buildModel( DMultiDate );
    DMultiDate.Model._instanceName = &#x27;DMultiDate&#x27;;
    DMultiDate.Model._inscount = 1;
    DMultiDate.Model._defaultMaxvalue = &#x27;&#x27;;
    DMultiDate.Model._defaultMinvalue = &#x27;&#x27;;
    
    DMultiDate.Model.prototype = {
        init: function () {
        },

        disableDateLimit:function(){
            return this.boolProp(&#x27;disabledatelimit&#x27;);
        },

        lastIptBox: function(){
            if( !this._lastIptBox ){
                this._lastIptBox = JC.f.parentSelector( this.selector(), this.selector().attr( &#x27;lastIptBox&#x27; ) );
                !this._lastIptBox &amp;&amp; ( this._lastIptBox = $( &#x27;sdfasefasdfasfsadfasdfsdf&#x27; ) );
            }
            return this._lastIptBox;
        },

        calendarTypeEl: function () {
            return this.selector().find(&#x27;&gt;select&#x27;);
        },

        mcIgnoreUrlFill: function() {
            return this.boolProp( &#x27;mdIgnoreUrlFill&#x27; );
        },

        calendarType: function () {
            return this.calendarTypeEl().val();
        },

        mddateEl: function () {
            var _p = this,
                _el = _p.attrProp(&#x27;mddateEl&#x27;) || &#x27;.js_multidate&#x27;;

            return _p.selector().find(_el);
        },

        setmddate: function (_starttime, _endtime) {
            var _el = this.mddateEl();

            _starttime &amp;&amp; ( _starttime = JC.f.dateFormat( JC.f.dateDetect( _starttime ), _el.eq(0).attr( &#x27;dateformat&#x27; ) ) );
            _endtime &amp;&amp; ( _endtime = JC.f.dateFormat( JC.f.dateDetect( _endtime ), _el.eq(1).attr( &#x27;dateformat&#x27; ) ) );

            _el.eq(0).val(_starttime);
            _el.eq(1).val(_endtime);
        },

        updatemddateElProp: function (_setter) {
            var _p = this,
                _el = _p.mddateEl();

            //_setter &amp;&amp; ( _setter.toLowerCase() == &#x27;quarter&#x27; ) &amp;&amp; ( _setter = &#x27;season&#x27; );

            _el.attr(&#x27;multidate&#x27;, _setter);

            if (_setter === &#x27;date&#x27;) {
                _el.removeAttr(&#x27;dateparse&#x27;)
                    .removeAttr(&#x27;dateformat&#x27;)
                    .removeAttr(&#x27;fulldateformat&#x27;);
            } else {
                _el.eq(0).attr(&#x27;fulldateformat&#x27;, &#x27;{0}&#x27;);
                _el.eq(1).attr(&#x27;fulldateformat&#x27;, &#x27;{0}&#x27;);

                _el.attr(&#x27;dateformat&#x27;, _p.dateformartType(_setter))
                   .attr(&#x27;dateparse&#x27;, &#x27;parsedate&#x27; + _setter);   
            }

            if ( DMultiDate.Model._defaultMinvalue ) {
                _el.attr(&#x27;minvalue&#x27;, DMultiDate.Model._defaultMinvalue)
            } else {
                _el.removeAttr(&#x27;minvalue&#x27;);
            }

            if ( DMultiDate.Model._defaultMaxvalue ) {
                _el.attr(&#x27;maxvalue&#x27;, DMultiDate.Model._defaultMaxvalue)
                    .attr(&#x27;defaultdate&#x27;, DMultiDate.Model._defaultMaxvalue);
            } else {
                _el.removeAttr(&#x27;maxvalue&#x27;).removeAttr(&#x27;defaultdate&#x27;);
            }
            
        },

        dateformartType: function (_setter) {
            var _r;

            switch (_setter) {
                case &#x27;week&#x27;:
                    _r = &#x27;YYWWK&#x27;;
                    break;
                case &#x27;month&#x27;:
                    _r = &#x27;YY-MM&#x27;;
                    break;
                case &#x27;season&#x27;:
                //case &#x27;quarter&#x27;:
                    _r = &#x27;YYQYQ&#x27;;
                    break;
                case &#x27;year&#x27;:
                    _r = &#x27;YY&#x27;;
                    break;
                case &#x27;date&#x27;:
                default:
                    _r = &#x27;&#x27;; 
            }

            return _r;
        },

        hiddenStartdateEl: function () {
            var _p = this,
                _el = _p.attrProp(&#x27;mdstartdate&#x27;) || &#x27;.js_startdate&#x27;;

            return _p.selector().find(_el);
        },

        hiddenEnddateEl: function () {
            var _p = this,
                _el = _p.attrProp(&#x27;mdenddate&#x27;) || &#x27;.js_enddate&#x27;;

            return _p.selector().find(_el);
        },

        setHiddenStartdate: function (_date) {
            var _p = this, _old = _date;
            if( _date ){
                _date = JC.f.parseDate( _date, _p.mddateEl().first() );
                _date &amp;&amp; ( _date = JC.f.dateFormat( _date, _p.hiddendateiso() ? &#x27;&#x27; : _p.mddateEl().first().attr( &#x27;dateformat&#x27; ) ) );
                !_date &amp;&amp; ( _date = _old );
            }
            _p.hiddenStartdateEl().val(_date);
        },

        setHiddenEnddate: function (_date) {
            var _p = this, _old = _date;
            if( _date ){
                _date = JC.f.parseDate( _date, _p.mddateEl().first() );
                _date &amp;&amp; ( _date = JC.f.dateFormat( _date,  _p.hiddendateiso() ? &#x27;&#x27; : _p.mddateEl().first().attr( &#x27;dateformat&#x27; ) ) );
                !_date &amp;&amp; ( _date = _old );
            }
            _p.hiddenEnddateEl().val(_date);
        },

        updateHiddenStartdate: function () {
            var _p = this,
                _date = _p.mddateEl().eq(0).val();

            if ( !_date ) {
                _p.setHiddenStartdate(&#x27;&#x27;);
                return;
            }

            _p.setHiddenStartdate(_date);
        },

        updateHiddenEnddate: function () {
            var _p = this,
                _date = _p.mddateEl().eq(1).val();

            if ( !_date ) {
                _p.setHiddenEnddate(&#x27;&#x27;);
                return;
            }

            _p.setHiddenEnddate(_date);
        },

        urlCalendarType: function () {
            var _p = this;

            //需要转为小写

            return _p.decodedata( JC.f.getUrlParam(_p.calendarTypeEl().attr(&#x27;name&#x27;) || &#x27;&#x27;) || &#x27;&#x27; ).toLowerCase();
        },

        urlStartdate: function () {
            var _p = this;

            //不能转为小写

            return _p.decodedata( JC.f.getUrlParam(_p.hiddenStartdateEl().attr(&#x27;name&#x27;) || &#x27;&#x27;) || &#x27;&#x27;);
        },

        urlEnddate: function () {
            var _p = this;

            //不能转为小写

            return _p.decodedata( JC.f.getUrlParam(_p.hiddenEnddateEl().attr(&#x27;name&#x27;) || &#x27;&#x27;) || &#x27;&#x27; );
        },

        decodedata: function ( _d ) {
            _d = _d.replace( /[\+]/g, &#x27; &#x27; );
            
            //这里取url参数需要转码
            try { 
                _d = decodeURIComponent( _d ); 
            } catch (ex) {

            }

            return _d;
        },

        dayrange: function () {
            return this.intProp(&#x27;mddayrange&#x27;);
        },

        weekrange: function () {
            return this.intProp(&#x27;mdweekrange&#x27;);
        },　

        monthrange: function () {
            return this.intProp(&#x27;mdmonthrange&#x27;);
        },

        seasonrange: function () {
            return this.intProp(&#x27;mdseasonrange&#x27;);
        },

        yearrange: function () {
            return this.intProp(&#x27;mdyearrange&#x27;);
        },

        hiddendateiso: function () {
            return this.boolProp(&#x27;hiddendateiso&#x27;);
        }

    };

    BaseMVC.buildView( DMultiDate );
    DMultiDate.View.prototype = {
        init: function () {
            return this;
        }
    };

    BaseMVC.build( DMultiDate, &#x27;Bizs&#x27; );

    $(document).ready( function(){

        JC.f.safeTimeout( function(){
            $(&#x27;.js_autoDMultiDate&#x27;).each( function(){
                new DMultiDate( $(this) );
            });
        }, null, &#x27;DMultiDatesdfasd&#x27;, 50 );

    });

    return Bizs.DMultiDate;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
