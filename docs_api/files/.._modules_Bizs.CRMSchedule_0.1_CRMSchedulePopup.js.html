<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../modules/Bizs.CRMSchedule/0.1/CRMSchedulePopup.js - open jquery components library</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="open jquery components library"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JC.AjaxTree.html">JC.AjaxTree</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoFixed.html">JC.AutoFixed</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.Cover.html">JC.Cover</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.DragSelect.html">JC.DragSelect</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.FChart.html">JC.FChart</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.FlowChart.html">JC.FlowChart</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.FrameUtil.html">JC.FrameUtil</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NSlider.html">JC.NSlider</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Paginator.html">JC.Paginator</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.Rate.html">JC.Rate</a></li>
            
                <li><a href="../classes/JC.Scrollbar.html">JC.Scrollbar</a></li>
            
                <li><a href="../classes/JC.ServerSort.html">JC.ServerSort</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.StepControl.html">JC.StepControl</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.CRMSchedule.html">window.Bizs.CRMSchedule</a></li>
            
                <li><a href="../classes/window.Bizs.CustomColumn.html">window.Bizs.CustomColumn</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.InputSelect.html">window.Bizs.InputSelect</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiChangeLogic.html">window.Bizs.MultiChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiselectPanel.html">window.Bizs.MultiselectPanel</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelectTree.html">window.Bizs.MultiSelectTree</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.Bizs.TaskViewer.html">window.Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.jQuery.mousewheel.html">window.jQuery.mousewheel</a></li>
            
                <li><a href="../classes/window.JSON.html">window.JSON</a></li>
            
                <li><a href="../classes/window.Raphael.html">window.Raphael</a></li>
            
                <li><a href="../classes/window.requirejs.html">window.requirejs</a></li>
            
                <li><a href="../classes/window.swfobject.html">window.swfobject</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../modules/Bizs.CRMSchedule/0.1/CRMSchedulePopup.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
;(function(define, _win) { &#x27;use strict&#x27;; define( &#x27;Bizs.CRMSchedulePopup&#x27;, [ &#x27;JC.BaseMVC&#x27; ], function(){
/**
 * CRMSchedule 的弹框
 * @version dev 0.1 2013-12-13
 * @author  qiushaowei &lt;suches@btbtd.org&gt; | 75 Team
 */
    var _jdoc = $( document ), _jwin = $( window );

    Bizs.CRMSchedulePopup = CRMSchedulePopup;

    function CRMSchedulePopup( _selector, _schIns ){

        CRMSchedulePopup.dispose( this );

        _selector &amp;&amp; ( _selector = $( _selector ) );

        JC.BaseMVC.getInstance( _selector, CRMSchedulePopup, this );

        this._model = new CRMSchedulePopup.Model( _selector );
        this._model.schIns( _schIns );

        this._view = new CRMSchedulePopup.View( this._model );

        this._init();

        JC.log( CRMSchedulePopup.Model._instanceName, &#x27;all inited&#x27;, new Date().getTime() );
    }

    CRMSchedulePopup.dispose =
        function( _setter ){
            if( CRMSchedulePopup.INS ){
                CRMSchedulePopup.INS.dispose();
                CRMSchedulePopup.INS = null;
            }
            _setter &amp;&amp; ( CRMSchedulePopup.INS = _setter );
        };

    JC.BaseMVC.build( CRMSchedulePopup );

    JC.f.extendObject( CRMSchedulePopup.prototype, {
        _beforeInit:
            function(){
                //JC.log( &#x27;CRMSchedulePopup _beforeInit&#x27;, new Date().getTime() );
            }

        , _initHanlderEvent:
            function(){
                var _p = this;

                _p.on( &#x27;inited&#x27;, function(){
                    _p._view.show();

                    _p.trigger( &#x27;ready&#x27; );
                });

                _p.on( &#x27;ready&#x27;, function(){
                    _p._model.prevBtn().on( &#x27;click&#x27;, function( _evt ){
                        //JC.log( &#x27;prev&#x27;, JC.f.ts() );
                        _p._model.currentDate().setMonth( _p._model.currentDate().getMonth() - 4 );
                        _p._view.updateDate( _p._model.currentDate() );
                    });

                    _p._model.nextBtn().on( &#x27;click&#x27;, function( _evt ){
                        //JC.log( &#x27;next&#x27;, JC.f.ts() );
                        _p._model.currentDate().setMonth( _p._model.currentDate().getMonth() + 4 );
                        _p._view.updateDate( _p._model.currentDate() );
                    });

                    _p.on( &#x27;clear_data&#x27;, function(){
                        _p._model.panelIns().find( &#x27;div.js_bccPopupDateItem&#x27; ).remove();
                    });

                    if( _p._model.schIns()._model.actionType() == &#x27;lock&#x27; ){
                        _p._initLockHandler();
                    }else if( _p._model.schIns()._model.actionType() == &#x27;edit&#x27; ){
                        _p._initEditHandler();
                    }
                });

                _p.on( &#x27;layout_inited&#x27;, function( _evt, _currentDate ){
                    _p.trigger( &#x27;update_nav_status&#x27;, _currentDate );
                    _p.trigger( &#x27;get_data&#x27;, _currentDate );
                });

                _p.on( &#x27;get_data&#x27;, function( _evt, _currentDate ){
                    var _startDate = _p._model.startDate( _currentDate ) 
                        , _endDate = _p._model.endDate( _currentDate ) 
                        , _url = JC.f.printf( 
                                _p._model.schIns()._model.dateRangeUrl()
                                , _p._model.id()
                                , JC.f.formatISODate( _startDate )
                                , JC.f.formatISODate( _endDate )
                            )
                        ;

                    //JC.log( JC.f.formatISODate( _startDate ), JC.f.formatISODate( _endDate ), _url );
                    JC.f.safeTimeout( function(){
                        $.get( _url ).done( function( _d ){
                            var _data = $.parseJSON( _d );
                            //JC.dir( _data );
                            _p.trigger( &#x27;update_data&#x27;, [ _data, _startDate, _endDate ] );
                        });
                    }, null, &#x27;UPDATE_CRMSCHDULE_POPUP&#x27;, 200 );
                });

                _p.on( &#x27;update_data&#x27;, function( _evt, _data, _startDate, _endDate ){
                    if( !( _startDate &amp;&amp; _endDate ) ) return;
                    _startDate = JC.f.cloneDate( _startDate );
                    if( _data &amp;&amp; !_data.errorno ){
                        var _item, _date, _now = _p._model.schIns()._model.availableDate();
                        _data 
                            &amp;&amp; _data.data 
                            &amp;&amp; _data.data.list_data
                            &amp;&amp; _data.data.list_data[0]
                            &amp;&amp; ( _item = _data.data.list_data[0] );

                        if( !_item ) return;

                        while( _startDate.getTime() &lt;= _endDate ){
                            _date = JC.f.formatISODate( _startDate );
                            var _status = 0
                                , _name = &#x27;&#x27;
                                , _selector = JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;
                                                , _item.id
                                                , _date
                                            )
                                , _title = &#x27;&#x27;
                                ;
                            //JC.log( _selector );

                            _selector = _p._model.panelIns().find( _selector );
                            if( _selector.length ){
                                if( _date in _item.position_date ){
                                    _status = _item.position_date[ _date ].status;
                                    _name = _item.position_date[ _date ].company;
                                    _p.trigger( &#x27;update_item_status&#x27;, [ _item.id, _date, _status, _item ] );
                                    _title = Bizs.CRMSchedule.defaultDataBuild( _item.position_date[ _date ], _date ).title || &#x27;&#x27;; 
                                }
                                _selector.attr( &#x27;title&#x27;, _title );

                                if( _startDate.getTime() &lt; _now.getTime() ){
                                    if( _status == 0 || _status == 6 || _status == 5 ){
                                    }else{
                                        //_selector.addClass( Bizs.CRMSchedule.STATUS_CODE_MAP[ _status ] );
                                    }
                                    _selector.addClass( Bizs.CRMSchedule.STATUS_CODE_MAP[ _status ] );
                                    _selector.addClass( &#x27;js_bccOutdate&#x27; );
                                }else{
                                    _selector.addClass( Bizs.CRMSchedule.STATUS_CODE_MAP[ _status ] );
                                }
                            }

                            _startDate.setDate( _startDate.getDate() + 1 );
                        }
                    }
                    _p.trigger( &#x27;data_inited&#x27; );
                });

                _p.on( &#x27;update_nav_status&#x27;, function( _evt, _startDate ){

                    if( _p._model.schIns()._model.actionType() == &#x27;edit&#x27; ) return;

                    var _endDate = JC.f.cloneDate( _startDate )
                        ;
                    _endDate.setMonth( _endDate.getMonth() + 3 );
                    _endDate.setDate( JC.f.maxDayOfMonth( _endDate ) );

                    if( _startDate.getTime() &lt; _p._model.mindate().getTime() ){
                        _p._model.prevBtn().hide();
                    }else{
                        _p._model.prevBtn().show();
                    }

                    if( _endDate.getTime() &gt; _p._model.maxdate().getTime() ){
                        _p._model.nextBtn().hide();
                    }else{
                        _p._model.nextBtn().show();
                    }

                });

                _p.on( &#x27;data_inited&#x27;, function( _evt ){
                    JC.Tips &amp;&amp; JC.Tips.init( _p._model.panelIns().find( &#x27;[title]&#x27; ) );
                });

            }

        , _initLockHandler:
            function(){
                var _p = this;

                _p._model.panelIns().layout().delegate( &#x27;td.js_pos_canSelect&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                        if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                        _p._model.schIns().trigger( &#x27;lockup&#x27;, [ _id, _date, _p._model.schIns()._model.lockupDateUrl(), _sp
                        , function( _data, _id, _date ){
                            $( JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;,  _id, _date ) )
                                .removeClass( Bizs.CRMSchedule.ALL_CLASS )
                                .addClass( Bizs.CRMSchedule.CLASS_LOCKED )
                                ;

                            _p._model.schIns().trigger( 
                                &#x27;update_check_item_status&#x27;
                                , [ _p._model.schIns().selector().find( 
                                        JC.f.printf( &#x27;input.js_bccCkAll[data-id={0}]&#x27;, _id ) ) ] 
                                );
                        }]);
                });

                _p._model.panelIns().layout().delegate( &#x27;td.js_pos_locked&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                        if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                        _p._model.schIns().trigger( &#x27;unlock&#x27;, [ _id, _date, _p._model.schIns()._model.unlockDateUrl(), _sp
                        , function( _data, _id, _date ){
                            $( JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;,  _id, _date ) )
                                .removeClass( Bizs.CRMSchedule.ALL_CLASS )
                                .addClass( Bizs.CRMSchedule.CLASS_CAN_SELECT )
                                ;
                            _p._model.schIns().trigger( 
                                &#x27;update_check_item_status&#x27;
                                , [ _p._model.schIns().selector().find( 
                                        JC.f.printf( &#x27;input.js_bccCkAll[data-id={0}]&#x27;, _id ) ) ] 
                                );
                        }]);
                });

            }

        , _initEditHandler:
            function(){
                var _p = this;
                _p._model.panelIns().layout().delegate( &#x27;td.js_pos_canSelect&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                        if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                        _p._model.schIns().trigger( &#x27;select_item&#x27;, [ _id, _date, _sp
                        , function( _id, _date ){
                            $( JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;,  _id, _date ) )
                                .removeClass( Bizs.CRMSchedule.ALL_CLASS )
                                .addClass( Bizs.CRMSchedule.CLASS_SELECTED )
                                ;

                            _p._model.schIns().trigger( 
                                &#x27;update_check_item_status&#x27;
                                , [ _p._model.schIns().selector().find( 
                                        JC.f.printf( &#x27;input.js_bccCkAll[data-id={0}]&#x27;, _id ) ) ] 
                                );
                        }]);
                });

                _p._model.panelIns().layout().delegate( &#x27;td.js_pos_selected&#x27;, &#x27;click&#x27;, function( _evt ){
                    var _sp = $( this ), _id = _sp.attr( &#x27;data-id&#x27; ), _date = _sp.attr( &#x27;data-date&#x27; );
                        if( Bizs.CRMSchedule.outdateCheck( _sp ) ) return;
                        _p._model.schIns().trigger( &#x27;unselect_item&#x27;, [ _id, _date, _sp
                        , function( _id, _date ){
                            $( JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;,  _id, _date ) )
                                .removeClass( Bizs.CRMSchedule.ALL_CLASS )
                                .addClass( Bizs.CRMSchedule.CLASS_CAN_SELECT )
                                ;
                            _p._model.schIns().trigger( 
                                &#x27;update_check_item_status&#x27;
                                , [ _p._model.schIns().selector().find( 
                                        JC.f.printf( &#x27;input.js_bccCkAll[data-id={0}]&#x27;, _id ) ) ] 
                                );
                        }]);
                });

                _p.on( &#x27;data_inited&#x27;, function( _evt ){
                    _p.trigger( &#x27;fill_selected_items&#x27; );
                    _p._model.schIns().trigger( &#x27;update_check_status&#x27; );
                });

                _p.on( &#x27;fill_selected_items&#x27;, function( _evt ){
                    var _selectedItems = _p._model.schIns()._model.saveSelectItems();
                    JC.log( &#x27;fill_selected_items&#x27;, _selectedItems.length );

                    _selectedItems.each( function( _ix, _item ){
                        _item = $( _item );
                        var _id = _item.attr( &#x27;data-id&#x27; )
                            , _dates = _item.val().replace( /[\s]+/g, &#x27;&#x27; )
                            , _validDate = []
                            ;

                        _dates = _dates ? _dates.split( &#x27;,&#x27; ) : [];

                        for( var i = _dates.length - 1; i &gt;= 0; i-- ){

                            var _dateItem = _dates[i]
                                ,_posItem = _p._model.panelIns().layout()
                                    .find( JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;
                                    , _id, _dateItem
                                    ) )
                                ;

                            if( _posItem.length ){
                                if( !( _posItem.hasClass( Bizs.CRMSchedule.CLASS_CAN_SELECT ) 
                                        || _posItem.hasClass( Bizs.CRMSchedule.CLASS_SELECTED ) ) ){
                                    _dates.splice( i, 1 );
                                }else{
                                    _posItem.removeClass( Bizs.CRMSchedule.ALL_CLASS )
                                        .addClass( Bizs.CRMSchedule.CLASS_SELECTED )
                                        ;
                                    _validDate.push( _dateItem );
                                }
                            }
                        };

                        _item.val( _dates.join( &#x27;,&#x27; ) );
                        !_item.val() &amp;&amp; _item.remove();
                    });
                });

                _p.on( &#x27;update_item_status&#x27;, function( _evt, _id, _date, _status, _itemData ){
                    if( _status == 0 ) return;

                    var _td = 
                        _p._model.schIns().selector().find( 
                            JC.f.printf( &#x27;td.js_bccDateItem[data-id={0}][data-date={1}]&#x27;
                                , _id, _date
                                )
                            );
                    if( _td.length ){
                        _td.removeClass( Bizs.CRMSchedule.ALL_CLASS )
                            .addClass( Bizs.CRMSchedule.STATUS_CODE_MAP[ _status ] );
                    }
                });

            }

        , _inited:
            function(){
                //JC.log( &#x27;CRMSchedulePopup _inited&#x27;, new Date().getTime() );
                this.trigger( &#x27;inited&#x27; );
            }

        , dispose:
            function(){
                this._view &amp;&amp; this._view.dispose();
            }
    });

    CRMSchedulePopup.Model._instanceName = &#x27;JCCRMSchedulePopup&#x27;;
    JC.f.extendObject( CRMSchedulePopup.Model.prototype, {
        init:
            function(){
                //JC.log( &#x27;CRMSchedulePopup.Model.init:&#x27;, new Date().getTime() );
                this.row( JC.f.getJqParent( this.selector(), &#x27;tr&#x27; ) );
                this.id( this.selector().attr( &#x27;data-id&#x27; ) );
            }

        , row: function( _setter ){ typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._row = _setter ); return this._row; }
        , id: function( _setter ){ typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._id = _setter ); return this._id; }

        , startDate:
            function( _date ){
                _date = JC.f.cloneDate( _date );

                if( _date.getTime() &lt; this.mindate().getTime() ){
                    _date = JC.f.cloneDate( this.mindate() );
                }

                return _date;
            }

        , endDate:
            function( _date ){
                _date = JC.f.cloneDate( _date );
                _date.setDate( 1 );
                _date.setMonth( _date.getMonth() + this.schIns()._model.dateLabelLength() );
                _date.setDate( 0 );

                if( _date.getTime() &gt; this.maxdate().getTime() ){
                    _date = JC.f.cloneDate( this.maxdate() );
                }

                return _date;
            }


        , mindate: function(){ return this.schIns()._model.initDate().sdate; }
        , maxdate: function(){ return this.schIns()._model.initDate().edate; }

        , schIns: function( _setter ){ typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._schIns = _setter ); return this._schIns; }

        , panelIns: function( _setter ){ typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._panelIns = _setter ); return this._panelIns; }

        , currentDate: 
            function( _setter ){ 
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._currentDate= _setter, this._currentDate.setDate( 1 ) ); 
                return this._currentDate; 
            }

        , prevBtn: function(){ return this.panelIns().find( &#x27;.js_bccPopupPrev&#x27; ); }
        , nextBtn: function(){ return this.panelIns().find( &#x27;.js_bccPopupNext&#x27; ); }

        , dateBox: function(){ return this.panelIns().find( &#x27;div.js_bccPopupDateBox&#x27; ); }

        , pos1Data:
            function(){
                var _p = this
                    , _td = _p.row().find( &#x27;td.js_pos_1&#x27; )
                    , _id = _td.attr( &#x27;data-id&#x27; )
                    , _label = _td.attr( &#x27;data-label&#x27; )
                    ;

                return { id: _id, label: _label };
            }

        , pos2Data:
            function(){
                var _p = this
                    , _td = _p.row().find( &#x27;td.js_pos_2&#x27; )
                    , _id = _td.attr( &#x27;data-id&#x27; )
                    , _label = _td.attr( &#x27;data-label&#x27; )
                    ;

                return { id: _id, label: _label };
            }

        , pos3Data:
            function(){
                var _p = this
                    , _td = _p.row().find( &#x27;td.js_pos_3&#x27; )
                    , _id = _td.attr( &#x27;data-id&#x27; )
                    , _label = _td.attr( &#x27;data-label&#x27; )
                    ;

                return { id: _id, label: _label };
            }

    });

    JC.f.extendObject( CRMSchedulePopup.View.prototype, {
        init:
            function(){
                //JC.log( &#x27;CRMSchedulePopup.View.init:&#x27;, new Date().getTime() );
            }

        , show:
            function(){
                var _p = this
                    , _tpl = _p._model.schIns()._model.popupTpl()
                    , _ctpl = _p._model.schIns()._model.popupCalendarTpl()
                    , _selector
                    , _schIns = _p._model.schIns(), _panelIns
                    , _currentDate = _p._model.currentDate( JC.f.cloneDate( _schIns._model.currentDate() ) )
                    //, _currentDate = _p._model.currentDate( new Date( 2011, 1, 1 ) )
                    ;
                if( _p._model.schIns()._model.actionType() == &#x27;edit&#x27; ){
                    _currentDate = _p._model.currentDate( JC.f.cloneDate( _schIns._model.initDate().sdate ) )
                }

                var _calendarHtml = _p.calendarHtml( _ctpl, _currentDate );

                _tpl = JC.f.printf( _tpl 
                    , _p._model.pos1Data().label
                    , _p._model.pos2Data().label
                    , _p._model.pos3Data().label
                    , _calendarHtml
                );

                _selector = $( _tpl );
                _panelIns = _p._model.panelIns( JC.Dialog( _selector ) );
                /*
                _panelIns.on( &#x27;beforeshow&#x27;, function( _evt  ){
                    if( window.parent &amp;&amp; window.parent != window ){
                        setTimeout( function(){
                            var _top = window.parent.$( window.parent.document ).scrollTop() ;

                            _panelIns.layout().css( { &#x27;top&#x27;: _top } );
                        }, 100 );
                    }
                });
                */
                _panelIns.on( &#x27;show&#x27;, function(){
                    _p.trigger( &#x27;layout_inited&#x27;, [ JC.f.cloneDate( _currentDate ) ] );
                });
            }

        , calendarHtml:
            function( _ctpl, _date ){
                var _r = [];
                _date = JC.f.cloneDate( _date );

                for( var i = 0, j = this._model.schIns()._model.dateLabelLength(), _tpl, _dates; i &lt; j; i++ ){
                    _dates = JC.f.dateFormat( _date, &#x27;YY年 MM月&#x27; );

                    _tpl = JC.f.printf( _ctpl, _dates, this.calendarRowHtml( _date ) );
                    _r.push( _tpl );
                    _date.setMonth( _date.getMonth() + 1 );
                }

                return _r.join(&#x27;&#x27;);
            }

        , calendarRowHtml:
            function( _date ){
                _date = JC.f.cloneDate( _date );

                var _p = this
                    , _r = []
                    , _count = 1
                    , _dayCount = 1
                    , _rowLen = 4
                    , _startDay = new Date( _date.getFullYear(), _date.getMonth(), 1 ).getDay()
                    , _maxDay = JC.f.maxDayOfMonth( _date )
                    ;

                !_startDay &amp;&amp; ( _startDay = 7 );
                _startDay--;

                for( var i = 0; i &lt;= _rowLen; i++ ){
                    _r.push( &#x27;&lt;tr&gt;&#x27;);
                    for( var j = 0; j &lt; 7; j++ ){

                        var _tpl = &#x27;&lt;td class=&quot;js_bccDateItem&quot;{1}&gt;{0}&lt;/td&gt;&#x27;
                            , _attrs = &#x27;&#x27;, _day = &#x27;&#x27;
                            , _dates = &#x27;&#x27;
                            ;

                        if( _count &gt; _startDay ){
                            if( _dayCount &lt;= _maxDay ){
                                _day = _dayCount++;
                                _dates = JC.f.formatISODate( _date );
                                _attrs = &#x27; data-id=&quot;{2}&quot; data-date=&quot;{3}&quot;&#x27;

                                _date.setDate( _date.getDate() + 1 );
                            }else{
                            }
                        }
                        _r.push( JC.f.printf( _tpl, _day, _attrs, _p._model.id(), _dates ) );

                        _count++;
                    }

                    if( i == _rowLen &amp;&amp; _dayCount &lt;= _maxDay ){
                        _rowLen++;
                    }
                    _r.push( &#x27;&lt;/tr&gt;&#x27; );

                }

                return _r.join(&#x27;&#x27;);
            }

        , dispose:
            function(){
                this._model.panelIns() &amp;&amp; this._model.panelIns().layout().remove();
            }

        , updateDate:
            function( _currentDate ){
                var _p = this
                    , _ctpl = _p._model.schIns()._model.popupCalendarTpl()
                    , _calendarHtml = _p.calendarHtml( _ctpl, _currentDate )
                    ;

                _p.trigger( &#x27;clear_data&#x27; );
                $( _calendarHtml ).appendTo( _p._model.dateBox() );

                _p.trigger( &#x27;layout_inited&#x27;, [ _currentDate ] );
            }
    });

    CRMSchedulePopup.EditView = 
        function( _model ){
            this._model = _model;
        };

    JC.f.extendObject( CRMSchedulePopup.EditView.prototype, {
        init:
            function(){
                //JC.log( &#x27;CRMSchedulePopup.EditView.init:&#x27;, new Date().getTime() );
            }
    });


    return Bizs.CRMSchedulePopup;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb ) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
