<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../modules/JC.FlowChart/0.1/FlowChart.js - open jquery components library</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="open jquery components library"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JC.AjaxTree.html">JC.AjaxTree</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoFixed.html">JC.AutoFixed</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.Cover.html">JC.Cover</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.DragSelect.html">JC.DragSelect</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.FChart.html">JC.FChart</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.FlowChart.html">JC.FlowChart</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.FrameUtil.html">JC.FrameUtil</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NSlider.html">JC.NSlider</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Paginator.html">JC.Paginator</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.Rate.html">JC.Rate</a></li>
            
                <li><a href="../classes/JC.Scrollbar.html">JC.Scrollbar</a></li>
            
                <li><a href="../classes/JC.ServerSort.html">JC.ServerSort</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.StepControl.html">JC.StepControl</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.CRMSchedule.html">window.Bizs.CRMSchedule</a></li>
            
                <li><a href="../classes/window.Bizs.CustomColumn.html">window.Bizs.CustomColumn</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.InputSelect.html">window.Bizs.InputSelect</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiChangeLogic.html">window.Bizs.MultiChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiselectPanel.html">window.Bizs.MultiselectPanel</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelectTree.html">window.Bizs.MultiSelectTree</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.Bizs.TaskViewer.html">window.Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.jQuery.mousewheel.html">window.jQuery.mousewheel</a></li>
            
                <li><a href="../classes/window.JSON.html">window.JSON</a></li>
            
                <li><a href="../classes/window.Raphael.html">window.Raphael</a></li>
            
                <li><a href="../classes/window.requirejs.html">window.requirejs</a></li>
            
                <li><a href="../classes/window.swfobject.html">window.swfobject</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../modules/JC.FlowChart/0.1/FlowChart.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * 支持 多对多 关系( 目前只支持 一对多 和 多对一 )
 */
 ;(function(define, _win) { &#x27;use strict&#x27;; define( &#x27;JC.FlowChart&#x27;, [ &#x27;Raphael&#x27;, &#x27;JC.BaseMVC&#x27;, &#x27;JC.PopTips&#x27; ], function(){
/**
 * &lt;dl&gt;
 *      &lt;dt&gt;JC 流程图&lt;/dt&gt;
 *      &lt;dd style=&quot;&quot;&gt;一对多关系&lt;/dd&gt;
 *      &lt;dd&gt;多对一关系&lt;/dd&gt;
 *      &lt;dd style=&quot;color:#ccc;text-decoration: line-through;&quot;&gt;多对多关系&lt;/dd&gt;
 * &lt;/dl&gt;
 *  &lt;p&gt;&lt;b&gt;require&lt;/b&gt;:
 *      &lt;a href=&#x27;window.Raphael.html&#x27;&gt;RaphaelJS&lt;/a&gt;
 *      , &lt;a href=&#x27;JC.BaseMVC.html&#x27;&gt;JC.BaseMVC&lt;/a&gt;
 *      , &lt;a href=&#x27;JC.PopTips.html&#x27;&gt;JC.PopTips&lt;/a&gt;
 *  &lt;/p&gt;
 *
 *  &lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
 *      | &lt;a href=&#x27;http://jc2.openjavascript.org/docs_api/classes/JC.FlowChart.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
 *      | &lt;a href=&#x27;../../modules/JC.FlowChart/0.1/_demo&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
 *  
 *  &lt;h2&gt;页面只要引用本脚本, 默认会处理 div class=&quot;js_compFlowChart&quot;&lt;/h2&gt;
 *
 *  &lt;h2&gt;可用的 HTML attribute&lt;/h2&gt;
 *
 *  &lt;dl&gt;
 *      &lt;dt&gt;data-FlowChart = script json data&lt;/dt&gt;
 *      &lt;dd&gt;流程图数据
 *          &lt;dl&gt;
 *              &lt;dt&gt;数据说明&lt;/dt&gt;
 *              &lt;dd&gt;数据按节点关系分为两大类: 一对多, 多对一&lt;/dd&gt;
 *              &lt;dd&gt;
 *                  &lt;dl&gt;
 *                      &lt;dt&gt;一对多数据&lt;/dt&gt;
 *                      &lt;dd&gt;一对多数据存放于字段: nodes, nodes 数据类型为数组&lt;/dd&gt;
 *                      &lt;dd&gt;nodes 字段位于数据节点里&lt;/dd&gt;
 *                  &lt;/dl&gt;
 *                  &lt;dl&gt;
 *                      &lt;dt&gt;多对一数据&lt;/dt&gt;
 *                      &lt;dd&gt;多对一数据存放于字段: targetNodes, targetNodes 数据类型为对象&lt;/dd&gt;
 *                      &lt;dd&gt;targetNodes 字段为全局节点&lt;/dd&gt;
 *                  &lt;/dl&gt;
 *              &lt;/dd&gt;
 *          &lt;/dl&gt;
 *          &lt;dl&gt;
 *              &lt;dt&gt;数据字段说明&lt;/dt&gt;
 *              &lt;dd&gt;
 *                  &lt;h2&gt;图表数据 - chart 字段&lt;/h2&gt;
 *                  &lt;dl&gt;
 *                      &lt;dt&gt;name = string&lt;/dt&gt;
 *                      &lt;dd&gt;节点名&lt;/dd&gt;
 *
 *                      &lt;dt&gt;id = string&lt;/dt&gt;
 *                      &lt;dd&gt;节点唯一标识符&lt;/dd&gt;
 *
 *                      &lt;dt&gt;nodes = array&lt;/dt&gt;
 *                      &lt;dd&gt;一对多数据的子节点, 该字段位于父节点里面&lt;/dd&gt;
 *
 *                      &lt;dt&gt;targetNodes = object&lt;/dt&gt;
 *                      &lt;dd&gt;多对一数据的子节点, 该字段为全局字段, 节点位置 chart.targetNodes&lt;/dd&gt;
 *
 *                      &lt;dt&gt;status = string, default = 0&lt;/dt&gt;
 *                      &lt;dd&gt;
 *                          节点状态
 *                          &lt;br/&gt;根据 status 显示为不同的样式
 *                          &lt;br/&gt;默认有0 ~ 10, 共11 种状态
 *                          &lt;br/&gt;由status 产生的 css class: js_cfcItemStatus_N, js_cfcItemTips_N ( N 代表 status )
 *                      &lt;/dd&gt;
 *
 *                      &lt;dt&gt;tipsHtml = string&lt;/dt&gt;
 *                      &lt;dd&gt;鼠标划过节点时, 显示的tips内容, 支持html内容&lt;/dd&gt;
 *                  &lt;/dl&gt;
 *                  &lt;h2&gt;线条与图标颜色 - colors 字段&lt;/h2&gt;
 *                  &lt;dl&gt;
 *                      &lt;dt&gt;line = raphael object, default: { &#x27;stroke&#x27;: &#x27;#E1E1E1&#x27;, &#x27;stroke-width&#x27;: 2 } &lt;/dt&gt;
 *                      &lt;dd&gt;背景线颜色&lt;/dd&gt;
 *
 *                      &lt;dt&gt;icon = raphael object, default: { &#x27;stroke&#x27;: &#x27;#E1E1E1&#x27;, &#x27;stroke-width&#x27;: 2, &#x27;fill&#x27;: &#x27;#F2F2F2&#x27; } &lt;/dt&gt;
 *                      &lt;dd&gt;图标颜色&lt;/dd&gt;
 *
 *                      &lt;dt&gt;如果要自定义节点颜色 或者 tips 颜色, 请使用 css 定义: js_cfcItemStatus_N, js_cfcItemTips_N ( N 代表 status ) &lt;/dt&gt;
 *                  &lt;/dl&gt;
 *              &lt;/dd&gt;
 *          &lt;/dl&gt;
 *      &lt;dd&gt;
 *  &lt;/dl&gt; 
 *
 * @namespace   JC
 * @class       FlowChart
 * @extends     JC.BaseMVC
 * @constructor
 * @param   {selector|string}   _selector   
 * @version dev 0.1 2014-09-03
 * @author  qiushaowei &lt;suches@btbtd.org&gt; | 75 Team
 * @example
&lt;pre&gt;
    &amp;lt;div class=&quot;js_compFlowChart&quot; data-FlowChart=&quot;|script&quot;&gt;
        &amp;lt;script type=&quot;text/template&quot;&gt;
            {
                chart: {
                    name: &#x27;提交&#x27;
                    , id: 1
                    , nodes: [
                            {
                                name: &#x27;资质审核&#x27;
                                , id: 2
                                , status: 1
                                , tipsHtml: &#x27;username 1&#x27;
                                , nodes: [
                                    {
                                        name: &#x27;服务审核&#x27;
                                        , id: 3
                                        , targetNode: 5
                                        , status: 2
                                        , tipsHtml: &#x27;username 2&#x27;
                                    }
                                    , {
                                        name: &#x27;渠道管理层&#x27;
                                        , id: 4
                                        , status: 3
                                        , tipsHtml: &#x27;username 3&#x27;
                                    }
                                ]
                            }
                            , {
                                name: &#x27;资质审核1&#x27;
                                , id: 6
                                , status: 4
                                , tipsHtml: &#x27;username 4&#x27;
                                , nodes: [
                                    {
                                        name: &#x27;服务审核1&#x27;
                                        , id: 7
                                        , targetNode: 9
                                        , status: 5
                                        , tipsHtml: &#x27;username 5&#x27;
                                    }
                                    , {
                                        name: &#x27;渠道管理层1&#x27;
                                        , id: 8
                                        , targetNode: 9
                                        , status: 6
                                        , tipsHtml: &#x27;username 6&#x27;
                                    }
                                ]
                            }
                            , {
                                name: &#x27;资质审核2&#x27;
                                , id: 10
                                , status: 7
                                , tipsHtml: &#x27;username 7&#x27;
                                , nodes: [
                                    {
                                        name: &#x27;服务审核2&#x27;
                                        , id: 11
                                        , status: 8
                                        , tipsHtml: &#x27;username 8&#x27;
                                        , nodes: [
                                            {
                                                name: &#x27;管理层2&#x27;
                                                , id: 12
                                                , targetNode: 5
                                                , status: 9
                                                , tipsHtml: &#x27;username 9&#x27;
                                            }
                                        ]
                                    }
                                ]
                            }
                            , {
                                name: &#x27;资质审核3&#x27;
                                , id: 15
                                , status: 10
                                , tipsHtml: &#x27;username 10&#x27;
                            }
                    ]
                    , targetNodes: {
                        &#x27;5&#x27;: {
                            name: &#x27;管理层&#x27;
                        }
                        , &#x27;9&#x27;: {
                            name: &#x27;管理层1&#x27;
                            , targetNode: 5
                        }
                    }
                }
            }
        &amp;lt;/script&gt;
    &amp;lt;/div&gt;
&lt;/pre&gt;

 */
    var _jdoc = $( document ), _jwin = $( window );
    var isIE = !!window.ActiveXObject;

    JC.FlowChart = FlowChart;

    if( JC.use ){
        !window.Raphael &amp;&amp; ( JC.use( &#x27;plugins.raphael&#x27; ) );
        !JC.PopTips &amp;&amp; ( JC.use( &#x27;JC.PopTips&#x27; ) );
    }

    function FlowChart( _selector ){
        _selector &amp;&amp; ( _selector = $( _selector ) );

        if( JC.BaseMVC.getInstance( _selector, FlowChart ) ) 
            return JC.BaseMVC.getInstance( _selector, FlowChart );

        JC.BaseMVC.getInstance( _selector, FlowChart, this );

        this._model = new FlowChart.Model( _selector );
        this._view = new FlowChart.View( this._model );

        this._init();

        //JC.log( FlowChart.Model._instanceName, &#x27;all inited&#x27;, new Date().getTime() );
    }
    /**
     * 初始化可识别的 FlowChart 实例
     * @method  init
     * @param   {selector}      _selector
     * @static
     * @return  {Array of FlowChartInstance}
     */
    FlowChart.init =
        function( _selector ){
            var _r = [];
            _selector = $( _selector || document );

            if( _selector.length ){
                if( _selector.hasClass( &#x27;js_compFlowChart&#x27; )  ){
                    _r.push( new FlowChart( _selector ) );
                }else{
                    _selector.find( &#x27;div.js_compFlowChart&#x27; ).each( function(){
                        _r.push( new FlowChart( this ) );
                    });
                }
            }
            return _r;
        };

    JC.BaseMVC.build( FlowChart );

    JC.f.extendObject( FlowChart.prototype, {
        _beforeInit:
            function(){
                //JC.log( &#x27;FlowChart _beforeInit&#x27;, new Date().getTime() );
            }

        , _initHanlderEvent:
            function(){
                var _p = this;

                _p.on( &#x27;inited&#x27;, function(){

                    if( !_p._model.chartData() ) return;
                    _p._view.draw();

                    _p.notification( JC.FlowChart.Model.INITED, [ _p, _p._model.data() ] );
                });

                //JC.dir( _p._model.chartData() );
            }

        , _inited:
            function(){
                //JC.log( &#x27;FlowChart _inited&#x27;, new Date().getTime() );
                this.trigger( &#x27;inited&#x27; );
            }
    });

    FlowChart.Model._instanceName = &#x27;JCFlowChart&#x27;;

    /**
     * 初始化后 selector 触发的事件
     * @event   cfc_inited
     * @example
&lt;pre&gt;
$( document ).delegate( 
    &#x27;div.js_compFlowChart&#x27;
    , JC.FlowChart&amp;#46;Model.INITED
    , function( _evt, _ins, _chartData ){
        JC.log( &#x27;js_compFlowChart inited&#x27; );
    }
);
&lt;/pre&gt;
     */
    FlowChart.Model.INITED =           &#x27;cfc_inited&#x27;
    /**
     * dom 节点初始化后 触发的事件
     * @event   cfc_nodeInited
     * @example
&lt;pre&gt;
$( document ).delegate( 
    &#x27;div.js_compFlowChart&#x27;
    , JC.FlowChart&amp;#46;Model.ITEM_INITED
    , function( _evt, _domNode, _itemData, _listData, _chartData ){
        JC.log( _domNode.prop( &#x27;nodeName&#x27; ) );
    }
);
&lt;/pre&gt;
     */
    FlowChart.Model.ITEM_INITED =           &#x27;cfc_nodeInited&#x27;
    /**
     * dom节点初始化前的事件
     * &lt;br /&gt;节点如果有特殊显示需求的话, 可以从这个事件进行相关操作
     * @event   cfc_beforeInitItem
     * @example
&lt;pre&gt;
$( document ).delegate( 
    &#x27;div.js_compFlowChart&#x27;
    , JC.FlowChart&amp;#46;Model.BEFORE_INIT_ITEM
    , function( _evt, _itemData, _listData, _chartData ){
        if( _itemData.tipsHtml ){
            _itemData.tipsHtml += &#x27;   &lt;b&gt;test&lt;/b&gt;&#x27;;
        }
        _itemData.name = JC.f.printf( &#x27;~{0}~&#x27;, _itemData.name );
    }
);
&lt;/pre&gt;
     */
    FlowChart.Model.BEFORE_INIT_ITEM =      &#x27;cfc_beforeInitItem&#x27;

    JC.f.extendObject( FlowChart.Model.prototype, {
        init:
            function(){
                //JC.log( &#x27;FlowChart.Model.init:&#x27;, new Date().getTime() );
            }

        , data:
            function(){
                if( typeof this._data == &#x27;undefined&#x27; &amp;&amp; this.is( &#x27;[data-FlowChart]&#x27; ) ){
                    //JC.log( this.scriptTplProp( &#x27;data-FlowChart&#x27; ) );
                    this._data = eval( &#x27;(&#x27; + this.scriptTplProp( &#x27;data-FlowChart&#x27; ) + &#x27;)&#x27; );
                }
                return this._data;
            }

        , chartData:
            function(){
                return this.data().chart;
            }

        , colorsData:
            function(){
                return this.data().colors;
            }

        , initGrid:
            function(){
                var _p = this;
                _p._grid = { 
                    data: []
                    , idColumnIndex: {}
                    , idColumnIndexList: []
                    , row: {}
                    , idMap: {}
                    , columnIndexMap: {}
                    , maxColumn: 0
                    , rowIndexPad: 0
                    , offsetRowIndex: 10000 
                };

                _p.initIdColumnIndex( _p.chartData(), _p.chartData().id, 0, 0, 0 );
                _p.initColumnIndexMap();

                _p.initColumnRelationship();
                _p.fixLastColumn();
                _p.initColumnRelationship();

                _p.initRowIndex();

                _p.fixNodesRowIndex();
                _p.fixTargetNodesRowIndex();
                /*
                */
                _p.fixRealRowIndex();
                _p.fixFirstLastRowIndex();

                _p.createItems();
                _p.calcRealPosition();

                //JC.dir( _p.gridIdColumnIndex() );
                JC.dir( _p.gridIdColumnIndexMap() );
                //JC.log( _p.gridMaxColumn() );
            }

        , fixLastColumn:
            function(){
                var _p = this
                    , _max = _p.gridMaxColumn()
                    , _list
                    ;
                if( _max &lt; 1 ) return;
                _list = _p.gridIdColumnIndexMap()[ _max ];
                if( _list.length &lt; 2 ) return;
                for( var i = _list.length - 1; i &gt;= 0; i-- ){
                    var _item = _list[i];
                    if( !( _item.nodes &amp;&amp; _item.nodes.length ) &amp;&amp; ( _item.pid &amp;&amp; _item.pid.length &gt; 1 ) ){
                        _list.splice( i, 1 );
                        _item.columnIndex = _max + 1;
                        _p.gridMaxColumn( _item.columnIndex );
                        _p.gridIdColumnIndexMap()[ _p.gridMaxColumn() ] = [ _item ];
                        break;
                    }
                }
            }

        , grid: function(){ return this._grid; }

        , gridIdColumnIndex: function(){ return this.grid().idColumnIndex; }
        , gridIdColumnIndexList: function(){ return this.grid().idColumnIndexList; }
        , gridIdColumnIndexMap: function(){ return this.grid().columnIndexMap; }
        , gridRow: function(){ return this.grid().row; }
        , gridIdMap: 
            function( _id ){ 
                if( typeof _id != &#x27;undefined&#x27; ){
                    return this.grid().idMap[ _id ];
                }
                return this.grid().idMap; 
            }
        , gridOffsetRowIndex: function(){ return this.grid().offsetRowIndex; }
        , gridHeight: function(){ return 40; }
        , gridWidth: function(){ return 120; }
        , lineWidth: function(){ return 75; }
        , childLineWidth: function(){ return 40; }
        , parentLineWidth: function(){ return 25; }

        , itemHtmlPattern:
            function( _item ){
                var _r = &#x27;{0}&#x27;;
                ( &#x27;tipsHtml&#x27; in _item )
                    &amp;&amp; _item.tipsHtml
                    &amp;&amp; ( _r = this.tipsTpl() );
                return _r;
            }

        , tipsTpl:
            function(){

                if( !this._tipsTpl ){
                    this._tipsTpl = FlowChart.TIPS_TPL;
                    this._tipsTpl = this.scriptTplProp( &#x27;cfcTipsTpl&#x27; ) || this._tipsTpl;
                }

                return this._tipsTpl;
            }

        , createItems:
            function(){
                var _p = this, _sx = 0, _sy = 0;
                _p._items = {};
                _p._columnWidth = [];
                for( var i = 0; i &lt;= _p.gridMaxColumn(); i++ ){
                    var _rowList = _p.gridIdColumnIndexMap()[ i ]
                        , _maxWidth = _p.gridWidth()
                        ;
                    $.each( _rowList, function( _k, _item ){
                        var _html, _itemHtmlPatter
                            ;
                        
                        _p.notification( JC.FlowChart.Model.BEFORE_INIT_ITEM, [ _item, _rowList, _p.data() ] );

                       _html = JC.f.printf( 
                            &#x27;&lt;div class=&quot; &quot;&gt;{0}&lt;/div&gt;&#x27;
                            , _item.name
                            , _p.getStatus( _item )
                        );

                        _itemHtmlPatter = JC.f.printf( _p.itemHtmlPattern( _item ), _html, _item.tipsHtml, _p.getStatus( _item ) );

                        var _node = $( _itemHtmlPatter )
                            , _tmpWidth
                            ;
                        _node.addClass( JC.f.printf( &#x27;js_cfcItem js_cfcItemStatus_{0}&#x27;, _p.getStatus( _item ) ) );
                        _node.css( { &#x27;position&#x27;: &#x27;absolute&#x27; } );
                        _node.appendTo( _p.box() );
                        _node.data( &#x27;nodeData&#x27;, _item );
                        _p._items[ _item.id ] = _node;
                        _tmpWidth = _node.width();
                        _tmpWidth &gt; _maxWidth &amp;&amp; ( _maxWidth = _tmpWidth );
                    });
                    if( i === 0 ){
                        _maxWidth = Math.ceil( _p._items[ _p.chartData().id ].width() + 30 );
                    }
                    _p._columnWidth.push( _maxWidth );
                }
            }

        , getStatus:
            function( _itemData ){
                var _r = 0;
                ( &#x27;status&#x27; in _itemData ) &amp;&amp; ( _r = _itemData.status );
                return _r;
            }

        , calcRealPosition:
            function(){
                var _p = this, _sx = 0, _sy = 0, _countX = 0;
                _p._columnX = [];
                _p._minX = _sx;
                _p._maxX = 0;
                _p._minY = 0;
                _p._maxY = 0;

                for( var i = 0; i &lt;= _p.gridMaxColumn(); i++ ){
                    var _rowList = _p.gridIdColumnIndexMap()[ i ]
                        ;

                    $.each( _rowList, function( _k, _item ){
                        var _x = _sx, _y = _sy
                            ;
                        _x += _countX;
                        _y += _item.rowIndex * _p.gridHeight();

                        _y &lt; _p._minY &amp;&amp; ( _p._minY = _y );
                        ( _y + _p.gridHeight() / 2 ) &gt; _p._maxY &amp;&amp; ( _p._maxY = ( _y + _p.gridHeight() / 2 ) );

                        _item.x = _x;
                        _item.y = _y;
                        //JC.log( i, _item.name, _x, _y, _item.rowIndex );
                    });

                    _p._maxX = _sx + _countX + _p.columnWidth( i );

                    _p._columnX.push( _sx + _countX );
                    _countX += Math.max( _p.gridWidth(), _p.columnWidth( i ) ) + _p.lineWidth();
                    if( _p.listHasChildline( _rowList ) ){
                        _countX += _p.childLineWidth();
                    }

                    if( _p.listHasParentline( _rowList ) ){
                        _countX += _p.parentLineWidth();
                    }
                }

                //JC.log( _p._minX, _p._maxX, _p._minY, _p._maxY );
                //JC.log( _p._minY, _p._maxY )

            }

        , minX: function(){ return this._minX; }
        , minY: function(){ return this._minY; }
        , maxX: function(){ return this._maxX; }
        , maxY: function(){ return this._maxY; }

        , items: function(){ return this._items; }
        , item: 
            function( _id ){ 
                return this._items[ _id ]; 
            }
        , columnWidth: 
            function( _ix ){
                if( typeof _ix != undefined ){
                    return this._columnWidth[ _ix ] || 0;
                }
                return this._columnWidth;
            }
        , columnX: 
            function( _ix ){
                if( typeof _ix != undefined ){
                    return this._columnX[ _ix ] || 0;
                }
                return this._columnX;
            }

        , fixFirstLastRowIndex:
            function(){
                var _p = this;

                _p._maxRowY = 0;
                if( _p.gridMaxColumn() &lt; 2 ) return;

                for( var i = 0; i &lt; _p.gridMaxColumn(); i++ ){
                    var _rowList = _p.gridIdColumnIndexMap()[ i ];
                    $.each( _rowList, function( _k, _item ){
                        _item.rowIndex &gt; _p._maxRowY &amp;&amp; ( _p._maxRowY = _item.rowIndex );
                    });
                }

                var _fcol = _p.gridIdColumnIndexMap()[0]
                    , _first, _last
                    , _lcol = _p.gridIdColumnIndexMap()[ _p.gridMaxColumn() - 1]
                    ;
                if( _fcol &amp;&amp; _fcol.length ){
                    var _fdata = _fcol[0];
                    if(  _fdata.nodes &amp;&amp; _fdata.nodes.length ){
                        _first = _fdata.nodes.first();
                        _last = _fdata.nodes.last();
                        _fdata.rowIndex = _first.rowIndex + ( _last.rowIndex - _first.rowIndex ) / 2;
                    }
                }


            }

        , fixNodesRowIndex:
            function(){
                var _p = this;

                for( var i = 0; i &lt;= _p.gridMaxColumn(); i++ ){
                    var _rowList = _p.gridIdColumnIndexMap()[ i ]
                        , _nextList = _p.gridIdColumnIndexMap()[ i + 1 ]
                        ;
                    $.each( _rowList, function( _k, _item ){
                        var _preItem = _rowList[ _k - 1 ]
                            , _nextItem = _rowList[ _k + 1 ]
                            , _oldIx = _item.rowIndex
                            , _nodes = _item.nodes
                            , _pid = _item.pid
                            , _pitem = _p.gridIdMap( _pid ) || {}
                            , _fdata, _ldata
                            , _fitem, _litem
                            , _midY 
                            , _spaceY
                            , _minY, _maxY
                            ;

                        if( _nodes &amp;&amp; _nodes.length ){
                            if( _nodes.length &gt; 1 ){
                                _fdata = _nodes.first();
                                _ldata = _nodes.last();
                                _midY = _fdata.rowIndex + ( _ldata.rowIndex - _fdata.rowIndex ) / 2;
                                _spaceY = _oldIx - _midY;
                                _minY = _fdata.rowIndex + _spaceY;
                                _maxY = _ldata.rowIndex + _spaceY;
                                if( _spaceY === 0 ) {
                                    return;
                                }
                                if( _fdata.prev &amp;&amp; _minY &lt;= _fdata.prev.rowIndex ){
                                    _spaceY = _fdata.prev.rowIndex + 1 - _minY;
                                    _minY += _spaceY;
                                    _maxY += _spaceY;
                                    _p.fixItemDataAndNext( _fdata, _minY - _fdata.rowIndex );
                                    _p.fixItemDataAndNext( _item, _spaceY );
                                    _p.fixItemParentDataAndNext( _item, _spaceY );
                                }else if( _ldata.next &amp;&amp; _maxY &gt;= _ldata.next.rowIndex ){
                                    _p.fixItemDataAndNext( _fdata, _maxY - _ldata.rowIndex );
                                }else{
                                    //_p.fixItemDataAndNext( _fdata, _maxY - _ldata.rowIndex );
                                    //JC.log( _item.name, _fdata.name, _ldata.name, _spaceY );
                                    _p.fixItemDataAndNext( _fdata, _spaceY );
                                }
                            }else{
                                _fdata = _nodes.first();
                                //JC.log( _item.name, _item.id, JC.f.ts(), _item.rowIndex, _fdata.rowIndex, _fdata.name );
                                if( _item.rowIndex === _fdata.rowIndex ) return;
                                    //JC.log( 1 );
                                _maxY = Math.max( _item.rowIndex, _fdata.rowIndex );
                                if( _item.rowIndex &gt; _fdata.rowIndex ){
                                    //JC.log( 2 );
                                    _p.fixItemDataAndNext( _fdata, _item.rowIndex - _fdata.rowIndex );
                                }else if( _item.rowIndex &lt; _fdata.rowIndex ){
                                    //JC.log( 3 );
                                    _p.fixItemDataAndNext( _item, _fdata.rowIndex - _item.rowIndex );
                                    var _newIx = _item.rowIndex;
                                    _p.fixItemParentDataAndNext( _item, _newIx - _oldIx );
                                    //JC.log( _item.name, _item.id, JC.f.ts(), _pitem.name, _pitem.id  );
                                }else{
                                    //JC.log( 4 );
                                }
                            }
                        }
                    });

                }
            }

        , fixTargetNodesRowIndex:
            function(){
                var _p = this;

                for( var i = 0; i &lt;= _p.gridMaxColumn(); i++ ){
                    var _rowList = _p.gridIdColumnIndexMap()[ i ]
                        , _nextList = _p.gridIdColumnIndexMap()[ i + 1 ]
                        ;
                    $.each( _rowList, function( _k, _item ){
                        var _preItem = _rowList[ _k - 1 ]
                            , _nextItem = _rowList[ _k + 1 ]
                            , _oldIx = _item.rowIndex
                            , _nodes = _item.nodes
                            , _pid = _item.pid
                            , _fdata, _ldata
                            , _fitem, _litem
                            , _midY 
                            , _spaceY
                            , _minY, _maxY
                            ;

                        if( _pid &amp;&amp; _pid.length ){
                            if( _pid.length &gt; 1 ){
                                _fdata = _p.gridIdMap( _pid.first() );
                                _ldata = _p.gridIdMap( _pid.last() );

                                _midY = _fdata.rowIndex + ( _ldata.rowIndex - _fdata.rowIndex ) / 2

                                if( _item.prev &amp;&amp; _item.prev.rowIndex &gt;= _midY ){
                                }else if( _item.next &amp;&amp; _item.next.rowIndex &lt;= _midY ){
                                    //JC.log( _item.name, _item.id, _item.next.name, _item.next.id );
                                    _p.fixItemDataAndNext( _item, _midY - _item.rowIndex );
                                }else{
                                    _spaceY = _midY - _item.rowIndex;
                                    _item.rowIndex = _midY;
                                    _p.fixItemChildDataAndNext( _item, _spaceY );
                                }
                            }else{
                                _fdata = _p.gridIdMap( _pid.first() );
                                if( _fdata.targetNode ){
                                    if( _item.next &amp;&amp; _fdata.rowIndex &gt;= _item.next.rowIndex ){
                                        _spaceY = _fdata.rowIndex - _item.rowIndex;
                                        _p.fixItemDataAndNext( _item, _spaceY );
                                    }else{
                                        _spaceY = _fdata.rowIndex - _item.rowIndex;
                                        _item.rowIndex = _fdata.rowIndex;
                                        _p.fixItemChildDataAndNext( _item, _spaceY );
                                    }
                                }
                            }
                         }
                    });

                }
            }

        , fixItemChildDataAndNext:
            function( _item, _spaceY ){
                var _p = this, _nextSpaceY, _newIx;
                if( !( _item &amp;&amp; _item.nodes &amp;&amp; _item.nodes.length ) ) return;
                $.each( _item.nodes, function( _k, _sitem ){
                    _sitem.rowIndex += _spaceY;
                    _p.fixItemChildDataAndNext( _sitem, _spaceY );
                });
            }

        , fixItemParentDataAndNext:
            function( _item, _spaceY, _isRealY ){
                var _p = this, _nextSpaceY, _newIx;
                if( !( _item &amp;&amp; _item.pid &amp;&amp; _item.pid.length ) ) return;
                var _pitem = _p.gridIdMap( _item.pid.first() )
                    , _fdata, _ldata, _midY
                    ;
                if( !( _pitem ) ) return;
                _p.fixItemDataAndNext( _pitem, _spaceY );
                _p.fixItemParentDataAndNext( _pitem, _spaceY, _isRealY );
            }

        , fixItemDataAndNext:
            function( _node, _spaceY ){
                while( _node ){
                    _node.rowIndex += _spaceY;
                    _node = _node.next;
                }
            }

        , fixRealRowIndex:
            function(){
                var _p = this, _sx = 0, _sy = 0, _minY = 0;
                for( var i = 0; i &lt;= _p.gridMaxColumn(); i++ ){
                    var _rowList = _p.gridIdColumnIndexMap()[ i ]
                        ;
                    $.each( _rowList, function( _k, _item ){
                        var _rowIx = _item.rowIndex - _p.gridOffsetRowIndex()
                            ;
                        _item.rowIndex = _rowIx;
                        _rowIx &lt; _minY &amp;&amp; ( _minY = _rowIx );
                    });
                }
                if( _minY &lt; 0 ){
                    _minY = Math.abs( _minY );
                    for( var i = 0; i &lt;= _p.gridMaxColumn(); i++ ){
                        var _rowList = _p.gridIdColumnIndexMap()[ i ]
                            ;
                        $.each( _rowList, function( _k, _item ){
                            _item.rowIndex += _minY;
                        });
                    }
                }

            }

        , initRowIndex:
            function(){
                var _p = this;

                for( var i = 0; i &lt;= _p.gridMaxColumn(); i++ ){
                    //JC.log( i, JC.f.ts() );
                    var _rowList = _p.gridIdColumnIndexMap()[ i ]
                        , _preList = _p.gridIdColumnIndexMap()[ i - 1 ]
                        , _len = _rowList.length
                        , _preLen = _preList ? _preList.length : 0
                        ;
                    //JC.dir( _rowList );
                    //
                    _preList &amp;&amp; ( _preList = _preList.slice().reverse() );

                   /**
                    * 这里的逻辑认为 起始节点 和 结束节点都只有一个
                    */
                   if( i === 0 ){
                        $.each( _rowList, function( _k, _item ){
                            _item.rowIndex = _p.gridOffsetRowIndex();
                        });
                        continue;
                    }

                   var _minRowIndex = _p.gridOffsetRowIndex()
                       , _maxRowIndex = _p.gridOffsetRowIndex()
                       , _itemIndexLen = 1
                       , _startIndex = _p.gridOffsetRowIndex()
                       ;
                   if( _rowList.length &gt; 1 ){
                       _itemIndexLen = _rowList.length * 2;
                   }
                   _startIndex = _startIndex - ( _itemIndexLen / 2 );
                   _startIndex += 1;

                    $.each( _rowList, function( _k, _item ){
                        _item.rowIndex = _startIndex + _k * 2;
                        //JC.log( i, _k, _item.rowIndex );
                    });
                    //JC.log( i, _startIndex );
                }
            }

        , gridMaxColumn:
            function( _setter ){
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this.grid().maxColumn = _setter );
                return this.grid().maxColumn;
            }

        , gridRowIndexPad:
            function( _setter ){
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this.grid().rowIndexPad = _setter );
                return this.grid().rowIndexPad;
            }

        , initColumnIndexMap:
            function(){
                var _p = this;
                $.each( _p.gridIdColumnIndexList(), function( _k, _item ){
                    if( _item.columnIndex in _p.gridIdColumnIndexMap() ){
                        _p.gridIdColumnIndexMap()[ _item.columnIndex ].push( _item );
                    }else{
                        _p.gridIdColumnIndexMap()[ _item.columnIndex ] = [ _item ];
                    }
                });
            }

        , initColumnRelationship:
            function(){
                var _p = this;
                $.each( _p.gridIdColumnIndexMap(), function( _ix, _list ){
                    $.each( _list, function( _k, _item ){
                        var _prev = _list[ _k - 1 ]
                            ;
                        _item.prev = _prev;
                        _prev &amp;&amp; ( _prev.next = _item );
                        _item.next = null;
                    });
                 });
            }


        , initIdColumnIndex:
            function( _data, _id, _ix, _processSelf, _count ){
                var _p = this, _childIx = _ix + 1, _targetNodeIx = _childIx + 1;
                //JC.log( _ix, _data.name, _id, JC.f.ts() );
                if( ( &#x27;columnIndex&#x27; in _data ) &amp;&amp; _ix &lt; _data.columnIndex ){
                    _ix = _data.columnIndex;
                }

                if( !( _id in _p.gridIdMap() ) ){
                    _p.gridIdColumnIndexList().push( _data );
                }

                _data.id = _id;
                _data.pid = _data.pid || [];
                _data.columnIndex = _ix;
                _p.gridIdColumnIndex()[ _id ] = _data;
                _p.gridIdMap()[ _id ] = _data;
                _data.zindex = _count++;


                _ix &gt; _p.gridMaxColumn() &amp;&amp; _p.gridMaxColumn( _ix );

                if( _data.nodes &amp;&amp; _data.nodes.length ){
                    var _targetNodes = {};
                    $.each( _data.nodes, function( _k, _item ){
                        _item.pid = _item.pid || [];
                        _item.pid.push( _id );

                        if( ( &#x27;targetNode&#x27; in _item ) &amp;&amp; _p.chartData().targetNodes &amp;&amp; ( _item.targetNode in _p.chartData().targetNodes )  ){
                            _targetNodes[ _item.targetNode ] = _item.targetNode;

                            _p.chartData().targetNodes[ _item.targetNode ].pid = _p.chartData().targetNodes[ _item.targetNode ].pid || [];
                            _p.chartData().targetNodes[ _item.targetNode ].pid.push( _item.id );
                        }
                        _p.initIdColumnIndex( _item, _item.id, _childIx, false, _count );
                    });

                    $.each( _targetNodes, function( _k, _item ){
                        _p.initIdColumnIndex( _p.chartData().targetNodes[ _k ], _k, _targetNodeIx, true, _count );
                    });
                }              

                if( _processSelf &amp;&amp; ( &#x27;targetNode&#x27; in _data ) &amp;&amp; _p.chartData().targetNodes &amp;&amp; ( _data.targetNode in _p.chartData().targetNodes ) ){
                    _p.chartData().targetNodes[ _data.targetNode ].pid = _p.chartData().targetNodes[ _data.targetNode ].pid || [];
                    _p.chartData().targetNodes[ _data.targetNode ].pid.push( _id );
                    _p.initIdColumnIndex( _p.chartData().targetNodes[ _data.targetNode ], _data.targetNode, _childIx, true, _count  );
                }
            }

        , buildLayout:
            function(){
                var _p = this;
                _p._container = $( &#x27;&lt;div class=&quot;js_cfcContainer&quot;&gt;&lt;/div&gt;&#x27; );
                _p._layout = $( &#x27;&lt;div class=&quot;js_cfcLayout&quot;&gt;&lt;/div&gt;&#x27; );
                _p._raphaelPlaceholder = $( &#x27;&lt;div class=&quot;js_cfcRaphael&quot; style=&quot;position: absolute;&quot;&gt;&lt;/div&gt;&#x27; );
                _p._box = $( &#x27;&lt;div class=&quot;js_cfcBox&quot; style=&quot;&quot;&gt;&lt;/div&gt;&#x27; );
                _p._raphaelPlaceholder.appendTo( _p._layout );
                _p._box.appendTo( _p._layout );
                _p._layout.appendTo( _p._container );
                _p._container.appendTo( _p.selector() );
            }
        , layout: function(){ return this._layout; }
        , box: function(){ return this._box; }
        , raphaelPlaceholder: function(){ return this._raphaelPlaceholder; }
        , width: function(){ return Math.abs( this._maxX - this._minX ); }
        , height: function(){ return Math.abs( this._maxY - this._minY + 5 ); }

        , listHasChildline:
            function( _list ){
                var _r = false;
                $.each( _list, function( _k, _item ){
                    if( ( _item.nodes &amp;&amp; _item.nodes.length &gt; 1 ) ){
                        _r = true;
                        return false;
                    }
                });
                return _r;
            }

        , listHasParentline:
            function( _list ){
                var _r = false, _tmp = {};
                $.each( _list, function( _k, _item ){
                    if( _item.targetNode in _tmp ){
                        _r = true;
                        return false;
                    }
                    if( _item.targetNode &amp;&amp; !( _item.targetNode in _tmp ) ){
                        _tmp[ _item.targetNode ] = 1;
                    }
                });
                return _r;
            }

        , colors:
            function(){
                var _p = this;

                if( !_p._colors ){
                    _p._colors = _p._buildInColors;

                    if( _p.colorsData() ){
                        $.each( _p.colorsData(), function( _k, _item ){
                            if( _k in _p._colors ){
                                if( $.isPlainObject( _item ) ){
                                    JC.f.extendObject( _p._colors[ _k ], _item );
                                }
                            }else{
                                _p._colors[ _k ] = _item;
                            }
                        });
                    }
                    //JC.dir( _p._colors );
                }

                return _p._colors;
            }

        , _buildInColors: {
            line: {
                 &#x27;stroke&#x27;: &#x27;#E1E1E1&#x27;, &#x27;stroke-width&#x27;: 2
            }
            , icon: {
                &#x27;stroke&#x27;: &#x27;#E1E1E1&#x27;, &#x27;stroke-width&#x27;: 2, &#x27;fill&#x27;: &#x27;#F2F2F2&#x27;
            }
        }

    });

    JC.f.extendObject( FlowChart.View.prototype, {
        init:
            function(){
                //JC.log( &#x27;FlowChart.View.init:&#x27;, new Date().getTime() );
            }

        , draw:
            function(){
                var _p = this, _st, _et;
                if( !( _p._model.chartData() &amp;&amp; _p._model.chartData().name ) ) return;

                _st = JC.f.ts();

                _p._model.buildLayout();
                _p._model.initGrid();
                _p._model.layout().css( { 
                    &#x27;height&#x27;: Math.abs( _p._model.maxY() ) + &#x27;px&#x27;
                } );

                _p.showGrid();
                _p.showLine();

                JC.PopTips.init( _p.selector() );

                _et = JC.f.ts();

                //JC.log( &#x27;time span:&#x27;, _et - _st );
            }

        , showLine:
            function(){
                var _p = this, _rh, _raphael, _y = Math.abs( _p._model.minY() ), _ypad = 0;
                _rh = _raphael = Raphael( _p._model.raphaelPlaceholder()[0], _p._model.width(), _p._model.height() );
                !isIE &amp;&amp; ( _ypad = 1 );

                for( var i = 0; i &lt;= _p._model.gridMaxColumn(); i++ ){
                    var _rowList = _p._model.gridIdColumnIndexMap()[ i ]
                        , _hasChildline = _p._model.listHasChildline( _rowList )
                        , _hasParentline = _p._model.listHasParentline( _rowList )
                        , _columnX = _p._model.columnX( i )
                        , _preColumnX = _p._model.columnX( i - 1 )
                        , _columnWidth = _p._model.columnWidth( i )
                        , _preColumnWidth = _p._model.columnWidth( i - 1 )
                        , _startX = _columnX + _columnWidth
                        , _realStartX
                        , _lineWidth = _p._model.lineWidth()
                        , _xpad = 0
                        ;

                    if( _hasParentline ){
                        _lineWidth += _p._model.childLineWidth();
                    }

                    if( _hasChildline ){
                        _lineWidth += _p._model.parentLineWidth();
                    }

                    //JC.log( i, _columnX, _columnWidth, _startX );

                    $.each( _rowList, function( _k, _item ){
                        var _node = _p._model.item( _item.id )
                            , _pid = _item.pid
                            , _nodes = _item.nodes
                            , _subitem
                            , _realStartX
                            , _realY
                            , _fitem, _litem
                            , _fnode, _lnode
                            , _ex, _sx, _sy, _ey
                            , _tmpX
                            , _midY
                            , _tmpY, _tmpY1, _tmpY2
                            , _endX 
                            , _sdata, _snode
                            , _path
                            ;

                        if( !( _pid || _nodes ) ) return; 

                        if(  _pid &amp;&amp; _pid.length  ){
                            _fitem = _p._model.gridIdMap( _pid.first() );
                            _fnode = _p._model.item( _fitem.id );

                            if( _pid.length &gt; 1 ){
                                _realStartX = _preColumnX + _preColumnWidth + _p._model.parentLineWidth();
                                _litem = _p._model.gridIdMap( _pid.last() );
                                _lnode = _p._model.item( _litem.id );

                                _midY = _item.y + Math.abs( _p._model.minY() ) + _node.outerHeight() / 2 + _ypad;
                                _tmpY1 = _fitem.y + Math.abs( _p._model.minY() ) +  _fnode.outerHeight() / 2 + _ypad;
                                _tmpY2 = _litem.y + Math.abs( _p._model.minY() ) +  _lnode.outerHeight() / 2 + _ypad;

                                _endX =  _item.x - 18;

                                _rh.path( JC.f.printf( 
                                    &#x27;{0}M{1} {2}L{3} {4}M{5} {6}L{7} {8}&#x27;
                                    , &#x27;&#x27;
                                    , _realStartX, _tmpY1
                                    , _realStartX, _tmpY2
                                    , _realStartX, _midY
                                    , _endX, _midY
                                )).attr( _p._model.colors().line );

                                $.each( _pid, function( _sk, _sitem ){
                                    _sdata = _p._model.gridIdMap( _sitem );
                                    _snode = _p._model.item( _sdata.id );
                                    _tmpY = _sdata.y + Math.abs( _p._model.minY() ) +  _snode.outerHeight() / 2 + _ypad;

                                    _rh.path( JC.f.printf( 
                                        &#x27;{0}M{1} {2}L{3} {4}&#x27;
                                        , &#x27;&#x27;
                                        , _sdata.x, _tmpY
                                        , _realStartX, _tmpY
                                    )).attr( _p._model.colors().line );
                                });

                                _rh.JCTriangle( 16, _endX, _midY, _p._model.colors().icon );
                            }else if( _fitem &amp;&amp; _pid.length === 1 &amp;&amp; ( &#x27;targetNode&#x27; in _fitem ) ){
                                _realStartX = _preColumnX + _fnode.outerWidth();
                                _realY = _fitem.y + _fnode.outerHeight() / 2;
                                _item.y = _fitem.y;

                                _rh.path( JC.f.printf( 
                                    &#x27;{0}M{1} {2}L{3} {4}&#x27;
                                    , &#x27;&#x27;, _realStartX, _realY + _ypad, _item.x - 18, _realY + _ypad
                                )).attr( _p._model.colors().line );
                                _rh.JCTriangle( 16, _item.x - 18, _realY + _ypad, _p._model.colors().icon );
                            }
                        }

                        if( _nodes &amp;&amp; _nodes.length ){
                            if( _nodes.length &gt; 1 ){

                                _sx = _item.x + _node.outerWidth();

                                _fitem = _nodes.first();
                                _litem = _nodes.last();
                                _fnode = _p._model.item( _fitem.id );
                                _lnode = _p._model.item( _litem.id );

                                //JC.log( _item.id, _fitem.name, _litem.name );

                                _ex = _fitem.x;
                                _realStartX = _ex - _p._model.childLineWidth();

                                _midY = _item.y + Math.abs( _p._model.minY() ) + _node.outerHeight() / 2 + _ypad;

                                _rh.path( JC.f.printf( 
                                    &#x27;{0}M{1} {2}L{3} {4}&#x27;
                                    , &#x27;&#x27;
                                    , _sx, _midY
                                    , _realStartX - 18, _midY
                                )).attr( _p._model.colors().line );

                                _rh.JCTriangle( 16, _realStartX - 18, _midY, _p._model.colors().icon );

                                _tmpY1 = _fitem.y + Math.abs( _p._model.minY() ) +  _fnode.outerHeight() / 2 + _ypad;
                                _tmpY2 = _litem.y + Math.abs( _p._model.minY() ) +  _lnode.outerHeight() / 2 + _ypad;

                                _endX =  _item.x - 18;

                                _rh.path( JC.f.printf( 
                                    &#x27;{0}M{1} {2}L{3} {4}&#x27;
                                    , &#x27;&#x27;
                                    , _realStartX, _tmpY1
                                    , _realStartX, _tmpY2
                                )).attr( _p._model.colors().line );

                                $.each( _nodes, function( _sk, _sitem ){
                                    _sdata = _sitem;
                                    _snode = _p._model.item( _sdata.id );
                                    _tmpY = _sdata.y + Math.abs( _p._model.minY() ) +  _snode.outerHeight() / 2 + _ypad;

                                    _rh.path( JC.f.printf( 
                                        &#x27;{0}M{1} {2}L{3} {4}&#x27;
                                        , &#x27;&#x27;
                                        , _realStartX, _tmpY
                                        , _sdata.x, _tmpY
                                    )).attr( _p._model.colors().line );
                                });

                            }

                            if( _nodes.length === 1 ){
                                _realStartX = _columnX + _node.outerWidth();
                                _realY = _item.y + _node.outerHeight() / 2;

                                _subitem = _nodes[0];
                                _rh.path( JC.f.printf( 
                                    &#x27;{0}M{1} {2}L{3} {4}&#x27;
                                    , &#x27;&#x27;, _realStartX, _realY + _y + _ypad, _subitem.x - 18, _realY + _y + _ypad
                                )).attr( _p._model.colors().line );
                                _rh.JCTriangle( 16, _subitem.x - 18, _realY + _y + _ypad, _p._model.colors().icon );
                            }
                        }
                    });
                }

            }

        , showGrid:
            function(){
                var _p = this;
                for( var i = 0; i &lt;= _p._model.gridMaxColumn(); i++ ){
                    var _rowList = _p._model.gridIdColumnIndexMap()[ i ]
                        ;
                    $.each( _rowList, function( _k, _item ){
                        var _node = _p._model.item( _item.id )
                            ;
                        _node.css({
                            &#x27;left&#x27;: _item.x + &#x27;px&#x27;, &#x27;top&#x27;: _item.y + &#x27;px&#x27;
                        });
                        _p.notification( JC.FlowChart.Model.ITEM_INITED, [ _node, _item, _rowList, _p._model.data() ] );
                    });
                }
            }
    });

    FlowChart.TIPS_TPL =
        [
            &#x27;&lt;span class=&quot;js_compPopTips&quot; style=&quot;display:inline-block;&quot;&#x27;
            ,&#x27;htmlContent=&quot;|script&quot;&#x27;
            ,&#x27;theme=&quot;white&quot;&#x27;
            ,&#x27;arrowposition=&quot;bottom&quot;&#x27;
            ,&#x27;triggerType=&quot;hover&quot;&#x27;
            ,&#x27;popTipsMinWidth=&quot;100&quot;&#x27;
            ,&#x27;popTipsMinHeight=&quot;50&quot;&#x27;
            ,&#x27;&gt;&#x27;
            ,&#x27;&lt;span&gt;{0}&lt;/span&gt;&#x27;
            ,&#x27;&lt;script type=&quot;text/template&quot;&gt;&lt;div class=&quot;js_cfcItemTips js_cfcItemTips_{2}&quot;&gt;{1}&lt;/div&gt;&lt;\/script&gt;&#x27;
            ,&#x27;&lt;/span&gt;&#x27;
        ].join(&#x27;&#x27;);

    function distanceAngleToPoint( _distance, _angle){
        var _radian = _angle * Math.PI / 180;					
        return {
            x: ( Math.cos( _radian  ) * _distance )
            , y: ( Math.sin( _radian ) * _distance )
        }
    }

    _jdoc.ready( function(){

        Raphael.fn.JCTriangle =
            function( _sideLength, _x, _y, _params, _offsetAngle ){
                !_sideLength &amp;&amp; ( _sideLength = 16 );
                !_x &amp;&amp; ( _x = 0 );
                !_y &amp;&amp; ( _y = _sideLength / 2 );
                _y += 1;
                typeof _offsetAngle == &#x27;undefined&#x27; &amp;&amp; ( _offsetAngle = 180 );

                var _p1 = distanceAngleToPoint( _sideLength, 330 )
                    , _p2 = distanceAngleToPoint( _sideLength, 30 )
                    , _p3 = distanceAngleToPoint( _sideLength, 120 )
                    ;

                    _p1.x = parseInt( _p1.x +  _x );
                    _p1.y = parseInt( _p1.y + _y );

                    _p2.x = parseInt( _p2.x + _x );
                    _p2.y = parseInt( _p2.y + _y );

                var _r = this.path(
                    JC.f.printf( 
                        &#x27;{0}M{1} {2}L{3} {4}L{5} {6}L{1} {2}Z&#x27;
                        , &#x27;&#x27;
                        , _x, _y 
                        , _p1.x, _p1.y
                        , _p2.x, _p2.y
                    )
                );
                _r.rotate( _offsetAngle );
                _params &amp;&amp; _r.attr( _params );
                return _r;
            };

        JC.f.safeTimeout( function(){
            FlowChart.autoInit &amp;&amp; FlowChart.init();
        }, null, &#x27;JCFlowChart_INIT&#x27;, 1);
    });

    return JC.FlowChart;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb ) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
